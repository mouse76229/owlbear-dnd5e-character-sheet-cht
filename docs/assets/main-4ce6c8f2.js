import{n as W,s as lr,r as je,a as Ce,i as sr,g as Ue,S as Oe,b as Be,e as _,c as y,t as G,d as p,f as w,h as f,l as D,j as ee,k as T,m as ke,o as Me,p as ze,q as Rn,u as ir,v as or,w as Mn,x as $n,y as Nn,z as P,A as U,B as ar,C as We,D as Ye,E as ne,F as le,G as Ke,H as se,I as Ge,J as $e,K as rr,L as he,M as Pe,N as vt,O as Fe,P as Ve,Q as ae,R as yn,T as Re,U as ur,V as En,W as bs,X as cr,Y as fr,Z as dr,_ as tl,$ as ga,a0 as pr,a1 as ys,a2 as ws,a3 as _r,a4 as hr,a5 as mr,a6 as va,a7 as Ts,a8 as gr}from"./index-f84af09a.js";const rn=[];function vr(t,e){return{subscribe:ct(t,e).subscribe}}function ct(t,e=W){let n;const l=new Set;function s(r){if(Ce(t,r)&&(t=r,n)){const u=!rn.length;for(const c of l)c[1](),rn.push(c,t);if(u){for(let c=0;c<rn.length;c+=2)rn[c][0](rn[c+1]);rn.length=0}}}function o(r){s(r(t))}function i(r,u=W){const c=[r,u];return l.add(c),l.size===1&&(n=e(s)||W),r(t),()=>{l.delete(c),l.size===0&&n&&(n(),n=null)}}return{set:s,update:o,subscribe:i}}function br(t,e,n){const l=!Array.isArray(t),s=l?[t]:t,o=e.length<2;return vr(n,i=>{let r=!1;const u=[];let c=0,a=W;const d=()=>{if(c)return;a();const v=e(l?u[0]:u,i);o?i(v):a=sr(v)?v:W},h=s.map((v,g)=>lr(v,m=>{u[g]=m,c&=~(1<<g),r&&d()},()=>{c|=1<<g}));return r=!0,d(),function(){je(h),a(),r=!1}})}const ba=[{name:"Leather Armor",type:"Armor",cost:{gp:10,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,ac:{base:11,modifier:0,maxDex:void 0},weight:10,l10n:{name:"皮甲"}}],Pl={};for(const t of ba)Pl[t.name.toLowerCase()]=t;const yr=[{name:"Backpack",type:"Basic",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!1,weight:5,l10n:{name:"背包"}},{name:"Torch",type:"Basic",cost:{gp:0,sp:0,cp:1,ep:0,pp:0},canBeEquipped:!0,weight:1,l10n:{name:"火把"}}],Hl={};for(const t of yr)Hl[t.name.toLowerCase()]=t;const ya=[{name:"Fireball",range:"150 ft",class:"Wizard",tier:3,duration:"Instantaneous",desc:"A bright streak flashes from your pointing finger to a point you choose...",l10n:{name:"火球術",desc:"一道亮光從你手指射出..."}}],Gl={};for(const t of ya)Gl[t.name.toLowerCase()]=t;const wa=[{name:"Dagger",type:"Weapon",cost:{gp:2,sp:0,cp:0,ep:0,pp:0},canBeEquipped:!0,properties:["Finesse","Light","Thrown"],range:"20/60",weaponType:"Simple Melee",damage:{oneHanded:{diceType:"d4",numDice:1}},l10n:{name:"匕首"},weight:1}],Ul={};for(const t of wa)Ul[t.name.toLowerCase()]=t;let Fl=[],Ta=[];function wr(t){Fl=t.customGear??[],Ta=t.customSpells??[]}function Ea(t){return Ul[t.toLowerCase()]??kr(t)}function Tr(t){return Pl[t.toLowerCase()]}function Er(t){return Hl[t.toLowerCase()]}function Ar(t){return Ta.find(e=>e.name.toLowerCase()===t.toLowerCase())}function Aa(t){return Gl[t.toLowerCase()]||Ar(t)}function ka(t){return Fl.find(e=>e.name.toLowerCase()===t.toLowerCase())}function kr(t){return Fl.filter(e=>e.type==="Weapon").map(e=>e).find(e=>e.name.toLowerCase()===t.toLowerCase())}function nt(t){return Ea(t)||Tr(t)||Er(t)||ka(t)}const Cr=["Shield","+1","+2","+3","Magic"],Es=["Self","Touch","5 ft","10 ft","30 ft","60 ft","120 ft","Sight"],Lt=["d4","d6","d8","d10","d12","d20","d100"],Or="1.0.0",Br="dnd5e-char-sheet",Gt=["STR","DEX","CON","INT","WIS","CHA"],As=["Lawful Good","Neutral Good","Chaotic Good","Lawful Neutral","True Neutral","Chaotic Neutral","Lawful Evil","Neutral Evil","Chaotic Evil"],ks=["Simple Melee","Simple Ranged","Martial Melee","Martial Ranged"],Sr=["Ammunition","Finesse","Heavy","Light","Loading","Range","Reach","Special","Thrown","Two-Handed","Versatile","Silvered","Magical"],Rr=["armorClass","hp","proficiencyBonus","speed","initiative","passivePerception","stat","skill"],kl=["attackRoll","damageRoll","savingThrow","skillCheck","abilityCheck","initiativeRoll"],Cs=[...Rr,...kl],Ut=["Barbarian","Bard","Cleric","Druid","Fighter","Monk","Paladin","Ranger","Rogue","Sorcerer","Warlock","Wizard","Artificer"],Os=["Dragonborn","Dwarf","Elf","Gnome","Half-Elf","Half-Orc","Halfling","Human","Tiefling"],Bs=["Common","Dwarvish","Elvish","Giant","Gnomish","Goblin","Halfling","Orc","Abyssal","Celestial","Draconic","Deep Speech","Infernal","Primordial","Sylvan","Undercommon"],Mr={d4:4,d6:6,d8:8,d10:10,d12:12,d20:20,d100:100};function Dt(t,e=1){let n=0;for(let l=0;l<e;l++)n+=Math.floor(Math.random()*Mr[t])+1;return n}function In(t){return`${t>=0?"+":""}${t}`}function Qn(t,e){return t=t.toLowerCase(),e=e.toLowerCase(),t<e?-1:t>e?1:0}function Ss(t){return nt(t.name)}function Vl(t,e=500,n,l){let s;return(...o)=>(n==null||n(),new Promise(i=>{s&&clearTimeout(s),s=setTimeout(()=>{i(t(...o)),l==null||l()},e)}))}function Rs(t,e){return Lt.findIndex(n=>n===t)-Lt.findIndex(n=>n===e)}const $r=100;function Nr(t){const e=[Ue(t)];let n=0;const l=ct(!1),s=ct(!1),o=Vl(i=>{if(i){for(n++,e[n]=JSON.parse(JSON.stringify(i));n<e.length-1;)e.pop();e.length>$r&&(e.splice(0,1),n=Math.max(0,n-1)),l.set(!0),s.set(!1)}},1e3);return{subscribe:t.subscribe,canUndo:l,canRedo:s,set:i=>{o(i),t.set(i)},undo:()=>{n!==0&&(n--,n===0&&l.set(!1),s.set(!0),t.set(e[n]))},redo:()=>{n>=e.length-1||(n++,n>=e.length-1&&s.set(!1),l.set(!0),t.set(e[n]))}}}const Ee=Nr(ct(Pt())),Ne=Ee;function Pt(){return{name:"",ancestry:"Human",class:"",level:1,title:"",alignment:"True Neutral",background:"Noble",deity:"",notes:"",gear:[],customGear:[],stats:{STR:10,DEX:10,CON:10,INT:10,WIS:10,CHA:10},skills:{Acrobatics:0,"Animal Handling":0,Arcana:0,Athletics:0,Deception:0,History:0,Insight:0,Intimidation:0,Investigation:0,Medicine:0,Nature:0,Perception:0,Performance:0,Persuasion:0,Religion:0,"Sleight of Hand":0,Stealth:0,Survival:0},savingThrows:{STR:!1,DEX:!1,CON:!1,INT:!1,WIS:!1,CHA:!1},proficiencyBonus:2,passivePerception:10,speed:30,bonuses:[],customBonuses:[],customTalents:[],maxHitPoints:10,hitPoints:10,tempHitPoints:0,hitDice:{},deathSaves:{successes:0,failures:0},conditions:[],exhaustion:0,armorClass:10,carryingCapacity:150,currency:{cp:0,sp:0,ep:0,gp:0,pp:0},languages:["Common"],customLanguages:[],xp:0,spells:[],customSpells:[],spellSlots:{}}}function Ca(t){return t<=0?2:Math.ceil(t/4)+1}function Ft(t,e){const n=jl(t,e);return Math.floor((n-10)/2)}function Ir(t,e){t.class=e}function Dr(t,e){t.ancestry=e}function jl(t,e){return t.stats[e]+Ba(t,e)}function Wl(t,e){var o,i;const n=!t.metadata,l=((o=t.metadata)==null?void 0:o.type)==="weaponType"&&e.weaponType.includes(t.metadata.weaponType),s=((i=t.metadata)==null?void 0:i.type)==="weapon"&&t.metadata.weapon===e.name;return n||l||s}function Oa(t,e,n){var o;let l=((o=e.damage[n])==null?void 0:o.diceType)??"d4";const s=t.bonuses.filter(i=>i.type==="diceType"&&i.bonusTo==="damageRoll"&&Wl(i,e)).map(i=>i.diceType).sort(Rs).reverse();return s[0]&&Rs(s[0],l)>0&&(l=s[0]),l}function Ba(t,e){return t.bonuses.filter(n=>{var l;return n.type==="modifyAmt"&&n.bonusTo==="stat"&&((l=n.metadata)==null?void 0:l.type)==="stat"&&n.metadata.stat===e}).reduce((n,l)=>n+Zt(t,l),0)}function Lr(t){let e=0;const n=t.gear.filter(i=>i.equipped).map(Ss).filter(i=>{var r;return i.type==="Armor"&&!((r=i.properties)!=null&&r.includes("Shield"))}),l=Ft(t,"DEX");if(n.length>0){const i=n[0],r=i.ac.base;let u=l;i.ac.maxDex!==void 0&&(i.ac.maxDex===0?u=0:u=Math.min(l,i.ac.maxDex)),e=r+u,e+=i.ac.modifier}else e=10+l;const s=t.gear.filter(i=>i.equipped).map(Ss).filter(i=>{var r;return i.type==="Armor"&&((r=i.properties)==null?void 0:r.includes("Shield"))});for(const i of s)e+=i.ac.base>0?i.ac.base:2,e+=i.ac.modifier;const o=t.bonuses.reduce((i,r)=>r.type==="modifyAmt"&&r.bonusTo==="armorClass"?i+Zt(t,r):i,0);return e+=o,e}function Pr(t){return t.title||null}function Sa(t,e="Wizard"){const n=Ca(t.level);let l="INT";["Cleric","Druid","Ranger"].includes(t.class||"")&&(l="WIS"),["Bard","Paladin","Sorcerer","Warlock"].includes(t.class||"")&&(l="CHA");const s=Ft(t,l);return n+s}function Hr(t){return 8+Sa(t)}function Dn(t,e){var i,r,u;let n=0;const l=Ft(t,"STR"),s=Ft(t,"DEX");(i=e.properties)!=null&&i.includes("Finesse")||e.weaponType&&e.weaponType.includes("Ranged")?e.weaponType.includes("Ranged")&&!((r=e.properties)!=null&&r.includes("Thrown"))?n+=s:(u=e.properties)!=null&&u.includes("Finesse")?n+=Math.max(l,s):n+=l:n+=l;const o=t.bonuses.filter(c=>c.type==="modifyAmt"&&c.bonusTo==="damageRoll").reduce((c,a)=>(Wl(a,e)&&(c+=Zt(t,a)),c),0);return n+=o,n}function Ms(t,e){var r,u;let n=0;const l=Ft(t,"STR"),s=Ft(t,"DEX");(r=e.properties)!=null&&r.includes("Finesse")?n+=Math.max(l,s):e.weaponType.includes("Ranged")&&!((u=e.properties)!=null&&u.includes("Thrown"))?n+=s:n+=l;const o=Ca(t.level);n+=o;const i=t.bonuses.filter(c=>c.type==="modifyAmt"&&c.bonusTo==="attackRoll").reduce((c,a)=>(Wl(a,e)&&(c+=Zt(t,a)),c),0);return n+=i,n}function Gr(t){return jl(t,"STR")*15}function Ur(t){return t.gear.reduce((e,n)=>{const l=nt(n.name);return e+((l==null?void 0:l.weight)||0)*n.quantity},0)}const Fr=[0,300,900,2700,6500,14e3,23e3,34e3,48e3,64e3,85e3,1e5,12e4,14e4,165e3,195e3,225e3,265e3,305e3,355e3];function Vr(t){if(t.level>=20)return;const e=Fr[t.level];t.xp>=e&&(t.level+=1)}function Ra(t,e){return t.spells.findIndex(n=>n.name===e.name)>-1}function jr(t,e){return!0}function Wr(t,e){Ra(t,e)||t.spells.push({name:e.name})}function qr(t,e){t.spells=t.spells.filter(n=>n.name!==e.name)}function An(t,e){t.bonuses.push(e)}function zr(t,e){t.bonuses=t.bonuses.filter(n=>n.name!==e.name)}function $s(t){const e=t.maxHitPoints,n=t.bonuses.filter(l=>l.type==="modifyAmt"&&l.bonusTo==="hp").reduce((l,s)=>l+Zt(t,s),0);return e+n}function Zt(t,e){var s;let n=e.bonusAmount;e.bonusTo!=="stat"&&((s=e.metadata)==null?void 0:s.type)==="stat"&&(n=Math.max(n,Ft(t,e.metadata.stat)));const l=Math.floor(t.level*(e.bonusIncreaseRatePerLevel??0));return n+l}function Yr(t,e){t.spells=t.spells.filter(n=>n.name!==e.name),t.bonuses=t.bonuses.filter(n=>{var l;return!(((l=n.metadata)==null?void 0:l.type)==="spell"&&n.metadata.spell===e.name)}),t.customSpells=t.customSpells.filter(n=>n.name!==e.name)}function Kr(t,e){var s,o,i;const n=e.cost.gp*100+e.cost.sp*10+e.cost.cp;return(((s=t.currency)==null?void 0:s.gp)||0)*100+(((o=t.currency)==null?void 0:o.sp)||0)*10+(((i=t.currency)==null?void 0:i.cp)||0)>=n}const Xr={Barbarian:"野蠻人",Bard:"吟遊詩人",Cleric:"牧師",Druid:"德魯伊",Fighter:"戰士",Monk:"武僧",Paladin:"聖騎士",Ranger:"巡林客",Rogue:"盜賊",Sorcerer:"術士",Warlock:"邪術師",Wizard:"法師",Artificer:"奇械師"},Jr={Dragonborn:"龍裔",Dwarf:"矮人",Elf:"精靈",Gnome:"地侏","Half-Elf":"半精靈","Half-Orc":"半獸人",Halfling:"哈比人",Human:"人類",Tiefling:"堤夫林"},Zr={"Lawful Good":"守序善良","Neutral Good":"中立善良","Chaotic Good":"混沌善良","Lawful Neutral":"守序中立","True Neutral":"絕對中立","Chaotic Neutral":"混沌中立","Lawful Evil":"守序邪惡","Neutral Evil":"中立邪惡","Chaotic Evil":"混沌邪惡"},Qr={STR:"力量",DEX:"敏捷",CON:"體質",INT:"智力",WIS:"感知",CHA:"魅力"},xr={Common:"通用語",Dwarvish:"矮人語",Elvish:"精靈語",Giant:"巨人語",Gnomish:"地侏語",Goblin:"哥布林語",Halfling:"哈比人語",Orc:"獸人語",Abyssal:"深淵語",Celestial:"天界語",Draconic:"龍語","Deep Speech":"地底語",Infernal:"煉獄語",Primordial:"原初語",Sylvan:"森林語",Undercommon:"地底通用語"};function Cl(t){return Xr[t]??t}function eu(t){return Jr[t]??t}function tu(t){return Zr[t]??t}function gn(t){return Qr[t]??t}function Ol(t){return xr[t]??t}function Ns(t,e,n){return t}function Is(t,e,n){const l=t.slice();return l[8]=e[n],l}function Ds(t,e,n){const l=t.slice();return l[8]=e[n],l}function Ls(t){let e,n,l,s,o=Bs.filter(t[2]),i=[];for(let r=0;r<o.length;r+=1)i[r]=Ps(Ds(t,o,r));return{c(){e=_("select"),n=_("option");for(let r=0;r<i.length;r+=1)i[r].c();n.__value="",n.value=n.__value,p(e,"class","flex-grow")},m(r,u){w(r,e,u),f(e,n);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);l||(s=D(e,"change",t[3]),l=!0)},p(r,u){if(u&4){o=Bs.filter(r[2]);let c;for(c=0;c<o.length;c+=1){const a=Ds(r,o,c);i[c]?i[c].p(a,u):(i[c]=Ps(a),i[c].c(),i[c].m(e,null))}for(;c<i.length;c+=1)i[c].d(1);i.length=o.length}},d(r){r&&T(e),ke(i,r),l=!1,s()}}}function Ps(t){let e,n=Ol(t[8])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[8],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function Hs(t){let e,n,l=Ol(t[8])+"",s,o,i,r,u,c;function a(){return t[6](t[8])}return{c(){e=_("li"),n=_("div"),s=G(l),o=y(),i=_("button"),i.innerHTML='<i class="material-icons translate-y-1">delete</i>',r=y(),p(i,"class","text-white bg-black p-1 text-xs"),p(e,"class","border-b flex justify-between gap-4")},m(d,h){w(d,e,h),f(e,n),f(n,s),f(e,o),f(e,i),f(e,r),u||(c=D(i,"click",a),u=!0)},p(d,h){t=d,h&2&&l!==(l=Ol(t[8])+"")&&ee(s,l)},d(d){d&&T(e),u=!1,c()}}}function nu(t){let e,n,l,s,o,i=t[0]?"do_not_disturb_on":"add_circle",r,u,c,a,d,h,v=t[0]&&Ls(t),g=t[1].languages,m=[];for(let b=0;b<g.length;b+=1)m[b]=Hs(Is(t,g,b));return{c(){e=_("div"),n=_("h2"),n.textContent="語言",l=y(),s=_("button"),o=_("i"),r=G(i),u=y(),v&&v.c(),c=y(),a=_("ul");for(let b=0;b<m.length;b+=1)m[b].c();p(o,"class","material-icons translate-y-1"),p(s,"class","px-3 hover:bg-gray-400"),p(e,"class","flex justify-start")},m(b,A){w(b,e,A),f(e,n),f(e,l),f(e,s),f(s,o),f(o,r),f(e,u),v&&v.m(e,null),w(b,c,A),w(b,a,A);for(let E=0;E<m.length;E+=1)m[E]&&m[E].m(a,null);d||(h=D(s,"click",t[5]),d=!0)},p(b,[A]){if(A&1&&i!==(i=b[0]?"do_not_disturb_on":"add_circle")&&ee(r,i),b[0]?v?v.p(b,A):(v=Ls(b),v.c(),v.m(e,null)):v&&(v.d(1),v=null),A&18){g=b[1].languages;let E;for(E=0;E<g.length;E+=1){const k=Is(b,g,E);m[E]?m[E].p(k,A):(m[E]=Hs(k),m[E].c(),m[E].m(a,null))}for(;E<m.length;E+=1)m[E].d(1);m.length=g.length}},i:W,o:W,d(b){b&&T(e),v&&v.d(),b&&T(c),b&&T(a),ke(m,b),d=!1,h()}}}function lu(t,e,n){let l;Me(t,Ee,d=>n(1,l=d));let s=!1;function o(d){return!l.languages.includes(d)}function i(d){l.languages.push(d),n(0,s=!1),Ee.set(l)}function r(d){i(d.target.value)}function u(d){ze(Ee,l.languages=l.languages.filter(h=>h!==d),l)}return[s,l,o,r,u,()=>{n(0,s=!s)},d=>{u(d)}]}class su extends Oe{constructor(e){super(),Be(this,e,lu,nu,Ce,{})}}const iu=t=>({}),Gs=t=>({});function ou(t){let e,n,l,s,o,i,r,u,c,a,d,h,v;const g=t[5].header,m=Rn(g,t,t[4],Gs),b=t[5].default,A=Rn(b,t,t[4],null);return{c(){e=_("dialog"),n=_("div"),l=_("button"),l.innerHTML='<i class="material-icons">close</i>',s=y(),m&&m.c(),o=y(),i=_("hr"),r=y(),A&&A.c(),u=y(),c=_("hr"),p(l,"class","absolute top-0 right-0 p-4 hover:bg-gray-200 rounded-md"),p(n,"class","svelte-eyp6eo"),p(e,"class","max-w-3xl svelte-eyp6eo"),p(e,"style",a=`min-width: 20rem; width: ${t[1]}vw;`+t[2]?`height: ${t[2]}vh`:"")},m(E,k){w(E,e,k),f(e,n),f(n,l),f(n,s),m&&m.m(n,null),f(n,o),f(n,i),f(n,r),A&&A.m(n,null),f(n,u),f(n,c),t[8](e),d=!0,h||(v=[D(l,"click",t[7]),D(n,"click",ir(t[6])),D(e,"close",t[9]),D(e,"click",or(t[10]))],h=!0)},p(E,[k]){m&&m.p&&(!d||k&16)&&Mn(m,g,E,E[4],d?Nn(g,E[4],k,iu):$n(E[4]),Gs),A&&A.p&&(!d||k&16)&&Mn(A,b,E,E[4],d?Nn(b,E[4],k,null):$n(E[4]),null),(!d||k&6&&a!==(a=`min-width: 20rem; width: ${E[1]}vw;`+E[2]?`height: ${E[2]}vh`:""))&&p(e,"style",a)},i(E){d||(P(m,E),P(A,E),d=!0)},o(E){U(m,E),U(A,E),d=!1},d(E){E&&T(e),m&&m.d(E),A&&A.d(E),t[8](null),h=!1,je(v)}}}function au(t,e,n){let{$$slots:l={},$$scope:s}=e,{showModal:o=!0}=e,{vw:i=85}=e,{vh:r=void 0}=e,u;function c(g){ar.call(this,t,g)}const a=()=>{n(0,o=!1)};function d(g){We[g?"unshift":"push"](()=>{u=g,n(3,u)})}const h=()=>n(0,o=!1),v=()=>u.close();return t.$$set=g=>{"showModal"in g&&n(0,o=g.showModal),"vw"in g&&n(1,i=g.vw),"vh"in g&&n(2,r=g.vh),"$$scope"in g&&n(4,s=g.$$scope)},t.$$.update=()=>{t.$$.dirty&9&&u&&(o?u.showModal():u.close())},[o,i,r,u,s,l,c,a,d,h,v]}class ft extends Oe{constructor(e){super(),Be(this,e,au,ou,Ce,{showModal:0,vw:1,vh:2})}}const nl={};function Us(t,e,n){const l=t.slice();return l[27]=e[n],l}function Fs(t,e,n){const l=t.slice();return l[30]=e[n],l}function Vs(t,e,n){const l=t.slice();return l[33]=e[n],l[35]=n,l}function js(t,e,n){const l=t.slice();l[36]=e[n],l[35]=n;const s=nl[l[2].class][l[35]];return l[37]=s,l}function Ws(t){var c,a,d;let e,n,l=(t[36].min===t[36].max?t[36].min:`${t[36].min}-${t[36].max}`)+"",s,o,i,r=(((a=(c=t[37])==null?void 0:c.l10n)==null?void 0:a.name)??((d=t[37])==null?void 0:d.name))+"",u;return{c(){e=_("tr"),n=_("td"),s=G(l),o=y(),i=_("td"),u=G(r),p(e,"class","border-b border-black"),$e(e,"bg-yellow-300",t[1]===t[35])},m(h,v){w(h,e,v),f(e,n),f(n,s),f(e,o),f(e,i),f(i,u)},p(h,v){var g,m,b;v[0]&4&&r!==(r=(((m=(g=h[37])==null?void 0:g.l10n)==null?void 0:m.name)??((b=h[37])==null?void 0:b.name))+"")&&ee(u,r),v[0]&2&&$e(e,"bg-yellow-300",h[1]===h[35])},d(h){h&&T(e)}}}function qs(t){let e,n,l;return{c(){e=_("button"),e.textContent="擲骰",p(e,"class","w-full bg-black text-white p-1")},m(s,o){w(s,e,o),n||(l=D(e,"click",t[11]),n=!0)},p:W,d(s){s&&T(e),n=!1,l()}}}function zs(t){let e,n,l,s,o,i,r,u,c,a,d;return c=rr(t[18][0]),{c(){e=_("div"),n=_("label"),n.textContent="選擇天賦",l=y(),s=_("input"),o=y(),i=_("label"),i.textContent="分配屬性",r=y(),u=_("input"),p(n,"for","chooseTalentCheckBox"),p(s,"id","chooseTalentCheckBox"),p(s,"type","radio"),p(s,"name","pick"),s.__value="talent",s.value=s.__value,p(i,"for","distributeStatsCheckBox"),p(u,"id","distributeStatsCheckBox"),p(u,"type","radio"),p(u,"name","pick"),u.__value="stats",u.value=u.__value,p(e,"class","flex gap-5 items-center justify-center p-2"),c.p(s,u)},m(h,v){w(h,e,v),f(e,n),f(e,l),f(e,s),s.checked=s.__value===t[7],f(e,o),f(e,i),f(e,r),f(e,u),u.checked=u.__value===t[7],a||(d=[D(s,"change",t[17]),D(u,"change",t[19])],a=!0)},p(h,v){v[0]&128&&(s.checked=s.__value===h[7]),v[0]&128&&(u.checked=u.__value===h[7])},d(h){h&&T(e),c.r(),a=!1,je(d)}}}function Ys(t){let e,n,l,s=nl[t[2].class],o=[];for(let i=0;i<s.length;i+=1)o[i]=Ks(Vs(t,s,i));return{c(){e=_("select");for(let i=0;i<o.length;i+=1)o[i].c();p(e,"class","w-full svelte-ox30w2")},m(i,r){w(i,e,r);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);he(e,t[1]),n||(l=D(e,"change",t[13]),n=!0)},p(i,r){if(r[0]&4){s=nl[i[2].class];let u;for(u=0;u<s.length;u+=1){const c=Vs(i,s,u);o[u]?o[u].p(c,r):(o[u]=Ks(c),o[u].c(),o[u].m(e,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=s.length}r[0]&2&&he(e,i[1])},d(i){i&&T(e),ke(o,i),n=!1,l()}}}function Ks(t){var s;let e,n=(((s=t[33].l10n)==null?void 0:s.name)??t[33].name)+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[35],e.value=e.__value},m(o,i){w(o,e,i),f(e,l)},p(o,i){var r;i[0]&4&&n!==(n=(((r=o[33].l10n)==null?void 0:r.name)??o[33].name)+"")&&ee(l,n)},d(o){o&&T(e)}}}function Xs(t){let e,n,l,s,o,i=Gt,r=[];for(let u=0;u<i.length;u+=1)r[u]=Js(Fs(t,i,u));return{c(){e=_("div"),n=G("剩餘屬性點數: "),l=G(t[8]),s=y(),o=_("div");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"class","self-center"),p(o,"class","flex flex-col gap-1 items-center")},m(u,c){w(u,e,c),f(e,n),f(e,l),w(u,s,c),w(u,o,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(o,null)},p(u,c){if(c[0]&256&&ee(l,u[8]),c[0]&49668){i=Gt;let a;for(a=0;a<i.length;a+=1){const d=Fs(u,i,a);r[a]?r[a].p(d,c):(r[a]=Js(d),r[a].c(),r[a].m(o,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}},d(u){u&&T(e),u&&T(s),u&&T(o),ke(r,u)}}}function Js(t){let e,n,l=t[30]+"",s,o,i,r=t[9][t[30]]+"",u,c,a,d,h,v,g,m;function b(){return t[20](t[30])}function A(){return t[21](t[30])}return{c(){e=_("div"),n=_("div"),s=G(l),o=y(),i=_("div"),u=G(r),c=y(),a=_("button"),a.innerHTML='<i class="material-icons">remove</i>',d=y(),h=_("button"),h.innerHTML='<i class="material-icons">add</i>',v=y(),p(n,"class","w-12"),p(i,"class","p-1 bg-gray-200 rounded-md"),$e(i,"text-green-600",t[9][t[30]]>t[2].stats[t[30]]),p(e,"class","flex items-center")},m(E,k){w(E,e,k),f(e,n),f(n,s),f(e,o),f(e,i),f(i,u),f(e,c),f(e,a),f(e,d),f(e,h),f(e,v),g||(m=[D(a,"click",b),D(h,"click",A)],g=!0)},p(E,k){t=E,k[0]&512&&r!==(r=t[9][t[30]]+"")&&ee(u,r),k[0]&516&&$e(i,"text-green-600",t[9][t[30]]>t[2].stats[t[30]])},d(E){E&&T(e),g=!1,je(m)}}}function Zs(t){let e,n,l,s=t[5],o=[];for(let i=0;i<s.length;i+=1)o[i]=Qs(Us(t,s,i));return{c(){e=_("select");for(let i=0;i<o.length;i+=1)o[i].c();p(e,"class","svelte-ox30w2"),t[6]===void 0&&Pe(()=>t[22].call(e))},m(i,r){w(i,e,r);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(e,null);he(e,t[6],!0),n||(l=D(e,"change",t[22]),n=!0)},p(i,r){if(r[0]&32){s=i[5];let u;for(u=0;u<s.length;u+=1){const c=Us(i,s,u);o[u]?o[u].p(c,r):(o[u]=Qs(c),o[u].c(),o[u].m(e,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=s.length}r[0]&96&&he(e,i[6])},d(i){i&&T(e),ke(o,i),n=!1,l()}}}function Qs(t){let e,n=ei(t[27])+"",l,s;return{c(){e=_("option"),l=G(n),e.__value=s=t[27],e.value=e.__value},m(o,i){w(o,e,i),f(e,l)},p(o,i){i[0]&32&&n!==(n=ei(o[27])+"")&&ee(l,n),i[0]&32&&s!==(s=o[27])&&(e.__value=s,e.value=e.__value)},d(o){o&&T(e)}}}function xs(t){let e,n,l;return{c(){e=_("button"),e.textContent="更新角色卡",p(e,"class","w-full bg-black text-white p-1")},m(s,o){w(s,e,o),n||(l=D(e,"click",t[12]),n=!0)},p:W,d(s){s&&T(e),n=!1,l()}}}function ru(t){let e,n,l,s,o,i,r,u,c,a,d,h,v=t[10],g=[];for(let B=0;B<v.length;B+=1)g[B]=Ws(js(t,v,B));let m=t[3]&&qs(t),b=t[1]===4&&zs(t),A=t[7]==="talent"&&Ys(t),E=t[7]==="stats"&&Xs(t),k=t[5].length&&Zs(t),O=t[4]&&xs(t);return{c(){e=_("table"),n=_("tr"),n.innerHTML=`<th class="w-20">2d6</th> 
      <th>效果</th>`,l=y();for(let B=0;B<g.length;B+=1)g[B].c();s=y(),o=_("tr"),o.innerHTML=`<td>12</td> 
      <td>選擇一項天賦或 +2 點數分配至屬性</td>`,i=y(),m&&m.c(),r=y(),u=_("div"),b&&b.c(),c=y(),A&&A.c(),a=y(),E&&E.c(),d=y(),k&&k.c(),h=y(),O&&O.c(),p(n,"class","text-left border-b border-black"),p(o,"class","border-b border-black"),$e(o,"bg-yellow-300",t[1]===4),p(u,"class","flex flex-col gap-1")},m(B,R){w(B,e,R),f(e,n),f(e,l);for(let I=0;I<g.length;I+=1)g[I]&&g[I].m(e,null);f(e,s),f(e,o),w(B,i,R),m&&m.m(B,R),w(B,r,R),w(B,u,R),b&&b.m(u,null),f(u,c),A&&A.m(u,null),f(u,a),E&&E.m(u,null),f(u,d),k&&k.m(u,null),f(u,h),O&&O.m(u,null)},p(B,R){if(R[0]&1030){v=B[10];let I;for(I=0;I<v.length;I+=1){const M=js(B,v,I);g[I]?g[I].p(M,R):(g[I]=Ws(M),g[I].c(),g[I].m(e,s))}for(;I<g.length;I+=1)g[I].d(1);g.length=v.length}R[0]&2&&$e(o,"bg-yellow-300",B[1]===4),B[3]?m?m.p(B,R):(m=qs(B),m.c(),m.m(r.parentNode,r)):m&&(m.d(1),m=null),B[1]===4?b?b.p(B,R):(b=zs(B),b.c(),b.m(u,c)):b&&(b.d(1),b=null),B[7]==="talent"?A?A.p(B,R):(A=Ys(B),A.c(),A.m(u,a)):A&&(A.d(1),A=null),B[7]==="stats"?E?E.p(B,R):(E=Xs(B),E.c(),E.m(u,d)):E&&(E.d(1),E=null),B[5].length?k?k.p(B,R):(k=Zs(B),k.c(),k.m(u,h)):k&&(k.d(1),k=null),B[4]?O?O.p(B,R):(O=xs(B),O.c(),O.m(u,null)):O&&(O.d(1),O=null)},d(B){B&&T(e),ke(g,B),B&&T(i),m&&m.d(B),B&&T(r),B&&T(u),b&&b.d(),A&&A.d(),E&&E.d(),k&&k.d(),O&&O.d()}}}function uu(t){let e;return{c(){e=_("h2"),e.textContent="擲新天賦",p(e,"slot","header"),p(e,"class","text-lg")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function cu(t){let e,n,l,s,o,i,r;function u(a){t[23](a)}let c={$$slots:{header:[uu],default:[ru]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),We.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.textContent="擲新天賦",n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white w-full p-2")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=D(e,"click",t[16]),i=!0)},p(a,d){const h={};d[0]&1022|d[1]&256&&(h.$$scope={dirty:d,ctx:a}),!s&&d[0]&1&&(s=!0,h.showModal=a[0],Ke(()=>s=!1)),l.$set(h)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){U(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function ei(t){var e;return Array.isArray(t)?t.map(n=>{var l;return((l=n.l10n)==null?void 0:l.name)??n.name}).join(" & "):((e=t.l10n)==null?void 0:e.name)??t.name}function fu(t,e,n){let l,s;Me(t,Ne,V=>n(2,s=V));let o=!1;const i=[{min:2,max:2},{min:3,max:7},{min:8,max:9},{min:10,max:11}];let r=!0,u=!1,c=-1;function a(){const V=Dt("d6")+Dt("d6");if(n(3,r=!1),V===12){n(1,c=4),n(4,u=!0);return}for(let Q=0;Q<i.length;Q++){const ve=i[Q];if(V>=ve.min&&V<=ve.max){n(1,c=Q),n(4,u=!0);break}}}let d=[],h,v=()=>{};function g(V){const Q=nl[s.class][V];switch(Q==null?void 0:Q.type){case"generic":v=()=>{An(s,{name:Q.name,desc:Q.name,type:"generic",editable:!0})};break;case"bonus":v=()=>{for(const re of Q.bonuses)An(s,re)};break;case"chooseBonus":const ve=Q.choices[0];!Array.isArray(ve)&&ve.metadata&&ve.metadata.type==="spell"?n(5,d=Q.choices.filter(re=>s.spells.find(de=>{var oe;return de.name===((oe=re.metadata)==null?void 0:oe.spell)}))):n(5,d=Q.choices);break}}function m(){n(3,r=!0),n(1,c=-1),n(4,u=!1),n(5,d=[]),n(6,h=void 0),n(7,A=void 0),n(8,E=2),n(9,l={STR:s.stats.STR,DEX:s.stats.DEX,CON:s.stats.CON,INT:s.stats.INT,WIS:s.stats.WIS,CHA:s.stats.CHA})}function b(){if(A==="stats")ze(Ne,s.stats=l,s);else if(h)if(Array.isArray(h))for(const V of h)An(s,V);else An(s,h);else v();Ne.set(s),n(0,o=!1)}let A,E=2;function k(V){n(5,d=[]),g(parseInt(V.target.value))}function O(V){E<1||(n(9,l[V]+=1,l),n(8,E-=1))}function B(V){E===2||l[V]-1<s.stats[V]||(n(9,l[V]=Math.max(s.stats[V],l[V]-1),l),n(8,E+=1))}const R=[[]],I=()=>n(0,o=!0);function M(){A=this.__value,n(7,A)}function S(){A=this.__value,n(7,A)}const C=V=>B(V),$=V=>O(V);function N(){h=Ge(this),n(6,h),n(5,d)}function j(V){o=V,n(0,o)}return t.$$.update=()=>{t.$$.dirty[0]&1&&(o||m()),t.$$.dirty[0]&2&&c>-1&&g(c),t.$$.dirty[0]&4&&n(9,l={STR:s.stats.STR,DEX:s.stats.DEX,CON:s.stats.CON,INT:s.stats.INT,WIS:s.stats.WIS,CHA:s.stats.CHA})},[o,c,s,r,u,d,h,A,E,l,i,a,b,k,O,B,I,M,R,S,C,$,N,j]}class du extends Oe{constructor(e){super(),Be(this,e,fu,cu,Ce,{},null,[-1,-1])}}function pu(t){let e,n,l,s,o=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",i,r,u=t[1].diceType+"",c;return{c(){e=_("div"),n=G(t[3]),l=y(),s=_("div"),i=G(o),r=y(),c=G(u),p(e,"class","font-bold")},m(a,d){w(a,e,d),f(e,n),w(a,l,d),w(a,s,d),f(s,i),f(s,r),f(s,c)},p(a,d){d&8&&ee(n,a[3]),d&2&&o!==(o=(a[5][a[1].bonusTo]??a[1].bonusTo)+"")&&ee(i,o),d&2&&u!==(u=a[1].diceType+"")&&ee(c,u)},d(a){a&&T(e),a&&T(l),a&&T(s)}}}function _u(t){let e,n,l,s,o=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",i,r,u=t[1].type==="advantage"?"優勢":"劣勢",c;return{c(){e=_("div"),n=G(t[3]),l=y(),s=_("div"),i=G(o),r=y(),c=G(u),p(e,"class","font-bold")},m(a,d){w(a,e,d),f(e,n),w(a,l,d),w(a,s,d),f(s,i),f(s,r),f(s,c)},p(a,d){d&8&&ee(n,a[3]),d&2&&o!==(o=(a[5][a[1].bonusTo]??a[1].bonusTo)+"")&&ee(i,o),d&2&&u!==(u=a[1].type==="advantage"?"優勢":"劣勢")&&ee(c,u)},d(a){a&&T(e),a&&T(l),a&&T(s)}}}function hu(t){let e,n,l,s,o=(t[5][t[1].bonusTo]??t[1].bonusTo)+"",i,r,u=In(Zt(t[4],t[1]))+"",c;return{c(){e=_("div"),n=G(t[3]),l=y(),s=_("div"),i=G(o),r=y(),c=G(u),p(e,"class","font-bold")},m(a,d){w(a,e,d),f(e,n),w(a,l,d),w(a,s,d),f(s,i),f(s,r),f(s,c)},p(a,d){d&8&&ee(n,a[3]),d&2&&o!==(o=(a[5][a[1].bonusTo]??a[1].bonusTo)+"")&&ee(i,o),d&18&&u!==(u=In(Zt(a[4],a[1]))+"")&&ee(c,u)},d(a){a&&T(e),a&&T(l),a&&T(s)}}}function mu(t){var s;let e,n=(((s=t[1].l10n)==null?void 0:s.desc)??t[1].desc)+"",l;return{c(){e=_("div"),l=G(n)},m(o,i){w(o,e,i),f(e,l)},p(o,i){var r;i&2&&n!==(n=(((r=o[1].l10n)==null?void 0:r.desc)??o[1].desc)+"")&&ee(l,n)},d(o){o&&T(e)}}}function ti(t){let e,n,l;return{c(){e=_("button"),e.innerHTML='<i class="material-icons">info</i>'},m(s,o){w(s,e,o),n||(l=D(e,"click",t[8]),n=!0)},p:W,d(s){s&&T(e),n=!1,l()}}}function ni(t){let e,n,l,s;return{c(){e=_("div"),n=_("button"),n.innerHTML='<i class="material-icons">delete</i>',p(n,"class","pt-1 px-1 rounded-md bg-black text-white"),p(e,"class","flex gap-1")},m(o,i){w(o,e,i),f(e,n),l||(s=D(n,"click",t[9]),l=!0)},p:W,d(o){o&&T(e),l=!1,s()}}}function li(t){let e,n,l;function s(i){t[10](i)}let o={$$slots:{header:[vu],default:[gu]},$$scope:{ctx:t}};return t[2]!==void 0&&(o.showModal=t[2]),e=new ft({props:o}),We.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&2050&&(u.$$scope={dirty:r,ctx:i}),!n&&r&4&&(n=!0,u.showModal=i[2],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){U(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function gu(t){let e,n,l=t[1].desc+"",s,o,i,r,u=(t[1].bonusSource??"none")+"",c,a,d,h,v=(t[1].editable??"no")+"",g;return{c(){e=_("div"),n=G("Description: "),s=G(l),o=y(),i=_("div"),r=G("Source: "),c=G(u),a=y(),d=_("div"),h=G("Editable: "),g=G(v)},m(m,b){w(m,e,b),f(e,n),f(e,s),w(m,o,b),w(m,i,b),f(i,r),f(i,c),w(m,a,b),w(m,d,b),f(d,h),f(d,g)},p(m,b){b&2&&l!==(l=m[1].desc+"")&&ee(s,l),b&2&&u!==(u=(m[1].bonusSource??"none")+"")&&ee(c,u),b&2&&v!==(v=(m[1].editable??"no")+"")&&ee(g,v)},d(m){m&&T(e),m&&T(o),m&&T(i),m&&T(a),m&&T(d)}}}function vu(t){let e,n=t[1].name+"",l;return{c(){e=_("h2"),l=G(n),p(e,"slot","header")},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&2&&n!==(n=s[1].name+"")&&ee(l,n)},d(s){s&&T(e)}}}function bu(t){let e,n,l,s,o,i,r;function u(g,m){if(g[1].type==="generic")return mu;if(g[1].type==="modifyAmt")return hu;if(g[1].type==="disadvantage"||g[1].type==="advantage")return _u;if(g[1].type==="diceType")return pu}let c=u(t),a=c&&c(t),d=t[0]&&ti(t),h=t[1].editable&&ni(t),v=t[2]&&li(t);return{c(){e=_("div"),n=_("div"),a&&a.c(),l=y(),d&&d.c(),s=y(),h&&h.c(),o=y(),v&&v.c(),i=vt(),p(n,"class","flex gap-1"),p(e,"class","flex justify-between gap-3 items-center")},m(g,m){w(g,e,m),f(e,n),a&&a.m(n,null),f(n,l),d&&d.m(n,null),f(e,s),h&&h.m(e,null),w(g,o,m),v&&v.m(g,m),w(g,i,m),r=!0},p(g,[m]){c===(c=u(g))&&a?a.p(g,m):(a&&a.d(1),a=c&&c(g),a&&(a.c(),a.m(n,l))),g[0]?d?d.p(g,m):(d=ti(g),d.c(),d.m(n,null)):d&&(d.d(1),d=null),g[1].editable?h?h.p(g,m):(h=ni(g),h.c(),h.m(e,null)):h&&(h.d(1),h=null),g[2]?v?(v.p(g,m),m&4&&P(v,1)):(v=li(g),v.c(),P(v,1),v.m(i.parentNode,i)):v&&(Fe(),U(v,1,1,()=>{v=null}),Ve())},i(g){r||(P(v),r=!0)},o(g){U(v),r=!1},d(g){g&&T(e),a&&a.d(),d&&d.d(),h&&h.d(),g&&T(o),v&&v.d(g),g&&T(i)}}}function yu(t,e,n){let l,s;Me(t,Ne,g=>n(4,s=g));let{bonus:o}=e,{showInfo:i=!0}=e,r=!1;const u={attackRoll:"攻擊檢定",damageRoll:"傷害",armorClass:"AC",hp:"生命值",gearSlots:"裝備格",spellcastRoll:"施法檢定",backstabDice:"背刺骰",initiativeRoll:"先攻",hpRoll:"生命值擲骰",stat:"屬性",statRoll:"屬性檢定"};let c="";function a(g){zr(s,g),Ne.set(s)}const d=()=>{n(2,r=!0)},h=()=>a(l);function v(g){r=g,n(2,r)}return t.$$set=g=>{"bonus"in g&&n(7,o=g.bonus),"showInfo"in g&&n(0,i=g.showInfo)},t.$$.update=()=>{var g,m,b,A;if(t.$$.dirty&128&&n(1,l=o),t.$$.dirty&2)switch((g=l.metadata)==null?void 0:g.type){case"weapon":{const E=nt(l.metadata.weapon);n(3,c=(((m=E==null?void 0:E.l10n)==null?void 0:m.name)??l.metadata.weapon)+":");break}case"weaponType":{n(3,c=({Melee:"近戰",Ranged:"遠程",MeleeRanged:"近戰/遠程"}[l.metadata.weaponType]??l.metadata.weaponType)+":");break}case"armor":{const E=nt(l.metadata.armor);n(3,c=(((b=E==null?void 0:E.l10n)==null?void 0:b.name)??l.metadata.armor)+":");break}case"stat":{n(3,c=gn(l.metadata.stat)+":");break}case"spell":{const E=Aa(l.metadata.spell);n(3,c=(((A=E==null?void 0:E.l10n)==null?void 0:A.name)??l.metadata.spell)+":");break}default:n(3,c="")}},[i,l,r,c,s,u,a,o,d,h,v]}class ql extends Oe{constructor(e){super(),Be(this,e,yu,bu,Ce,{bonus:7,showInfo:0})}}function si(t,e,n){const l=t.slice();return l[44]=e[n],l}function ii(t,e,n){const l=t.slice();return l[39]=e[n],l}function oi(t,e,n){const l=t.slice();return l[39]=e[n],l}function ai(t,e,n){const l=t.slice();return l[36]=e[n],l}function ri(t,e,n){const l=t.slice();return l[33]=e[n],l}function ui(t,e,n){const l=t.slice();return l[47]=e[n],l}function ci(t,e,n){const l=t.slice();return l[50]=e[n],l}function fi(t,e,n){const l=t.slice();return l[50]=e[n],l}function di(t){let e,n,l,s,o,i;function r(a,d){return a[10]==="diceType"||a[10]==="advantage"||a[10]==="disadvantage"?Tu:wu}let u=r(t),c=u(t);return{c(){e=_("div"),n=_("label"),n.textContent="加值對象:",l=y(),s=_("select"),c.c(),p(n,"for","bto"),p(n,"class","font-bold"),p(s,"id","bto"),p(s,"class","border p-1 rounded"),t[2]===void 0&&Pe(()=>t[23].call(s)),p(e,"class","flex flex-col")},m(a,d){w(a,e,d),f(e,n),f(e,l),f(e,s),c.m(s,null),he(s,t[2],!0),o||(i=D(s,"change",t[23]),o=!0)},p(a,d){u===(u=r(a))&&c?c.p(a,d):(c.d(1),c=u(a),c&&(c.c(),c.m(s,null))),d[0]&4&&he(s,a[2])},d(a){a&&T(e),c.d(),o=!1,i()}}}function wu(t){let e,n=Cs,l=[];for(let s=0;s<n.length;s+=1)l[s]=pi(ci(t,n,s));return{c(){for(let s=0;s<l.length;s+=1)l[s].c();e=vt()},m(s,o){for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(s,o);w(s,e,o)},p(s,o){if(o[0]&262144){n=Cs;let i;for(i=0;i<n.length;i+=1){const r=ci(s,n,i);l[i]?l[i].p(r,o):(l[i]=pi(r),l[i].c(),l[i].m(e.parentNode,e))}for(;i<l.length;i+=1)l[i].d(1);l.length=n.length}},d(s){ke(l,s),s&&T(e)}}}function Tu(t){let e,n=kl,l=[];for(let s=0;s<n.length;s+=1)l[s]=_i(fi(t,n,s));return{c(){for(let s=0;s<l.length;s+=1)l[s].c();e=vt()},m(s,o){for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(s,o);w(s,e,o)},p(s,o){if(o[0]&262144){n=kl;let i;for(i=0;i<n.length;i+=1){const r=fi(s,n,i);l[i]?l[i].p(r,o):(l[i]=_i(r),l[i].c(),l[i].m(e.parentNode,e))}for(;i<l.length;i+=1)l[i].d(1);l.length=n.length}},d(s){ke(l,s),s&&T(e)}}}function pi(t){let e,n=(t[18][t[50]]??t[50])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[50],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function _i(t){let e,n=(t[18][t[50]]??t[50])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[50],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function Eu(t){let e,n,l,s,o,i,r=Lt,u=[];for(let c=0;c<r.length;c+=1)u[c]=hi(ui(t,r,c));return{c(){e=_("div"),n=_("label"),n.textContent="骰子類型",l=y(),s=_("select");for(let c=0;c<u.length;c+=1)u[c].c();p(n,"for","diceType"),p(n,"class","font-bold"),p(s,"id","diceType"),p(s,"class","border p-1 rounded"),t[12]===void 0&&Pe(()=>t[25].call(s)),p(e,"class","flex flex-col")},m(c,a){w(c,e,a),f(e,n),f(e,l),f(e,s);for(let d=0;d<u.length;d+=1)u[d]&&u[d].m(s,null);he(s,t[12],!0),o||(i=D(s,"change",t[25]),o=!0)},p(c,a){if(a&0){r=Lt;let d;for(d=0;d<r.length;d+=1){const h=ui(c,r,d);u[d]?u[d].p(h,a):(u[d]=hi(h),u[d].c(),u[d].m(s,null))}for(;d<u.length;d+=1)u[d].d(1);u.length=r.length}a[0]&4096&&he(s,c[12])},d(c){c&&T(e),ke(u,c),o=!1,i()}}}function Au(t){let e,n,l,s,o,i;return{c(){e=_("div"),n=_("label"),n.textContent="數值多少?",l=y(),s=_("input"),p(n,"for","modifyAmt"),p(n,"class","font-bold"),p(s,"id","modifyAmt"),p(s,"type","number"),p(s,"inputmode","numeric"),p(s,"class","border p-1 rounded"),p(e,"class","flex flex-col")},m(r,u){w(r,e,u),f(e,n),f(e,l),f(e,s),ae(s,t[11]),o||(i=D(s,"input",t[24]),o=!0)},p(r,u){u[0]&2048&&Re(s.value)!==r[11]&&ae(s,r[11])},d(r){r&&T(e),o=!1,i()}}}function hi(t){let e,n=t[47]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[47],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function ku(t){let e,n,l,s,o,i=ks,r=[];for(let u=0;u<i.length;u+=1)r[u]=mi(si(t,i,u));return{c(){e=_("label"),e.textContent="選擇武器類型",n=y(),l=_("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","weaponType"),p(l,"id","weaponType"),p(l,"class","border p-1 rounded w-full"),t[8]===void 0&&Pe(()=>t[31].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);he(l,t[8],!0),s||(o=D(l,"change",t[31]),s=!0)},p(u,c){if(c&0){i=ks;let a;for(a=0;a<i.length;a+=1){const d=si(u,i,a);r[a]?r[a].p(d,c):(r[a]=mi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c[0]&256&&he(l,u[8])},d(u){u&&T(e),u&&T(n),u&&T(l),ke(r,u),s=!1,o()}}}function Cu(t){let e,n,l,s,o,i=Gt,r=[];for(let u=0;u<i.length;u+=1)r[u]=gi(ii(t,i,u));return{c(){e=_("label"),e.textContent="選擇屬性",n=y(),l=_("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","stat"),p(l,"id","stat"),p(l,"class","border p-1 rounded w-full"),t[7]===void 0&&Pe(()=>t[30].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);he(l,t[7],!0),s||(o=D(l,"change",t[30]),s=!0)},p(u,c){if(c&0){i=Gt;let a;for(a=0;a<i.length;a+=1){const d=ii(u,i,a);r[a]?r[a].p(d,c):(r[a]=gi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c[0]&128&&he(l,u[7])},d(u){u&&T(e),u&&T(n),u&&T(l),ke(r,u),s=!1,o()}}}function Ou(t){let e,n,l,s,o,i=t[14],r=[];for(let u=0;u<i.length;u+=1)r[u]=vi(oi(t,i,u));return{c(){e=_("label"),e.textContent="選擇法術",n=y(),l=_("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","spell"),p(l,"id","spell"),p(l,"class","border p-1 rounded w-full"),t[6]===void 0&&Pe(()=>t[29].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);he(l,t[6],!0),s||(o=D(l,"change",t[29]),s=!0)},p(u,c){if(c[0]&16384){i=u[14];let a;for(a=0;a<i.length;a+=1){const d=oi(u,i,a);r[a]?r[a].p(d,c):(r[a]=vi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c[0]&16448&&he(l,u[6])},d(u){u&&T(e),u&&T(n),u&&T(l),ke(r,u),s=!1,o()}}}function Bu(t){let e,n,l,s,o,i=t[15],r=[];for(let u=0;u<i.length;u+=1)r[u]=bi(ai(t,i,u));return{c(){e=_("label"),e.textContent="選擇防具",n=y(),l=_("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","armor"),p(l,"id","armor"),p(l,"class","border p-1 rounded w-full"),t[5]===void 0&&Pe(()=>t[28].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);he(l,t[5],!0),s||(o=D(l,"change",t[28]),s=!0)},p(u,c){if(c[0]&32768){i=u[15];let a;for(a=0;a<i.length;a+=1){const d=ai(u,i,a);r[a]?r[a].p(d,c):(r[a]=bi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c[0]&32800&&he(l,u[5])},d(u){u&&T(e),u&&T(n),u&&T(l),ke(r,u),s=!1,o()}}}function Su(t){let e,n,l,s,o,i=t[16],r=[];for(let u=0;u<i.length;u+=1)r[u]=yi(ri(t,i,u));return{c(){e=_("label"),e.textContent="選擇武器",n=y(),l=_("select");for(let u=0;u<r.length;u+=1)r[u].c();p(e,"for","weapon"),p(l,"id","weapon"),p(l,"class","border p-1 rounded w-full"),t[4]===void 0&&Pe(()=>t[27].call(l))},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(l,null);he(l,t[4],!0),s||(o=D(l,"change",t[27]),s=!0)},p(u,c){if(c[0]&65536){i=u[16];let a;for(a=0;a<i.length;a+=1){const d=ri(u,i,a);r[a]?r[a].p(d,c):(r[a]=yi(d),r[a].c(),r[a].m(l,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c[0]&65552&&he(l,u[4])},d(u){u&&T(e),u&&T(n),u&&T(l),ke(r,u),s=!1,o()}}}function mi(t){let e,n=t[44]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[44],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function gi(t){let e,n=gn(t[39])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[39],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function vi(t){var o;let e,n=(((o=t[39].l10n)==null?void 0:o.name)??t[39].name)+"",l,s;return{c(){e=_("option"),l=G(n),e.__value=s=t[39].name,e.value=e.__value},m(i,r){w(i,e,r),f(e,l)},p(i,r){var u;r[0]&16384&&n!==(n=(((u=i[39].l10n)==null?void 0:u.name)??i[39].name)+"")&&ee(l,n),r[0]&16384&&s!==(s=i[39].name)&&(e.__value=s,e.value=e.__value)},d(i){i&&T(e)}}}function bi(t){var o;let e,n=(((o=t[36].l10n)==null?void 0:o.name)??t[36].name)+"",l,s;return{c(){e=_("option"),l=G(n),e.__value=s=t[36].name,e.value=e.__value},m(i,r){w(i,e,r),f(e,l)},p(i,r){var u;r[0]&32768&&n!==(n=(((u=i[36].l10n)==null?void 0:u.name)??i[36].name)+"")&&ee(l,n),r[0]&32768&&s!==(s=i[36].name)&&(e.__value=s,e.value=e.__value)},d(i){i&&T(e)}}}function yi(t){var o;let e,n=(((o=t[33].l10n)==null?void 0:o.name)??t[33].name)+"",l,s;return{c(){e=_("option"),l=G(n),e.__value=s=t[33].name,e.value=e.__value},m(i,r){w(i,e,r),f(e,l)},p(i,r){var u;r[0]&65536&&n!==(n=(((u=i[33].l10n)==null?void 0:u.name)??i[33].name)+"")&&ee(l,n),r[0]&65536&&s!==(s=i[33].name)&&(e.__value=s,e.value=e.__value)},d(i){i&&T(e)}}}function Ru(t){let e,n,l,s,o,i,r,u,c,a,d,h,v,g,m,b,A,E,k,O,B,R,I,M,S,C,$,N,j,V,Q,ve,re,de,oe,q,F,K,ye,Y,pe=t[10]!=="generic"&&di(t);function be(ue,ce){if(ue[10]==="modifyAmt")return Au;if(ue[10]==="diceType")return Eu}let X=be(t),H=X&&X(t);function Z(ue,ce){if(ue[3]==="weapon")return Su;if(ue[3]==="armor")return Bu;if(ue[3]==="spell")return Ou;if(ue[3]==="stat")return Cu;if(ue[3]==="weaponType")return ku}let me=Z(t),_e=me&&me(t);return{c(){e=_("div"),n=_("div"),l=_("label"),l.textContent="名稱",s=y(),o=_("input"),i=y(),r=_("div"),u=_("label"),u.textContent="描述",c=y(),a=_("input"),d=y(),h=_("div"),v=_("label"),v.textContent="加值類型",g=y(),m=_("select"),b=_("option"),b.textContent="一般 (純文字描述)",A=_("option"),A.textContent="數值修正 (例如 +1) ",E=_("option"),E.textContent="優勢 ",k=_("option"),k.textContent="劣勢 ",O=_("option"),O.textContent="更改骰子類型",B=y(),pe&&pe.c(),R=y(),H&&H.c(),I=y(),M=_("div"),S=_("label"),S.textContent="進階條件 (選填)",C=y(),$=_("select"),N=_("option"),N.textContent="無",j=_("option"),j.textContent="特定武器",V=_("option"),V.textContent="特定防具",Q=_("option"),Q.textContent="特定法術",ve=_("option"),ve.textContent="特定屬性",re=_("option"),re.textContent="特定武器類型",de=y(),_e&&_e.c(),oe=y(),q=_("button"),F=G(t[13]),p(l,"for","name"),p(l,"class","font-bold"),p(o,"id","name"),p(o,"type","text"),p(o,"placeholder","例如：力量藥水"),p(o,"class","border p-1 rounded"),p(n,"class","flex flex-col"),p(u,"for","desc"),p(u,"class","font-bold"),p(a,"id","desc"),p(a,"placeholder","例如：力量 +2"),p(a,"class","border p-1 rounded"),p(r,"class","flex flex-col"),p(v,"for","type"),p(v,"class","font-bold"),b.__value="generic",b.value=b.__value,A.__value="modifyAmt",A.value=A.__value,E.__value="advantage",E.value=E.__value,k.__value="disadvantage",k.value=k.__value,O.__value="diceType",O.value=O.__value,p(m,"id","type"),p(m,"class","border p-1 rounded"),t[10]===void 0&&Pe(()=>t[22].call(m)),p(h,"class","flex flex-col"),p(S,"for","metaDataType"),p(S,"class","font-bold text-sm block mb-1"),N.__value="",N.value=N.__value,j.__value="weapon",j.value=j.__value,V.__value="armor",V.value=V.__value,Q.__value="spell",Q.value=Q.__value,ve.__value="stat",ve.value=ve.__value,re.__value="weaponType",re.value=re.__value,p($,"id","metaDataType"),p($,"class","border p-1 rounded w-full mb-2"),t[3]===void 0&&Pe(()=>t[26].call($)),p(M,"class","border-t pt-2 mt-2"),p(q,"class","w-full p-2 bg-black text-white mt-4 rounded shadow font-bold disabled:opacity-50 disabled:cursor-not-allowed"),q.disabled=K=!t[9],p(e,"class","flex flex-col gap-2 w-full max-h-[80vh] overflow-y-auto p-1")},m(ue,ce){w(ue,e,ce),f(e,n),f(n,l),f(n,s),f(n,o),ae(o,t[0]),f(e,i),f(e,r),f(r,u),f(r,c),f(r,a),ae(a,t[1]),f(e,d),f(e,h),f(h,v),f(h,g),f(h,m),f(m,b),f(m,A),f(m,E),f(m,k),f(m,O),he(m,t[10],!0),f(e,B),pe&&pe.m(e,null),f(e,R),H&&H.m(e,null),f(e,I),f(e,M),f(M,S),f(M,C),f(M,$),f($,N),f($,j),f($,V),f($,Q),f($,ve),f($,re),he($,t[3],!0),f(M,de),_e&&_e.m(M,null),f(e,oe),f(e,q),f(q,F),ye||(Y=[D(o,"input",t[20]),D(a,"input",t[21]),D(m,"change",t[22]),D($,"change",t[26]),D(q,"click",t[17])],ye=!0)},p(ue,ce){ce[0]&1&&o.value!==ue[0]&&ae(o,ue[0]),ce[0]&2&&a.value!==ue[1]&&ae(a,ue[1]),ce[0]&1024&&he(m,ue[10]),ue[10]!=="generic"?pe?pe.p(ue,ce):(pe=di(ue),pe.c(),pe.m(e,R)):pe&&(pe.d(1),pe=null),X===(X=be(ue))&&H?H.p(ue,ce):(H&&H.d(1),H=X&&X(ue),H&&(H.c(),H.m(e,I))),ce[0]&8&&he($,ue[3]),me===(me=Z(ue))&&_e?_e.p(ue,ce):(_e&&_e.d(1),_e=me&&me(ue),_e&&(_e.c(),_e.m(M,null))),ce[0]&8192&&ee(F,ue[13]),ce[0]&512&&K!==(K=!ue[9])&&(q.disabled=K)},i:W,o:W,d(ue){ue&&T(e),pe&&pe.d(),H&&H.d(),_e&&_e.d(),ye=!1,je(Y)}}}function Mu(t,e,n){let l,s,o,i;Me(t,Ne,q=>n(19,i=q));const r=yn();let u="",c="",a="generic",d="attackRoll",h=1,v="",g="d8",m="",b="",A="",E="",k="",O=!!u&&!!c,B="新增";function R(){let q;switch(a){case"generic":q={name:u,desc:c,type:a};break;case"modifyAmt":q={name:u,desc:c,type:a,bonusTo:d,bonusAmount:h};break;case"advantage":case"disadvantage":{q={name:u,desc:c,type:a,bonusTo:d};break}case"diceType":q={name:u,desc:c,type:a,bonusTo:d,diceType:g};break;default:return}v&&(v==="weapon"&&m?q.metadata={type:"weapon",weapon:m}:v==="weaponType"&&k?q.metadata={type:"weaponType",weaponType:k}:v==="armor"&&b?q.metadata={type:"armor",armor:b}:v==="stat"&&E?q.metadata={type:"stat",stat:E}:v==="spell"&&A&&(q.metadata={type:"spell",spell:A})),q.editable=!0,An(i,q),Ne.set(i),r("finish")}const I={attackRoll:"攻擊檢定 (Attack)",damageRoll:"傷害檢定 (Damage)",armorClass:"AC (防禦)",hp:"HP (生命)",proficiencyBonus:"熟練加值",speed:"速度",initiative:"先攻 (數值)",initiativeRoll:"先攻檢定 (Roll)",passivePerception:"被動感知",stat:"屬性值 (Score)",savingThrow:"豁免檢定",skillCheck:"技能檢定",abilityCheck:"屬性檢定 (Check)"};function M(){u=this.value,n(0,u)}function S(){c=this.value,n(1,c)}function C(){a=Ge(this),n(10,a)}function $(){d=Ge(this),n(2,d)}function N(){h=Re(this.value),n(11,h)}function j(){g=Ge(this),n(12,g)}function V(){v=Ge(this),n(3,v),n(2,d),n(0,u),n(1,c),n(7,E),n(4,m),n(5,b),n(6,A),n(8,k),n(9,O)}function Q(){m=Ge(this),n(4,m),n(2,d),n(16,l),n(19,i)}function ve(){b=Ge(this),n(5,b),n(2,d),n(15,s),n(19,i)}function re(){A=Ge(this),n(6,A),n(2,d),n(14,o),n(19,i)}function de(){E=Ge(this),n(7,E),n(2,d)}function oe(){k=Ge(this),n(8,k),n(2,d)}return t.$$.update=()=>{t.$$.dirty[0]&524288&&n(16,l=wa.concat(i.customGear.filter(q=>q.type==="Weapon").map(q=>q)??[])),t.$$.dirty[0]&524288&&n(15,s=ba.concat(i.customGear.filter(q=>q.type==="Armor").map(q=>q)??[])),t.$$.dirty[0]&524288&&n(14,o=ya.concat(i.customSpells??[])),t.$$.dirty[0]&4&&d&&(n(4,m=""),n(5,b=""),n(6,A=""),n(7,E=""),n(8,k="")),t.$$.dirty[0]&1023&&(d==="stat"?(n(3,v="stat"),n(9,O=!!u&&!!c&&!!E)):n(9,O=!!u&&!!c),v==="stat"&&!E&&n(9,O=!1),v==="weapon"&&!m&&n(9,O=!1),v==="armor"&&!b&&n(9,O=!1),v==="spell"&&!A&&n(9,O=!1),v==="weaponType"&&!k&&n(9,O=!1),n(13,B=O?"新增":"請填寫必要欄位"))},[u,c,d,v,m,b,A,E,k,O,a,h,g,B,o,s,l,R,I,i,M,S,C,$,N,j,V,Q,ve,re,de,oe]}class $u extends Oe{constructor(e){super(),Be(this,e,Mu,Ru,Ce,{},null,[-1,-1])}}function wi(t){let e,n,l;function s(i){t[4](i)}let o={$$slots:{header:[Iu],default:[Nu]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ft({props:o}),We.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&33&&(u.$$scope={dirty:r,ctx:i}),!n&&r&2&&(n=!0,u.showModal=i[1],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){U(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function Nu(t){let e,n;return e=new $u({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:W,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Iu(t){let e;return{c(){e=_("h1"),e.textContent="自訂加值",p(e,"slot","header")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function Du(t){let e,n,l,s,o,i,r=t[0]&&wi(t);return{c(){e=_("button"),e.textContent="自訂加值",n=y(),r&&r.c(),l=vt(),p(e,"class","w-full bg-black text-white p-2")},m(u,c){w(u,e,c),w(u,n,c),r&&r.m(u,c),w(u,l,c),s=!0,o||(i=D(e,"click",t[2]),o=!0)},p(u,[c]){u[0]?r?(r.p(u,c),c&1&&P(r,1)):(r=wi(u),r.c(),P(r,1),r.m(l.parentNode,l)):r&&(Fe(),U(r,1,1,()=>{r=null}),Ve())},i(u){s||(P(r),s=!0)},o(u){U(r),s=!1},d(u){u&&T(e),u&&T(n),r&&r.d(u),u&&T(l),o=!1,i()}}}function Lu(t,e,n){let l=!1,s=!1;const o=()=>{n(0,l=!0),n(1,s=!0)},i=()=>{n(0,l=!1)};function r(u){s=u,n(1,s)}return[l,s,o,i,r]}class Pu extends Oe{constructor(e){super(),Be(this,e,Lu,Du,Ce,{})}}function Ti(t,e,n){const l=t.slice();return l[6]=e[n],l}function Ei(t,e,n){const l=t.slice();return l[9]=e[n],l}function Ai(t,e,n){const l=t.slice();return l[6]=e[n],l}function ki(t,e,n){const l=t.slice();return l[9]=e[n],l}function Ci(t,e,n){const l=t.slice();return l[9]=e[n],l}function Oi(t){let e,n,l,s;return n=new ql({props:{bonus:t[9]}}),{c(){e=_("li"),ne(n.$$.fragment),l=y(),p(e,"class","border-b")},m(o,i){w(o,e,i),le(n,e,null),f(e,l),s=!0},p(o,i){const r={};i&1&&(r.bonus=o[9]),n.$set(r)},i(o){s||(P(n.$$.fragment,o),s=!0)},o(o){U(n.$$.fragment,o),s=!1},d(o){o&&T(e),se(n)}}}function Bi(t){let e,n,l,s;return l=new ql({props:{bonus:t[9]}}),{c(){e=_("li"),n=G("* "),ne(l.$$.fragment),p(e,"class","border-b ps-8 flex gap-1")},m(o,i){w(o,e,i),f(e,n),le(l,e,null),s=!0},p(o,i){const r={};i&2&&(r.bonus=o[9]),l.$set(r)},i(o){s||(P(l.$$.fragment,o),s=!0)},o(o){U(l.$$.fragment,o),s=!1},d(o){o&&T(e),se(l)}}}function Si(t){var d;let e,n,l=(((d=t[6].l10n)==null?void 0:d.name)??t[6].name)+"",s,o,i,r,u=t[6].playerBonuses,c=[];for(let h=0;h<u.length;h+=1)c[h]=Bi(ki(t,u,h));const a=h=>U(c[h],1,1,()=>{c[h]=null});return{c(){e=_("li"),n=_("div"),s=G(l),o=y(),i=_("ul");for(let h=0;h<c.length;h+=1)c[h].c();p(n,"class","font-bold bg-gray-300"),p(e,"class","border-b")},m(h,v){w(h,e,v),f(e,n),f(n,s),f(e,o),f(e,i);for(let g=0;g<c.length;g+=1)c[g]&&c[g].m(i,null);r=!0},p(h,v){var g;if((!r||v&2)&&l!==(l=(((g=h[6].l10n)==null?void 0:g.name)??h[6].name)+"")&&ee(s,l),v&2){u=h[6].playerBonuses;let m;for(m=0;m<u.length;m+=1){const b=ki(h,u,m);c[m]?(c[m].p(b,v),P(c[m],1)):(c[m]=Bi(b),c[m].c(),P(c[m],1),c[m].m(i,null))}for(Fe(),m=u.length;m<c.length;m+=1)a(m);Ve()}},i(h){if(!r){for(let v=0;v<u.length;v+=1)P(c[v]);r=!0}},o(h){c=c.filter(Boolean);for(let v=0;v<c.length;v+=1)U(c[v]);r=!1},d(h){h&&T(e),ke(c,h)}}}function Ri(t){let e,n,l,s,o;return l=new ql({props:{bonus:t[9],showInfo:!1}}),{c(){e=_("li"),n=G("* "),ne(l.$$.fragment),s=y(),p(e,"class","border-b ps-8 flex gap-1")},m(i,r){w(i,e,r),f(e,n),le(l,e,null),f(e,s),o=!0},p(i,r){const u={};r&4&&(u.bonus=i[9]),l.$set(u)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){U(l.$$.fragment,i),o=!1},d(i){i&&T(e),se(l)}}}function Mi(t){var h;let e,n,l=(((h=t[6].l10n)==null?void 0:h.name)??t[6].name)+"",s,o,i,r,u,c=t[6].playerBonuses,a=[];for(let v=0;v<c.length;v+=1)a[v]=Ri(Ei(t,c,v));const d=v=>U(a[v],1,1,()=>{a[v]=null});return{c(){e=_("li"),n=_("div"),s=G(l),o=y(),i=_("ul");for(let v=0;v<a.length;v+=1)a[v].c();r=y(),p(n,"class","font-bold bg-gray-300"),p(e,"class","border-b")},m(v,g){w(v,e,g),f(e,n),f(n,s),f(e,o),f(e,i);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(i,null);f(e,r),u=!0},p(v,g){var m;if((!u||g&4)&&l!==(l=(((m=v[6].l10n)==null?void 0:m.name)??v[6].name)+"")&&ee(s,l),g&4){c=v[6].playerBonuses;let b;for(b=0;b<c.length;b+=1){const A=Ei(v,c,b);a[b]?(a[b].p(A,g),P(a[b],1)):(a[b]=Ri(A),a[b].c(),P(a[b],1),a[b].m(i,null))}for(Fe(),b=c.length;b<a.length;b+=1)d(b);Ve()}},i(v){if(!u){for(let g=0;g<c.length;g+=1)P(a[g]);u=!0}},o(v){a=a.filter(Boolean);for(let g=0;g<a.length;g+=1)U(a[g]);u=!1},d(v){v&&T(e),ke(a,v)}}}function $i(t){let e,n;return e=new du({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Hu(t){let e,n,l,s,o,i,r,u,c,a,d=t[0].level>0&&t[0].class&&!t[0].hasCustomClass&&Ut.includes(t[0].class),h,v,g,m=t[0].bonuses.sort(t[3]),b=[];for(let S=0;S<m.length;S+=1)b[S]=Oi(Ci(t,m,S));const A=S=>U(b[S],1,1,()=>{b[S]=null});let E=t[1].sort(t[4]),k=[];for(let S=0;S<E.length;S+=1)k[S]=Si(Ai(t,E,S));const O=S=>U(k[S],1,1,()=>{k[S]=null});let B=t[2].sort(t[5]),R=[];for(let S=0;S<B.length;S+=1)R[S]=Mi(Ti(t,B,S));const I=S=>U(R[S],1,1,()=>{R[S]=null});let M=d&&$i();return v=new Pu({}),{c(){e=_("h2"),e.textContent="加值",n=y(),l=_("ul");for(let S=0;S<b.length;S+=1)b[S].c();s=y(),o=_("h2"),o.textContent="裝備加值",i=y(),r=_("ul");for(let S=0;S<k.length;S+=1)k[S].c();u=y();for(let S=0;S<R.length;S+=1)R[S].c();c=y(),a=_("div"),M&&M.c(),h=y(),ne(v.$$.fragment),p(l,"class","px-1"),p(a,"class","flex gap-1")},m(S,C){w(S,e,C),w(S,n,C),w(S,l,C);for(let $=0;$<b.length;$+=1)b[$]&&b[$].m(l,null);w(S,s,C),w(S,o,C),w(S,i,C),w(S,r,C);for(let $=0;$<k.length;$+=1)k[$]&&k[$].m(r,null);f(r,u);for(let $=0;$<R.length;$+=1)R[$]&&R[$].m(r,null);w(S,c,C),w(S,a,C),M&&M.m(a,null),f(a,h),le(v,a,null),g=!0},p(S,[C]){if(C&1){m=S[0].bonuses.sort(S[3]);let $;for($=0;$<m.length;$+=1){const N=Ci(S,m,$);b[$]?(b[$].p(N,C),P(b[$],1)):(b[$]=Oi(N),b[$].c(),P(b[$],1),b[$].m(l,null))}for(Fe(),$=m.length;$<b.length;$+=1)A($);Ve()}if(C&2){E=S[1].sort(S[4]);let $;for($=0;$<E.length;$+=1){const N=Ai(S,E,$);k[$]?(k[$].p(N,C),P(k[$],1)):(k[$]=Si(N),k[$].c(),P(k[$],1),k[$].m(r,u))}for(Fe(),$=E.length;$<k.length;$+=1)O($);Ve()}if(C&4){B=S[2].sort(S[5]);let $;for($=0;$<B.length;$+=1){const N=Ti(S,B,$);R[$]?(R[$].p(N,C),P(R[$],1)):(R[$]=Mi(N),R[$].c(),P(R[$],1),R[$].m(r,null))}for(Fe(),$=B.length;$<R.length;$+=1)I($);Ve()}C&1&&(d=S[0].level>0&&S[0].class&&!S[0].hasCustomClass&&Ut.includes(S[0].class)),d?M?C&1&&P(M,1):(M=$i(),M.c(),P(M,1),M.m(a,h)):M&&(Fe(),U(M,1,1,()=>{M=null}),Ve())},i(S){if(!g){for(let C=0;C<m.length;C+=1)P(b[C]);for(let C=0;C<E.length;C+=1)P(k[C]);for(let C=0;C<B.length;C+=1)P(R[C]);P(M),P(v.$$.fragment,S),g=!0}},o(S){b=b.filter(Boolean);for(let C=0;C<b.length;C+=1)U(b[C]);k=k.filter(Boolean);for(let C=0;C<k.length;C+=1)U(k[C]);R=R.filter(Boolean);for(let C=0;C<R.length;C+=1)U(R[C]);U(M),U(v.$$.fragment,S),g=!1},d(S){S&&T(e),S&&T(n),S&&T(l),ke(b,S),S&&T(s),S&&T(o),S&&T(i),S&&T(r),ke(k,S),ke(R,S),S&&T(c),S&&T(a),M&&M.d(),se(v)}}}function Gu(t,e,n){let l,s,o;Me(t,Ne,c=>n(0,o=c));const i=(c,a)=>Qn(c.desc,a.desc),r=(c,a)=>Qn(c.name,a.name),u=(c,a)=>Qn(c.name,a.name);return t.$$.update=()=>{t.$$.dirty&1&&n(2,l=o.gear.filter(c=>c.equipped).map(c=>nt(c.name)).filter(c=>{var a;return c&&c.canBeEquipped&&((a=c.playerBonuses)==null?void 0:a.length)>0})),t.$$.dirty&1&&n(1,s=o.gear.filter(c=>!c.equipped).map(c=>nt(c.name)).filter(c=>{var a;return c&&((a=c.playerBonuses)==null?void 0:a.length)>0&&!c.canBeEquipped}))},[o,s,l,i,r,u]}class Uu extends Oe{constructor(e){super(),Be(this,e,Gu,Hu,Ce,{})}}function Ni(t,e,n){const l=t.slice();return l[31]=e[n],l}function Fu(t,e,n){const l=t.slice();return l[34]=e[n],l[36]=n,l}function Ii(t,e,n){const l=t.slice();return l[37]=e[n],l}function Di(t){let e,n=t[37]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[37],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function Vu(t){let e,n;return{c(){e=_("option"),n=G(t[36]),e.__value=t[36],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:W,d(l){l&&T(e)}}}function Li(t){let e,n=gn(t[31])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[31],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function Pi(t){let e,n,l;return{c(){e=_("input"),p(e,"type","text"),p(e,"placeholder","材料描述 (例如: 一根樹枝)"),p(e,"class","border p-1 rounded text-sm w-full mt-1")},m(s,o){w(s,e,o),ae(e,t[11]),n||(l=D(e,"input",t[24]),n=!0)},p(s,o){o[0]&2048&&e.value!==s[11]&&ae(e,s[11])},d(s){s&&T(e),n=!1,l()}}}function ju(t){let e,n,l,s,o,i,r,u,c,a,d,h,v,g,m,b,A,E,k,O,B,R,I,M,S,C,$,N,j,V,Q,ve,re,de,oe,q,F,K,ye,Y,pe,be,X,H,Z,me,_e,ue,ce,z,te,Ae,De,x,fe,Se,L,ge,Le,we,lt,st,Wt=t[0]?"更新法術":"建立法術",Mt,Tt,qt,wn,Je=Ut,Ze=[];for(let ie=0;ie<Je.length;ie+=1)Ze[ie]=Di(Ii(t,Je,ie));let bt=Array(10),yt=[];for(let ie=0;ie<bt.length;ie+=1)yt[ie]=Vu(Fu(t,bt,ie));let St=Gt,Xe=[];for(let ie=0;ie<St.length;ie+=1)Xe[ie]=Li(Ni(t,St,ie));let xe=t[10]&&Pi(t);return{c(){e=_("div"),n=_("div"),l=_("label"),l.innerHTML='法術名稱<span class="text-red-700">*</span>',s=y(),o=_("input"),i=y(),r=_("div"),u=_("div"),c=_("label"),c.textContent="職業列表",a=y(),d=_("select");for(let ie=0;ie<Ze.length;ie+=1)Ze[ie].c();h=_("option"),h.textContent="其他",v=y(),g=_("div"),m=_("label"),m.textContent="環階 (0=戲法)",b=y(),A=_("select");for(let ie=0;ie<yt.length;ie+=1)yt[ie].c();E=y(),k=_("div"),O=_("div"),B=_("label"),B.textContent="施法關鍵屬性",R=y(),I=_("select");for(let ie=0;ie<Xe.length;ie+=1)Xe[ie].c();M=y(),S=_("div"),C=_("label"),C.textContent="距離 (例如: 60 ft)",$=y(),N=_("input"),j=y(),V=_("div"),Q=_("label"),Q.textContent="持續時間 (例如: 1 Minute)",ve=y(),re=_("div"),de=_("input"),oe=y(),q=_("div"),F=_("span"),F.textContent="構材 (Components)",K=y(),ye=_("div"),Y=_("label"),pe=_("input"),be=G(" Verbal (V)"),X=y(),H=_("label"),Z=_("input"),me=G(" Somatic (S)"),_e=y(),ue=_("label"),ce=_("input"),z=G(" Material (M)"),te=y(),xe&&xe.c(),Ae=y(),De=_("label"),x=_("input"),fe=G(" 儀式法術 (Ritual)"),Se=y(),L=_("div"),ge=_("label"),ge.innerHTML='描述<span class="text-red-700">*</span>',Le=y(),we=_("textarea"),lt=y(),st=_("button"),Mt=G(Wt),p(l,"for","spellName"),p(l,"class","font-bold"),p(o,"type","text"),p(o,"id","spellName"),p(o,"class","border p-1 rounded"),p(n,"class","flex flex-col gap-1"),p(c,"for","spellClass"),p(c,"class","font-bold"),h.__value="Other",h.value=h.__value,p(d,"id","spellClass"),p(d,"class","border p-1 rounded"),t[4]===void 0&&Pe(()=>t[16].call(d)),p(u,"class","flex flex-col w-1/2"),p(m,"for","spellTier"),p(m,"class","font-bold"),p(A,"id","spellTier"),p(A,"class","border p-1 rounded"),t[3]===void 0&&Pe(()=>t[17].call(A)),p(g,"class","flex flex-col w-1/2"),p(r,"class","flex gap-2"),p(B,"for","spellStat"),p(B,"class","font-bold"),p(I,"id","spellStat"),p(I,"class","border p-1 rounded"),t[5]===void 0&&Pe(()=>t[18].call(I)),p(O,"class","flex flex-col w-1/2"),p(C,"for","spellRange"),p(C,"class","font-bold"),p(N,"type","text"),p(N,"id","spellRange"),p(N,"class","border p-1 rounded"),p(S,"class","flex flex-col w-1/2"),p(k,"class","flex gap-2"),p(Q,"for","spellDuration"),p(Q,"class","font-bold"),p(de,"type","text"),p(de,"id","spellDuration"),p(de,"class","border p-1 rounded w-full"),p(re,"class","flex gap-2"),p(V,"class","flex flex-col gap-1"),p(F,"class","font-bold text-sm"),p(pe,"type","checkbox"),p(pe,"class","svelte-1ep1fgl"),p(Y,"class","flex items-center gap-1"),p(Z,"type","checkbox"),p(Z,"class","svelte-1ep1fgl"),p(H,"class","flex items-center gap-1"),p(ce,"type","checkbox"),p(ce,"class","svelte-1ep1fgl"),p(ue,"class","flex items-center gap-1"),p(ye,"class","flex gap-4"),p(q,"class","flex flex-col gap-1 border p-2 rounded bg-gray-50"),p(x,"type","checkbox"),p(x,"class","svelte-1ep1fgl"),p(De,"class","flex items-center gap-1 font-bold"),p(ge,"for","spellDesc"),p(ge,"class","font-bold"),p(we,"id","spellDesc"),p(we,"rows","5"),p(we,"class","border p-1 rounded"),p(L,"class","flex flex-col gap-1"),p(st,"class","bg-black text-white p-2 rounded font-bold shadow hover:bg-gray-800 transition-colors mt-2"),st.disabled=Tt=!t[13],$e(st,"opacity-50",!t[13]),p(e,"class","flex flex-col gap-2 max-h-[80vh] overflow-y-auto p-2")},m(ie,He){w(ie,e,He),f(e,n),f(n,l),f(n,s),f(n,o),ae(o,t[1]),f(e,i),f(e,r),f(r,u),f(u,c),f(u,a),f(u,d);for(let Te=0;Te<Ze.length;Te+=1)Ze[Te]&&Ze[Te].m(d,null);f(d,h),he(d,t[4],!0),f(r,v),f(r,g),f(g,m),f(g,b),f(g,A);for(let Te=0;Te<yt.length;Te+=1)yt[Te]&&yt[Te].m(A,null);he(A,t[3],!0),f(e,E),f(e,k),f(k,O),f(O,B),f(O,R),f(O,I);for(let Te=0;Te<Xe.length;Te+=1)Xe[Te]&&Xe[Te].m(I,null);he(I,t[5],!0),f(k,M),f(k,S),f(S,C),f(S,$),f(S,N),ae(N,t[6]),f(e,j),f(e,V),f(V,Q),f(V,ve),f(V,re),f(re,de),ae(de,t[7]),f(e,oe),f(e,q),f(q,F),f(q,K),f(q,ye),f(ye,Y),f(Y,pe),pe.checked=t[8],f(Y,be),f(ye,X),f(ye,H),f(H,Z),Z.checked=t[9],f(H,me),f(ye,_e),f(ye,ue),f(ue,ce),ce.checked=t[10],f(ue,z),f(q,te),xe&&xe.m(q,null),f(e,Ae),f(e,De),f(De,x),x.checked=t[12],f(De,fe),f(e,Se),f(e,L),f(L,ge),f(L,Le),f(L,we),ae(we,t[2]),f(e,lt),f(e,st),f(st,Mt),qt||(wn=[D(o,"input",t[15]),D(d,"change",t[16]),D(A,"change",t[17]),D(I,"change",t[18]),D(N,"input",t[19]),D(de,"input",t[20]),D(pe,"change",t[21]),D(Z,"change",t[22]),D(ce,"change",t[23]),D(x,"change",t[25]),D(we,"input",t[26]),D(st,"click",t[27])],qt=!0)},p(ie,He){if(He[0]&2&&o.value!==ie[1]&&ae(o,ie[1]),He&0){Je=Ut;let Te;for(Te=0;Te<Je.length;Te+=1){const $t=Ii(ie,Je,Te);Ze[Te]?Ze[Te].p($t,He):(Ze[Te]=Di($t),Ze[Te].c(),Ze[Te].m(d,h))}for(;Te<Ze.length;Te+=1)Ze[Te].d(1);Ze.length=Je.length}if(He[0]&16&&he(d,ie[4]),He[0]&8&&he(A,ie[3]),He&0){St=Gt;let Te;for(Te=0;Te<St.length;Te+=1){const $t=Ni(ie,St,Te);Xe[Te]?Xe[Te].p($t,He):(Xe[Te]=Li($t),Xe[Te].c(),Xe[Te].m(I,null))}for(;Te<Xe.length;Te+=1)Xe[Te].d(1);Xe.length=St.length}He[0]&32&&he(I,ie[5]),He[0]&64&&N.value!==ie[6]&&ae(N,ie[6]),He[0]&128&&de.value!==ie[7]&&ae(de,ie[7]),He[0]&256&&(pe.checked=ie[8]),He[0]&512&&(Z.checked=ie[9]),He[0]&1024&&(ce.checked=ie[10]),ie[10]?xe?xe.p(ie,He):(xe=Pi(ie),xe.c(),xe.m(q,null)):xe&&(xe.d(1),xe=null),He[0]&4096&&(x.checked=ie[12]),He[0]&4&&ae(we,ie[2]),He[0]&1&&Wt!==(Wt=ie[0]?"更新法術":"建立法術")&&ee(Mt,Wt),He[0]&8192&&Tt!==(Tt=!ie[13])&&(st.disabled=Tt),He[0]&8192&&$e(st,"opacity-50",!ie[13])},i:W,o:W,d(ie){ie&&T(e),ke(Ze,ie),ke(yt,ie),ke(Xe,ie),xe&&xe.d(),qt=!1,je(wn)}}}function Wu(t,e,n){var de,oe,q,F;let l,s;Me(t,Ne,K=>n(29,s=K));const o=yn();let{spellToEdit:i=void 0}=e,r=s.spells.find(K=>K.name===(i==null?void 0:i.name)),u=(i==null?void 0:i.name)??"",c=(i==null?void 0:i.desc)??"",a=(i==null?void 0:i.tier)??0,d=(i==null?void 0:i.class)??"Wizard",h=(i==null?void 0:i.stat)??"INT",v=(i==null?void 0:i.range)??"60 feet",g=(i==null?void 0:i.duration)??"Instantaneous",m=((de=i==null?void 0:i.components)==null?void 0:de.verbal)??!1,b=((oe=i==null?void 0:i.components)==null?void 0:oe.somatic)??!1,A=((q=i==null?void 0:i.components)==null?void 0:q.material)??!1,E=((F=i==null?void 0:i.components)==null?void 0:F.materialDesc)??"",k=(i==null?void 0:i.ritual)??!1;function O(){const K={editable:!0,name:u,class:d,stat:h,tier:a,range:v,duration:g,components:{verbal:m,somatic:b,material:A,materialDesc:E},ritual:k,desc:c};i?(Object.assign(i,K),r&&(r.name=K.name)):(s.spells.push({name:K.name}),s.customSpells.push(K)),Ne.set(s),o("finish")}function B(){u=this.value,n(1,u)}function R(){d=Ge(this),n(4,d)}function I(){a=Ge(this),n(3,a)}function M(){h=Ge(this),n(5,h)}function S(){v=this.value,n(6,v)}function C(){g=this.value,n(7,g)}function $(){m=this.checked,n(8,m)}function N(){b=this.checked,n(9,b)}function j(){A=this.checked,n(10,A)}function V(){E=this.value,n(11,E)}function Q(){k=this.checked,n(12,k)}function ve(){c=this.value,n(2,c)}const re=()=>O();return t.$$set=K=>{"spellToEdit"in K&&n(0,i=K.spellToEdit)},t.$$.update=()=>{t.$$.dirty[0]&6&&n(13,l=u.length>0&&c.length>0)},[i,u,c,a,d,h,v,g,m,b,A,E,k,l,O,B,R,I,M,S,C,$,N,j,V,Q,ve,re]}class Ma extends Oe{constructor(e){super(),Be(this,e,Wu,ju,Ce,{spellToEdit:0},null,[-1,-1])}}function Hi(t){let e,n,l;function s(i){t[4](i)}let o={vw:50,$$slots:{header:[zu],default:[qu]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ft({props:o}),We.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&33&&(u.$$scope={dirty:r,ctx:i}),!n&&r&2&&(n=!0,u.showModal=i[1],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){U(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function qu(t){let e,n;return e=new Ma({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:W,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function zu(t){let e;return{c(){e=_("h1"),e.textContent="Custom Spell",p(e,"slot","header")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function Yu(t){let e,n,l,s,o,i,r=t[0]&&Hi(t);return{c(){e=_("button"),e.textContent="Custom Spell",n=y(),r&&r.c(),l=vt(),p(e,"class","bg-black text-white w-full")},m(u,c){w(u,e,c),w(u,n,c),r&&r.m(u,c),w(u,l,c),s=!0,o||(i=D(e,"click",t[2]),o=!0)},p(u,[c]){u[0]?r?(r.p(u,c),c&1&&P(r,1)):(r=Hi(u),r.c(),P(r,1),r.m(l.parentNode,l)):r&&(Fe(),U(r,1,1,()=>{r=null}),Ve())},i(u){s||(P(r),s=!0)},o(u){U(r),s=!1},d(u){u&&T(e),u&&T(n),r&&r.d(u),u&&T(l),o=!1,i()}}}function Ku(t,e,n){let l=!1,s=!1;const o=()=>{n(0,l=!0),n(1,s=!0)},i=()=>n(0,l=!1);function r(u){s=u,n(1,s)}return[l,s,o,i,r]}class Xu extends Oe{constructor(e){super(),Be(this,e,Ku,Yu,Ce,{})}}function Gi(t,{delay:e=0,duration:n=400,easing:l=ur}={}){const s=+getComputedStyle(t).opacity;return{delay:e,duration:n,easing:l,css:o=>`opacity: ${o*s}`}}const $a={};function Ju(t){let e,n,l,s,o,i;const r=t[5].default,u=Rn(r,t,t[4],null);return{c(){e=y(),n=_("div"),u&&u.c(),En(n,"top",t[1]+"px"),En(n,"left",t[0]+"px"),p(n,"class","svelte-zimeji")},m(c,a){w(c,e,a),w(c,n,a),u&&u.m(n,null),t[6](n),s=!0,o||(i=D(document.body,"click",t[3]),o=!0)},p(c,[a]){u&&u.p&&(!s||a&16)&&Mn(u,r,c,c[4],s?Nn(r,c[4],a,null):$n(c[4]),null),(!s||a&2)&&En(n,"top",c[1]+"px"),(!s||a&1)&&En(n,"left",c[0]+"px")},i(c){s||(P(u,c),Pe(()=>{s&&(l||(l=bs(n,Gi,{duration:100},!0)),l.run(1))}),s=!0)},o(c){U(u,c),l||(l=bs(n,Gi,{duration:100},!1)),l.run(0),s=!1},d(c){c&&T(e),c&&T(n),u&&u.d(c),t[6](null),c&&l&&l.end(),o=!1,i()}}}function Zu(t,e,n){let{$$slots:l={},$$scope:s}=e,{x:o}=e,{y:i}=e,r;const u=yn();cr($a,{dispatchClick:()=>u("click")});function c(d){d.target===r||r.contains(d.target)||u("clickoutside")}function a(d){We[d?"unshift":"push"](()=>{r=d,n(2,r)})}return t.$$set=d=>{"x"in d&&n(0,o=d.x),"y"in d&&n(1,i=d.y),"$$scope"in d&&n(4,s=d.$$scope)},t.$$.update=()=>{if(t.$$.dirty&7&&r){const d=r.getBoundingClientRect();n(0,o=Math.min(window.innerWidth-d.width,o)),n(1,i=Math.min(window.innerHeight-d.height,i))}},[o,i,r,c,s,l,a]}class Qu extends Oe{constructor(e){super(),Be(this,e,Zu,Ju,Ce,{x:0,y:1})}}function xu(t){let e;const n=t[4].default,l=Rn(n,t,t[3],null);return{c(){l&&l.c()},m(s,o){l&&l.m(s,o),e=!0},p(s,o){l&&l.p&&(!e||o&8)&&Mn(l,n,s,s[3],e?Nn(n,s[3],o,null):$n(s[3]),null)},i(s){e||(P(l,s),e=!0)},o(s){U(l,s),e=!1},d(s){l&&l.d(s)}}}function ec(t){let e;return{c(){e=G(t[1])},m(n,l){w(n,e,l)},p(n,l){l&2&&ee(e,n[1])},i:W,o:W,d(n){n&&T(e)}}}function tc(t){let e,n,l,s,o,i;const r=[ec,xu],u=[];function c(a,d){return a[1]?0:1}return n=c(t),l=u[n]=r[n](t),{c(){e=_("div"),l.c(),p(e,"class","active:bg-gray-100 svelte-12ogry0"),$e(e,"disabled",t[0])},m(a,d){w(a,e,d),u[n].m(e,null),s=!0,o||(i=D(e,"click",t[2]),o=!0)},p(a,[d]){let h=n;n=c(a),n===h?u[n].p(a,d):(Fe(),U(u[h],1,1,()=>{u[h]=null}),Ve(),l=u[n],l?l.p(a,d):(l=u[n]=r[n](a),l.c()),P(l,1),l.m(e,null)),(!s||d&1)&&$e(e,"disabled",a[0])},i(a){s||(P(l),s=!0)},o(a){U(l),s=!1},d(a){a&&T(e),u[n].d(),o=!1,i()}}}function nc(t,e,n){let{$$slots:l={},$$scope:s}=e,{isDisabled:o=!1}=e,{text:i=""}=e;const r=yn(),{dispatchClick:u}=fr($a),c=()=>{o||(r("click"),u())};return t.$$set=a=>{"isDisabled"in a&&n(0,o=a.isDisabled),"text"in a&&n(1,i=a.text),"$$scope"in a&&n(3,s=a.$$scope)},[o,i,c,s,l]}class qn extends Oe{constructor(e){super(),Be(this,e,nc,tc,Ce,{isDisabled:0,text:1})}}var at=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class lc{constructor(e){this.messageBus=e}get id(){if(!this.messageBus.userId)throw Error("Unable to get user ID: not ready");return this.messageBus.userId}getSelection(){return at(this,void 0,void 0,function*(){const{selection:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SELECTION",{});return e})}select(e,n){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:e,replace:n})})}deselect(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_DESELECT",{items:e})})}getName(){return at(this,void 0,void 0,function*(){const{name:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_NAME",{});return e})}setName(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_NAME",{name:e})})}getColor(){return at(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_COLOR",{});return e})}setColor(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_COLOR",{color:e})})}getSyncView(){return at(this,void 0,void 0,function*(){const{syncView:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_SYNC_VIEW",{});return e})}setSyncView(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_SYNC_VIEW",{syncView:e})})}getId(){return at(this,void 0,void 0,function*(){const{id:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ID",{});return e})}getRole(){return at(this,void 0,void 0,function*(){const{role:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_ROLE",{});return e})}getMetadata(){return at(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_METADATA",{});return e})}setMetadata(e){return at(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_PLAYER_SET_METADATA",{update:e})})}hasPermission(e){return at(this,void 0,void 0,function*(){if((yield this.getRole())==="GM")return!0;const{permissions:l}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return l.indexOf(e)>-1})}getConnectionId(){return at(this,void 0,void 0,function*(){const{connectionId:e}=yield this.messageBus.sendAsync("OBR_PLAYER_GET_CONNECTION_ID",{});return e})}onChange(e){const n=l=>{e(l.player)};return this.messageBus.send("OBR_PLAYER_SUBSCRIBE",{}),this.messageBus.on("OBR_PLAYER_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PLAYER_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PLAYER_EVENT_CHANGE",n)}}}var wt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class sc{constructor(e){this.messageBus=e}reset(){return wt(this,void 0,void 0,function*(){const{transform:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_RESET",{});return e})}animateTo(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO",{transform:e})})}animateToBounds(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_ANIMATE_TO_BOUNDS",{bounds:e})})}getPosition(){return wt(this,void 0,void 0,function*(){const{position:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_POSITION",{});return e})}setPosition(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_POSITION",{position:e})})}getScale(){return wt(this,void 0,void 0,function*(){const{scale:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_SCALE",{});return e})}setScale(e){return wt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_VIEWPORT_SET_SCALE",{scale:e})})}getWidth(){return wt(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_WIDTH",{});return e})}getHeight(){return wt(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_VIEWPORT_GET_HEIGHT",{});return e})}transformPoint(e){return wt(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_TRANSFORM_POINT",{point:e});return n})}inverseTransformPoint(e){return wt(this,void 0,void 0,function*(){const{point:n}=yield this.messageBus.sendAsync("OBR_VIEWPORT_INVERSE_TRANSFORM_POINT",{point:e});return n})}}function ic(t){return typeof t.id=="string"}var ll={},oc={get exports(){return ll},set exports(t){ll=t}},_n=typeof Reflect=="object"?Reflect:null,Ui=_n&&typeof _n.apply=="function"?_n.apply:function(e,n,l){return Function.prototype.apply.call(e,n,l)},xn;_n&&typeof _n.ownKeys=="function"?xn=_n.ownKeys:Object.getOwnPropertySymbols?xn=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:xn=function(e){return Object.getOwnPropertyNames(e)};function ac(t){console&&console.warn&&console.warn(t)}var Na=Number.isNaN||function(e){return e!==e};function Ie(){Ie.init.call(this)}oc.exports=Ie;ll.once=fc;Ie.EventEmitter=Ie;Ie.prototype._events=void 0;Ie.prototype._eventsCount=0;Ie.prototype._maxListeners=void 0;var Fi=10;function rl(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Ie,"defaultMaxListeners",{enumerable:!0,get:function(){return Fi},set:function(t){if(typeof t!="number"||t<0||Na(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Fi=t}});Ie.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};Ie.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Na(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Ia(t){return t._maxListeners===void 0?Ie.defaultMaxListeners:t._maxListeners}Ie.prototype.getMaxListeners=function(){return Ia(this)};Ie.prototype.emit=function(e){for(var n=[],l=1;l<arguments.length;l++)n.push(arguments[l]);var s=e==="error",o=this._events;if(o!==void 0)s=s&&o.error===void 0;else if(!s)return!1;if(s){var i;if(n.length>0&&(i=n[0]),i instanceof Error)throw i;var r=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw r.context=i,r}var u=o[e];if(u===void 0)return!1;if(typeof u=="function")Ui(u,this,n);else for(var c=u.length,a=Ga(u,c),l=0;l<c;++l)Ui(a[l],this,n);return!0};function Da(t,e,n,l){var s,o,i;if(rl(n),o=t._events,o===void 0?(o=t._events=Object.create(null),t._eventsCount=0):(o.newListener!==void 0&&(t.emit("newListener",e,n.listener?n.listener:n),o=t._events),i=o[e]),i===void 0)i=o[e]=n,++t._eventsCount;else if(typeof i=="function"?i=o[e]=l?[n,i]:[i,n]:l?i.unshift(n):i.push(n),s=Ia(t),s>0&&i.length>s&&!i.warned){i.warned=!0;var r=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");r.name="MaxListenersExceededWarning",r.emitter=t,r.type=e,r.count=i.length,ac(r)}return t}Ie.prototype.addListener=function(e,n){return Da(this,e,n,!1)};Ie.prototype.on=Ie.prototype.addListener;Ie.prototype.prependListener=function(e,n){return Da(this,e,n,!0)};function rc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function La(t,e,n){var l={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},s=rc.bind(l);return s.listener=n,l.wrapFn=s,s}Ie.prototype.once=function(e,n){return rl(n),this.on(e,La(this,e,n)),this};Ie.prototype.prependOnceListener=function(e,n){return rl(n),this.prependListener(e,La(this,e,n)),this};Ie.prototype.removeListener=function(e,n){var l,s,o,i,r;if(rl(n),s=this._events,s===void 0)return this;if(l=s[e],l===void 0)return this;if(l===n||l.listener===n)--this._eventsCount===0?this._events=Object.create(null):(delete s[e],s.removeListener&&this.emit("removeListener",e,l.listener||n));else if(typeof l!="function"){for(o=-1,i=l.length-1;i>=0;i--)if(l[i]===n||l[i].listener===n){r=l[i].listener,o=i;break}if(o<0)return this;o===0?l.shift():uc(l,o),l.length===1&&(s[e]=l[0]),s.removeListener!==void 0&&this.emit("removeListener",e,r||n)}return this};Ie.prototype.off=Ie.prototype.removeListener;Ie.prototype.removeAllListeners=function(e){var n,l,s;if(l=this._events,l===void 0)return this;if(l.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):l[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete l[e]),this;if(arguments.length===0){var o=Object.keys(l),i;for(s=0;s<o.length;++s)i=o[s],i!=="removeListener"&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(n=l[e],typeof n=="function")this.removeListener(e,n);else if(n!==void 0)for(s=n.length-1;s>=0;s--)this.removeListener(e,n[s]);return this};function Pa(t,e,n){var l=t._events;if(l===void 0)return[];var s=l[e];return s===void 0?[]:typeof s=="function"?n?[s.listener||s]:[s]:n?cc(s):Ga(s,s.length)}Ie.prototype.listeners=function(e){return Pa(this,e,!0)};Ie.prototype.rawListeners=function(e){return Pa(this,e,!1)};Ie.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):Ha.call(t,e)};Ie.prototype.listenerCount=Ha;function Ha(t){var e=this._events;if(e!==void 0){var n=e[t];if(typeof n=="function")return 1;if(n!==void 0)return n.length}return 0}Ie.prototype.eventNames=function(){return this._eventsCount>0?xn(this._events):[]};function Ga(t,e){for(var n=new Array(e),l=0;l<e;++l)n[l]=t[l];return n}function uc(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function cc(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function fc(t,e){return new Promise(function(n,l){function s(i){t.removeListener(e,o),l(i)}function o(){typeof t.removeListener=="function"&&t.removeListener("error",s),n([].slice.call(arguments))}Ua(t,e,o,{once:!0}),e!=="error"&&dc(t,s,{once:!0})})}function dc(t,e,n){typeof t.on=="function"&&Ua(t,"error",e,n)}function Ua(t,e,n,l){if(typeof t.on=="function")l.once?t.once(e,n):t.on(e,n);else if(typeof t.addEventListener=="function")t.addEventListener(e,function s(o){l.once&&t.removeEventListener(e,s),n(o)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}let zn;const pc=new Uint8Array(16);function _c(){if(!zn&&(zn=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!zn))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return zn(pc)}const tt=[];for(let t=0;t<256;++t)tt.push((t+256).toString(16).slice(1));function hc(t,e=0){return(tt[t[e+0]]+tt[t[e+1]]+tt[t[e+2]]+tt[t[e+3]]+"-"+tt[t[e+4]]+tt[t[e+5]]+"-"+tt[t[e+6]]+tt[t[e+7]]+"-"+tt[t[e+8]]+tt[t[e+9]]+"-"+tt[t[e+10]]+tt[t[e+11]]+tt[t[e+12]]+tt[t[e+13]]+tt[t[e+14]]+tt[t[e+15]]).toLowerCase()}const mc=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Vi={randomUUID:mc};function gc(t,e,n){if(Vi.randomUUID&&!e&&!t)return Vi.randomUUID();t=t||{};const l=t.random||(t.rng||_c)();if(l[6]=l[6]&15|64,l[8]=l[8]&63|128,e){n=n||0;for(let s=0;s<16;++s)e[n+s]=l[s];return e}return hc(l)}class vc extends ll.EventEmitter{constructor(e,n){super(),this.ready=!1,this.userId=null,this.ref=null,this.handleMessage=l=>{const s=l.data;if(l.origin===this.targetOrigin&&ic(s)){if(s.id==="OBR_READY"){this.ready=!0;const o=s.data;this.ref=o.ref,this.userId=o.userId}this.emit(s.id,s.data)}},this.send=(l,s,o)=>{var i;if(!this.ref)throw Error("Unable to send message: not ready");(i=window.parent)===null||i===void 0||i.postMessage({id:l,data:s,ref:this.ref,nonce:o},this.targetOrigin)},this.sendAsync=(l,s,o=5e3)=>{const i=`_${gc()}`;return this.send(l,s,i),Promise.race([new Promise((r,u)=>{const c=this;function a(h){c.off(`${l}_RESPONSE${i}`,a),c.off(`${l}_ERROR${i}`,d),r(h)}function d(h){c.off(`${l}_RESPONSE${i}`,a),c.off(`${l}_ERROR${i}`,d),u(h)}this.on(`${l}_RESPONSE${i}`,a),this.on(`${l}_ERROR${i}`,d)}),...o>0?[new Promise((r,u)=>window.setTimeout(()=>u(new Error(`Message ${l} took longer than ${o}ms to get a result`)),o))]:[]])},this.roomId=n,this.targetOrigin=e,window.addEventListener("message",this.handleMessage),this.setMaxListeners(100)}destroy(){window.removeEventListener("message",this.handleMessage)}}var ji=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class bc{constructor(e){this.messageBus=e}show(e,n){return ji(this,void 0,void 0,function*(){const{id:l}=yield this.messageBus.sendAsync("OBR_NOTIFICATION_SHOW",{message:e,variant:n});return l})}close(e){return ji(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_NOTIFICATION_CLOSE",{id:e})})}}var un=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class yc{constructor(e){this.messageBus=e}getColor(){return un(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_COLOR",{});return e})}setColor(e){return un(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_COLOR",{color:e})})}getStrokeWidth(){return un(this,void 0,void 0,function*(){const{strokeWidth:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_STROKE_WIDTH",{});return e})}setStrokeWidth(e){return un(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_STROKE_WIDTH",{strokeWidth:e})})}getFilled(){return un(this,void 0,void 0,function*(){const{filled:e}=yield this.messageBus.sendAsync("OBR_SCENE_FOG_GET_FILLED",{});return e})}setFilled(e){return un(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_FOG_SET_FILLED",{filled:e})})}onChange(e){const n=l=>{e(l.fog)};return this.messageBus.send("OBR_SCENE_FOG_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_FOG_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_FOG_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_FOG_EVENT_CHANGE",n)}}}var rt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class wc{constructor(e){this.messageBus=e}getDpi(){return rt(this,void 0,void 0,function*(){const{dpi:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DPI",{});return e})}getScale(){return rt(this,void 0,void 0,function*(){return yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_SCALE",{})})}setScale(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_SCALE",{scale:e})})}getColor(){return rt(this,void 0,void 0,function*(){const{color:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_COLOR",{});return e})}setColor(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_COLOR",{color:e})})}getOpacity(){return rt(this,void 0,void 0,function*(){const{opacity:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_OPACITY",{});return e})}setOpacity(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_OPACITY",{opacity:e})})}getType(){return rt(this,void 0,void 0,function*(){const{type:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_TYPE",{});return e})}setType(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_TYPE",{type:e})})}getLineType(){return rt(this,void 0,void 0,function*(){const{lineType:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_LINE_TYPE",{});return e})}setLineType(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_LINE_TYPE",{lineType:e})})}getMeasurement(){return rt(this,void 0,void 0,function*(){const{measurement:e}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_MEASUREMENT",{});return e})}setMeasurement(e){return rt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_GRID_SET_MEASUREMENT",{measurement:e})})}snapPosition(e,n,l,s){return rt(this,void 0,void 0,function*(){const{position:o}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_SNAP_POSITION",{position:e,snappingSensitivity:n,useCorners:l,useCenter:s});return o})}getDistance(e,n){return rt(this,void 0,void 0,function*(){const{distance:l}=yield this.messageBus.sendAsync("OBR_SCENE_GRID_GET_DISTANCE",{from:e,to:n});return l})}onChange(e){const n=l=>{e(l.grid)};return this.messageBus.send("OBR_SCENE_GRID_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_GRID_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_GRID_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_GRID_EVENT_CHANGE",n)}}}var Yn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Tc{constructor(e){this.messageBus=e}undo(){return Yn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_UNDO",{})})}redo(){return Yn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_REDO",{})})}canUndo(){return Yn(this,void 0,void 0,function*(){const{canUndo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_UNDO",{});return e})}canRedo(){return Yn(this,void 0,void 0,function*(){const{canRedo:e}=yield this.messageBus.sendAsync("OBR_SCENE_HISTORY_CAN_REDO",{});return e})}}function it(t){for(var e=arguments.length,n=Array(e>1?e-1:0),l=1;l<e;l++)n[l-1]=arguments[l];throw Error("[Immer] minified error nr: "+t+(n.length?" "+n.map(function(s){return"'"+s+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function Qt(t){return!!t&&!!t[ht]}function Vt(t){var e;return!!t&&(function(n){if(!n||typeof n!="object")return!1;var l=Object.getPrototypeOf(n);if(l===null)return!0;var s=Object.hasOwnProperty.call(l,"constructor")&&l.constructor;return s===Object||typeof s=="function"&&Function.toString.call(s)===Rc}(t)||Array.isArray(t)||!!t[On]||!!(!((e=t.constructor)===null||e===void 0)&&e[On])||ul(t)||cl(t))}function vn(t,e,n){n===void 0&&(n=!1),jt(t)===0?(n?Object.keys:Ql)(t).forEach(function(l){n&&typeof l=="symbol"||e(l,t[l],t)}):t.forEach(function(l,s){return e(s,l,t)})}function jt(t){var e=t[ht];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:ul(t)?2:cl(t)?3:0}function Ln(t,e){return jt(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function el(t,e){return jt(t)===2?t.get(e):t[e]}function Fa(t,e,n){var l=jt(t);l===2?t.set(e,n):l===3?t.add(n):t[e]=n}function Ec(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function ul(t){return Bc&&t instanceof Map}function cl(t){return Sc&&t instanceof Set}function Xt(t){return t.o||t.t}function zl(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=Mc(t);delete e[ht];for(var n=Ql(e),l=0;l<n.length;l++){var s=n[l],o=e[s];o.writable===!1&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(e[s]={configurable:!0,writable:!0,enumerable:o.enumerable,value:t[s]})}return Object.create(Object.getPrototypeOf(t),e)}function Yl(t,e){return e===void 0&&(e=!1),Kl(t)||Qt(t)||!Vt(t)||(jt(t)>1&&(t.set=t.add=t.clear=t.delete=Ac),Object.freeze(t),e&&vn(t,function(n,l){return Yl(l,!0)},!0)),t}function Ac(){it(2)}function Kl(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function Ot(t){var e=Ml[t];return e||it(18,t),e}function kc(t,e){Ml[t]||(Ml[t]=e)}function Wi(){return Pn}function gl(t,e){e&&(Ot("Patches"),t.u=[],t.s=[],t.v=e)}function sl(t){Bl(t),t.p.forEach(Cc),t.p=null}function Bl(t){t===Pn&&(Pn=t.l)}function qi(t){return Pn={p:[],l:Pn,h:t,m:!0,_:0}}function Cc(t){var e=t[ht];e.i===0||e.i===1?e.j():e.g=!0}function vl(t,e){e._=e.p.length;var n=e.p[0],l=t!==void 0&&t!==n;return e.h.O||Ot("ES5").S(e,t,l),l?(n[ht].P&&(sl(e),it(4)),Vt(t)&&(t=il(e,t),e.l||ol(e,t)),e.u&&Ot("Patches").M(n[ht].t,t,e.u,e.s)):t=il(e,n,[]),sl(e),e.u&&e.v(e.u,e.s),t!==Zl?t:void 0}function il(t,e,n){if(Kl(e))return e;var l=e[ht];if(!l)return vn(e,function(r,u){return zi(t,l,e,r,u,n)},!0),e;if(l.A!==t)return e;if(!l.P)return ol(t,l.t,!0),l.t;if(!l.I){l.I=!0,l.A._--;var s=l.i===4||l.i===5?l.o=zl(l.k):l.o,o=s,i=!1;l.i===3&&(o=new Set(s),s.clear(),i=!0),vn(o,function(r,u){return zi(t,l,s,r,u,n,i)}),ol(t,s,!1),n&&t.u&&Ot("Patches").N(l,n,t.u,t.s)}return l.o}function zi(t,e,n,l,s,o,i){if(Qt(s)){var r=il(t,s,o&&e&&e.i!==3&&!Ln(e.R,l)?o.concat(l):void 0);if(Fa(n,l,r),!Qt(r))return;t.m=!1}else i&&n.add(s);if(Vt(s)&&!Kl(s)){if(!t.h.D&&t._<1)return;il(t,s),e&&e.A.l||ol(t,s)}}function ol(t,e,n){n===void 0&&(n=!1),!t.l&&t.h.D&&t.m&&Yl(e,n)}function bl(t,e){var n=t[ht];return(n?Xt(n):t)[e]}function Yi(t,e){if(e in t)for(var n=Object.getPrototypeOf(t);n;){var l=Object.getOwnPropertyDescriptor(n,e);if(l)return l;n=Object.getPrototypeOf(n)}}function Sl(t){t.P||(t.P=!0,t.l&&Sl(t.l))}function yl(t){t.o||(t.o=zl(t.t))}function Rl(t,e,n){var l=ul(e)?Ot("MapSet").F(e,n):cl(e)?Ot("MapSet").T(e,n):t.O?function(s,o){var i=Array.isArray(s),r={i:i?1:0,A:o?o.A:Wi(),P:!1,I:!1,R:{},l:o,t:s,k:null,o:null,j:null,C:!1},u=r,c=$l;i&&(u=[r],c=kn);var a=Proxy.revocable(u,c),d=a.revoke,h=a.proxy;return r.k=h,r.j=d,h}(e,n):Ot("ES5").J(e,n);return(n?n.A:Wi()).p.push(l),l}function Oc(t){return Qt(t)||it(22,t),function e(n){if(!Vt(n))return n;var l,s=n[ht],o=jt(n);if(s){if(!s.P&&(s.i<4||!Ot("ES5").K(s)))return s.t;s.I=!0,l=Ki(n,o),s.I=!1}else l=Ki(n,o);return vn(l,function(i,r){s&&el(s.t,i)===r||Fa(l,i,e(r))}),o===3?new Set(l):l}(t)}function Ki(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return zl(t)}function Xl(){function t(l){if(!Vt(l))return l;if(Array.isArray(l))return l.map(t);if(ul(l))return new Map(Array.from(l.entries()).map(function(i){return[i[0],t(i[1])]}));if(cl(l))return new Set(Array.from(l).map(t));var s=Object.create(Object.getPrototypeOf(l));for(var o in l)s[o]=t(l[o]);return Ln(l,On)&&(s[On]=l[On]),s}function e(l){return Qt(l)?t(l):l}var n="add";kc("Patches",{$:function(l,s){return s.forEach(function(o){for(var i=o.path,r=o.op,u=l,c=0;c<i.length-1;c++){var a=jt(u),d=i[c];typeof d!="string"&&typeof d!="number"&&(d=""+d),a!==0&&a!==1||d!=="__proto__"&&d!=="constructor"||it(24),typeof u=="function"&&d==="prototype"&&it(24),typeof(u=el(u,d))!="object"&&it(15,i.join("/"))}var h=jt(u),v=t(o.value),g=i[i.length-1];switch(r){case"replace":switch(h){case 2:return u.set(g,v);case 3:it(16);default:return u[g]=v}case n:switch(h){case 1:return g==="-"?u.push(v):u.splice(g,0,v);case 2:return u.set(g,v);case 3:return u.add(v);default:return u[g]=v}case"remove":switch(h){case 1:return u.splice(g,1);case 2:return u.delete(g);case 3:return u.delete(o.value);default:return delete u[g]}default:it(17,r)}}),l},N:function(l,s,o,i){switch(l.i){case 0:case 4:case 2:return function(r,u,c,a){var d=r.t,h=r.o;vn(r.R,function(v,g){var m=el(d,v),b=el(h,v),A=g?Ln(d,v)?"replace":n:"remove";if(m!==b||A!=="replace"){var E=u.concat(v);c.push(A==="remove"?{op:A,path:E}:{op:A,path:E,value:b}),a.push(A===n?{op:"remove",path:E}:A==="remove"?{op:n,path:E,value:e(m)}:{op:"replace",path:E,value:e(m)})}})}(l,s,o,i);case 5:case 1:return function(r,u,c,a){var d=r.t,h=r.R,v=r.o;if(v.length<d.length){var g=[v,d];d=g[0],v=g[1];var m=[a,c];c=m[0],a=m[1]}for(var b=0;b<d.length;b++)if(h[b]&&v[b]!==d[b]){var A=u.concat([b]);c.push({op:"replace",path:A,value:e(v[b])}),a.push({op:"replace",path:A,value:e(d[b])})}for(var E=d.length;E<v.length;E++){var k=u.concat([E]);c.push({op:n,path:k,value:e(v[E])})}d.length<v.length&&a.push({op:"replace",path:u.concat(["length"]),value:d.length})}(l,s,o,i);case 3:return function(r,u,c,a){var d=r.t,h=r.o,v=0;d.forEach(function(g){if(!h.has(g)){var m=u.concat([v]);c.push({op:"remove",path:m,value:g}),a.unshift({op:n,path:m,value:g})}v++}),v=0,h.forEach(function(g){if(!d.has(g)){var m=u.concat([v]);c.push({op:n,path:m,value:g}),a.unshift({op:"remove",path:m,value:g})}v++})}(l,s,o,i)}},M:function(l,s,o,i){o.push({op:"replace",path:[],value:s===Zl?void 0:s}),i.push({op:"replace",path:[],value:l})}})}var Xi,Pn,Jl=typeof Symbol<"u"&&typeof Symbol("x")=="symbol",Bc=typeof Map<"u",Sc=typeof Set<"u",Ji=typeof Proxy<"u"&&Proxy.revocable!==void 0&&typeof Reflect<"u",Zl=Jl?Symbol.for("immer-nothing"):((Xi={})["immer-nothing"]=!0,Xi),On=Jl?Symbol.for("immer-draftable"):"__$immer_draftable",ht=Jl?Symbol.for("immer-state"):"__$immer_state",Rc=""+Object.prototype.constructor,Ql=typeof Reflect<"u"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,Mc=Object.getOwnPropertyDescriptors||function(t){var e={};return Ql(t).forEach(function(n){e[n]=Object.getOwnPropertyDescriptor(t,n)}),e},Ml={},$l={get:function(t,e){if(e===ht)return t;var n=Xt(t);if(!Ln(n,e))return function(s,o,i){var r,u=Yi(o,i);return u?"value"in u?u.value:(r=u.get)===null||r===void 0?void 0:r.call(s.k):void 0}(t,n,e);var l=n[e];return t.I||!Vt(l)?l:l===bl(t.t,e)?(yl(t),t.o[e]=Rl(t.A.h,l,t)):l},has:function(t,e){return e in Xt(t)},ownKeys:function(t){return Reflect.ownKeys(Xt(t))},set:function(t,e,n){var l=Yi(Xt(t),e);if(l!=null&&l.set)return l.set.call(t.k,n),!0;if(!t.P){var s=bl(Xt(t),e),o=s==null?void 0:s[ht];if(o&&o.t===n)return t.o[e]=n,t.R[e]=!1,!0;if(Ec(n,s)&&(n!==void 0||Ln(t.t,e)))return!0;yl(t),Sl(t)}return t.o[e]===n&&(n!==void 0||e in t.o)||Number.isNaN(n)&&Number.isNaN(t.o[e])||(t.o[e]=n,t.R[e]=!0),!0},deleteProperty:function(t,e){return bl(t.t,e)!==void 0||e in t.t?(t.R[e]=!1,yl(t),Sl(t)):delete t.R[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var n=Xt(t),l=Reflect.getOwnPropertyDescriptor(n,e);return l&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:l.enumerable,value:n[e]}},defineProperty:function(){it(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){it(12)}},kn={};vn($l,function(t,e){kn[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),kn.deleteProperty=function(t,e){return kn.set.call(this,t,e,void 0)},kn.set=function(t,e,n){return $l.set.call(this,t[0],e,n,t[0])};var $c=function(){function t(n){var l=this;this.O=Ji,this.D=!0,this.produce=function(s,o,i){if(typeof s=="function"&&typeof o!="function"){var r=o;o=s;var u=l;return function(m){var b=this;m===void 0&&(m=r);for(var A=arguments.length,E=Array(A>1?A-1:0),k=1;k<A;k++)E[k-1]=arguments[k];return u.produce(m,function(O){var B;return(B=o).call.apply(B,[b,O].concat(E))})}}var c;if(typeof o!="function"&&it(6),i!==void 0&&typeof i!="function"&&it(7),Vt(s)){var a=qi(l),d=Rl(l,s,void 0),h=!0;try{c=o(d),h=!1}finally{h?sl(a):Bl(a)}return typeof Promise<"u"&&c instanceof Promise?c.then(function(m){return gl(a,i),vl(m,a)},function(m){throw sl(a),m}):(gl(a,i),vl(c,a))}if(!s||typeof s!="object"){if((c=o(s))===void 0&&(c=s),c===Zl&&(c=void 0),l.D&&Yl(c,!0),i){var v=[],g=[];Ot("Patches").M(s,c,v,g),i(v,g)}return c}it(21,s)},this.produceWithPatches=function(s,o){if(typeof s=="function")return function(c){for(var a=arguments.length,d=Array(a>1?a-1:0),h=1;h<a;h++)d[h-1]=arguments[h];return l.produceWithPatches(c,function(v){return s.apply(void 0,[v].concat(d))})};var i,r,u=l.produce(s,o,function(c,a){i=c,r=a});return typeof Promise<"u"&&u instanceof Promise?u.then(function(c){return[c,i,r]}):[u,i,r]},typeof(n==null?void 0:n.useProxies)=="boolean"&&this.setUseProxies(n.useProxies),typeof(n==null?void 0:n.autoFreeze)=="boolean"&&this.setAutoFreeze(n.autoFreeze)}var e=t.prototype;return e.createDraft=function(n){Vt(n)||it(8),Qt(n)&&(n=Oc(n));var l=qi(this),s=Rl(this,n,void 0);return s[ht].C=!0,Bl(l),s},e.finishDraft=function(n,l){var s=n&&n[ht],o=s.A;return gl(o,l),vl(void 0,o)},e.setAutoFreeze=function(n){this.D=n},e.setUseProxies=function(n){n&&!Ji&&it(20),this.O=n},e.applyPatches=function(n,l){var s;for(s=l.length-1;s>=0;s--){var o=l[s];if(o.path.length===0&&o.op==="replace"){n=o.value;break}}s>-1&&(l=l.slice(s+1));var i=Ot("Patches").$;return Qt(n)?i(n,l):this.produce(n,function(r){return i(r,l)})},t}(),mt=new $c;mt.produce;var xl=mt.produceWithPatches.bind(mt);mt.setAutoFreeze.bind(mt);mt.setUseProxies.bind(mt);mt.applyPatches.bind(mt);mt.createDraft.bind(mt);mt.finishDraft.bind(mt);var cn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};Xl();class Nc{constructor(e){this.messageBus=e}getItems(e){return cn(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ALL_ITEMS",{});return n}})}isItemArray(e){return Array.isArray(e)&&e.every(n=>typeof n!="string")}updateItems(e,n,l=!0){return cn(this,void 0,void 0,function*(){let s;this.isItemArray(e)?s=e:s=yield this.getItems(e);const[o,i]=xl(s,n),r=o.map(c=>({id:c.id,type:c.type}));for(const c of i){const[a,d]=c.path;typeof a=="number"&&typeof d=="string"&&(r[a][d]=o[a][d])}const u=r.filter(c=>Object.keys(c).length>2);u.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_UPDATE_ITEMS",{updates:u,updateAttachments:l}))})}addItems(e){return cn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_ADD_ITEMS",{items:e})})}deleteItems(e){return cn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return cn(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return cn(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_ITEMS_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=l=>{e(l.items)};return this.messageBus.send("OBR_SCENE_ITEMS_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_ITEMS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_ITEMS_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_ITEMS_EVENT_CHANGE",n)}}}var fn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};Xl();class Ic{constructor(e){this.messageBus=e}getItems(e){return fn(this,void 0,void 0,function*(){if(Array.isArray(e)){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEMS",{ids:e});return n}else if(e){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n.filter(e)}else{const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ALL_ITEMS",{});return n}})}updateItems(e,n,l,s=!0){return fn(this,void 0,void 0,function*(){const o=yield this.getItems(e),[i,r]=xl(o,n),u=i.map(a=>({id:a.id,type:a.type}));for(const a of r){const[d,h]=a.path;typeof d=="number"&&typeof h=="string"&&(u[d][h]=i[d][h])}const c=u.filter(a=>Object.keys(a).length>2);c.length!==0&&(yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_UPDATE_ITEMS",{updates:c,fastUpdate:l,updateAttachments:s}))})}addItems(e){return fn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_ADD_ITEMS",{items:e})})}deleteItems(e){return fn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_DELETE_ITEMS",{ids:e})})}getItemAttachments(e){return fn(this,void 0,void 0,function*(){const{items:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_ATTACHMENTS",{ids:e});return n})}getItemBounds(e){return fn(this,void 0,void 0,function*(){const{bounds:n}=yield this.messageBus.sendAsync("OBR_SCENE_LOCAL_GET_ITEM_BOUNDS",{ids:e});return n})}onChange(e){const n=l=>{e(l.items)};return this.messageBus.send("OBR_SCENE_LOCAL_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_LOCAL_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_LOCAL_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_LOCAL_EVENT_CHANGE",n)}}}var wl=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Dc{constructor(e){this.messageBus=e,this.grid=new wc(e),this.fog=new yc(e),this.history=new Tc(e),this.items=new Nc(e),this.local=new Ic(e)}isReady(){return wl(this,void 0,void 0,function*(){const{ready:e}=yield this.messageBus.sendAsync("OBR_SCENE_IS_READY",{});return e})}onReadyChange(e){const n=l=>{e(l.ready)};return this.messageBus.send("OBR_SCENE_READY_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_EVENT_READY_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_READY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_EVENT_READY_CHANGE",n)}}getMetadata(){return wl(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_SCENE_GET_METADATA",{});return e})}setMetadata(e){return wl(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_SCENE_SET_METADATA",{update:e})})}onMetadataChange(e){const n=l=>{e(l.metadata)};return this.messageBus.send("OBR_SCENE_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_SCENE_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_SCENE_METADATA_UNSUBSCRIBE",{}),this.messageBus.off("OBR_SCENE_METADATA_EVENT_CHANGE",n)}}}function Va(t){return t.startsWith("http")?t:`${window.location.origin}${t}`}function Bn(t){return t.map(e=>Object.assign(Object.assign({},e),{icon:Va(e.icon)}))}function es(t){return Object.assign(Object.assign({},t),{url:Va(t.url)})}var Zi=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Lc{constructor(e){this.contextMenus={},this.handleClick=n=>{var l;const s=this.contextMenus[n.id];s&&((l=s.onClick)===null||l===void 0||l.call(s,n.context,n.elementId))},this.messageBus=e,e.on("OBR_CONTEXT_MENU_EVENT_CLICK",this.handleClick)}create(e){return Zi(this,void 0,void 0,function*(){this.messageBus.sendAsync("OBR_CONTEXT_MENU_CREATE",{id:e.id,shortcut:e.shortcut,icons:Bn(e.icons),embed:e.embed&&es(e.embed)}),this.contextMenus[e.id]=e})}remove(e){return Zi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_CONTEXT_MENU_REMOVE",{id:e}),delete this.contextMenus[e]})}}var kt=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Pc{constructor(e){this.tools={},this.toolActions={},this.toolModes={},this.handleToolClick=n=>{const l=this.tools[n.id];if(l)if(l.onClick){const s=l.onClick(n.context,n.elementId);Promise.resolve(s).then(o=>{o&&this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})})}else this.messageBus.send("OBR_TOOL_ACTIVATE",{id:n.id})},this.handleToolActionClick=n=>{var l;const s=this.toolActions[n.id];s&&((l=s.onClick)===null||l===void 0||l.call(s,n.context,n.elementId))},this.handleToolModeClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onClick){const s=l.onClick(n.context,n.elementId);Promise.resolve(s).then(o=>{o&&this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})})}else this.messageBus.send("OBR_TOOL_MODE_ACTIVATE",{toolId:n.context.activeTool,modeId:n.id})},this.handleToolModeToolClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onToolClick){const s=l.onToolClick(n.context,n.event);Promise.resolve(s).then(o=>{o&&n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&!n.event.target.locked&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDoubleClick=n=>{const l=this.toolModes[n.id];if(l)if(l.onToolDoubleClick){const s=l.onToolDoubleClick(n.context,n.event);Promise.resolve(s).then(o=>{o&&n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})})}else n.event.target&&this.messageBus.sendAsync("OBR_PLAYER_SELECT",{items:[n.event.target.id]})},this.handleToolModeToolDown=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDown)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolMove=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolMove)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolUp=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolUp)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragStart=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragStart)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragMove=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragMove)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragEnd=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragEnd)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeToolDragCancel=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onToolDragCancel)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeKeyDown=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onKeyDown)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeKeyUp=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onKeyUp)===null||l===void 0||l.call(s,n.context,n.event))},this.handleToolModeActivate=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onActivate)===null||l===void 0||l.call(s,n.context))},this.handleToolModeDeactivate=n=>{var l;const s=this.toolModes[n.id];s&&((l=s.onDeactivate)===null||l===void 0||l.call(s,n.context))},this.messageBus=e,e.on("OBR_TOOL_EVENT_CLICK",this.handleToolClick),e.on("OBR_TOOL_ACTION_EVENT_CLICK",this.handleToolActionClick),e.on("OBR_TOOL_MODE_EVENT_CLICK",this.handleToolModeClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_CLICK",this.handleToolModeToolClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOUBLE_CLICK",this.handleToolModeToolDoubleClick),e.on("OBR_TOOL_MODE_EVENT_TOOL_DOWN",this.handleToolModeToolDown),e.on("OBR_TOOL_MODE_EVENT_TOOL_MOVE",this.handleToolModeToolMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_UP",this.handleToolModeToolUp),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_START",this.handleToolModeToolDragStart),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_MOVE",this.handleToolModeToolDragMove),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_END",this.handleToolModeToolDragEnd),e.on("OBR_TOOL_MODE_EVENT_TOOL_DRAG_CANCEL",this.handleToolModeToolDragCancel),e.on("OBR_TOOL_MODE_EVENT_KEY_DOWN",this.handleToolModeKeyDown),e.on("OBR_TOOL_MODE_EVENT_KEY_UP",this.handleToolModeKeyUp),e.on("OBR_TOOL_MODE_EVENT_ACTIVATE",this.handleToolModeActivate),e.on("OBR_TOOL_MODE_EVENT_DEACTIVATE",this.handleToolModeDeactivate)}create(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_CREATE",{id:e.id,shortcut:e.shortcut,defaultMode:e.defaultMode,defaultMetadata:e.defaultMetadata,icons:Bn(e.icons),disabled:e.disabled}),this.tools[e.id]=e})}remove(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_REMOVE",{id:e}),delete this.tools[e]})}activateTool(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTIVATE",{id:e})})}getMetadata(e){return kt(this,void 0,void 0,function*(){const{metadata:n}=yield this.messageBus.sendAsync("OBR_TOOL_GET_METADATA",{id:e});return n})}setMetadata(e,n){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_SET_METADATA",{toolId:e,update:n})})}createAction(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_CREATE",{id:e.id,shortcut:e.shortcut,icons:Bn(e.icons),disabled:e.disabled}),this.toolActions[e.id]=e})}removeAction(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_ACTION_REMOVE",{id:e}),delete this.tools[e]})}createMode(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_CREATE",{id:e.id,shortcut:e.shortcut,icons:Bn(e.icons),preventDrag:e.preventDrag,disabled:e.disabled,cursors:e.cursors}),this.toolModes[e.id]=e})}removeMode(e){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_REMOVE",{id:e}),delete this.tools[e]})}activateMode(e,n){return kt(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_TOOL_MODE_ACTIVATE",{toolId:e,modeId:n})})}}var dn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Hc{constructor(e){this.messageBus=e}open(e){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_OPEN",Object.assign({},es(e)))})}close(e){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_CLOSE",{id:e})})}getWidth(e){return dn(this,void 0,void 0,function*(){const{width:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_WIDTH",{id:e});return n})}setWidth(e,n){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_WIDTH",{id:e,width:n})})}getHeight(e){return dn(this,void 0,void 0,function*(){const{height:n}=yield this.messageBus.sendAsync("OBR_POPOVER_GET_HEIGHT",{id:e});return n})}setHeight(e,n){return dn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_POPOVER_SET_HEIGHT",{id:e,height:n})})}}var Qi=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Gc{constructor(e){this.messageBus=e}open(e){return Qi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_OPEN",Object.assign({},es(e)))})}close(e){return Qi(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_MODAL_CLOSE",{id:e})})}}var ut=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Uc{constructor(e){this.messageBus=e}getWidth(){return ut(this,void 0,void 0,function*(){const{width:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_WIDTH",{});return e})}setWidth(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_WIDTH",{width:e})})}getHeight(){return ut(this,void 0,void 0,function*(){const{height:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_HEIGHT",{});return e})}setHeight(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_HEIGHT",{height:e})})}getBadgeText(){return ut(this,void 0,void 0,function*(){const{badgeText:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_TEXT",{});return e})}setBadgeText(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_TEXT",{badgeText:e})})}getBadgeBackgroundColor(){return ut(this,void 0,void 0,function*(){const{badgeBackgroundColor:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_BADGE_BACKGROUND_COLOR",{});return e})}setBadgeBackgroundColor(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_BADGE_BACKGROUND_COLOR",{badgeBackgroundColor:e})})}getIcon(){return ut(this,void 0,void 0,function*(){const{icon:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_ICON",{});return e})}setIcon(e){return ut(this,void 0,void 0,function*(){const n=Bn([{icon:e}]);yield this.messageBus.sendAsync("OBR_ACTION_SET_ICON",{icon:n[0].icon})})}getTitle(){return ut(this,void 0,void 0,function*(){const{title:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_TITLE",{});return e})}setTitle(e){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_SET_TITLE",{title:e})})}isOpen(){return ut(this,void 0,void 0,function*(){const{isOpen:e}=yield this.messageBus.sendAsync("OBR_ACTION_GET_IS_OPEN",{});return e})}open(){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_OPEN",{})})}close(){return ut(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ACTION_CLOSE",{})})}onOpenChange(e){const n=l=>{e(l.isOpen)};return this.messageBus.send("OBR_ACTION_IS_OPEN_SUBSCRIBE",{}),this.messageBus.on("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_IS_OPEN_ACTION_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ACTION_IS_OPEN_EVENT_CHANGE",n)}}}var Fc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};Xl();class Vc{constructor(e){this.messageBus=e}startItemInteraction(e,n=!0){return Fc(this,void 0,void 0,function*(){const{id:l}=yield this.messageBus.sendAsync("OBR_INTERACTION_START_ITEM_INTERACTION",{baseState:e,updateAttachments:n});let s=e;return[r=>{const[u,c]=xl(s,r);return s=u,this.messageBus.send("OBR_INTERACTION_UPDATE_ITEM_INTERACTION",{id:l,patches:c}),u},()=>{this.messageBus.send("OBR_INTERACTION_STOP_ITEM_INTERACTION",{id:l})}]})}}var jc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Wc{constructor(e){this.messageBus=e}getPlayers(){return jc(this,void 0,void 0,function*(){const{players:e}=yield this.messageBus.sendAsync("OBR_PARTY_GET_PLAYERS",{});return e})}onChange(e){const n=l=>{e(l.players)};return this.messageBus.send("OBR_PARTY_SUBSCRIBE",{}),this.messageBus.on("OBR_PARTY_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PARTY_UNSUBSCRIBE",{}),this.messageBus.off("OBR_PARTY_EVENT_CHANGE",n)}}}var Tl=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class qc{constructor(e){this.messageBus=e}get id(){return this.messageBus.roomId}getPermissions(){return Tl(this,void 0,void 0,function*(){const{permissions:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_PERMISSIONS",{});return e})}getMetadata(){return Tl(this,void 0,void 0,function*(){const{metadata:e}=yield this.messageBus.sendAsync("OBR_ROOM_GET_METADATA",{});return e})}setMetadata(e){return Tl(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ROOM_SET_METADATA",{update:e})})}onMetadataChange(e){const n=l=>{e(l.metadata)};return this.messageBus.send("OBR_ROOM_METADATA_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_METADATA_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_METADATA_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_METADATA_EVENT_CHANGE",n)}}onPermissionsChange(e){const n=l=>{e(l.permissions)};return this.messageBus.send("OBR_ROOM_PERMISSIONS_SUBSCRIBE",{}),this.messageBus.on("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_PERMISSIONS_ROOM_UNSUBSCRIBE",{}),this.messageBus.off("OBR_ROOM_PERMISSIONS_EVENT_CHANGE",n)}}}var zc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Yc{constructor(e){this.messageBus=e}getTheme(){return zc(this,void 0,void 0,function*(){const{theme:e}=yield this.messageBus.sendAsync("OBR_THEME_GET_THEME",{});return e})}onChange(e){const n=l=>{e(l.theme)};return this.messageBus.send("OBR_THEME_SUBSCRIBE",{}),this.messageBus.on("OBR_THEME_EVENT_CHANGE",n),()=>{this.messageBus.send("OBR_THEME_UNSUBSCRIBE",{}),this.messageBus.off("OBR_THEME_EVENT_CHANGE",n)}}}var Kn=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Kc{constructor(e){this.messageBus=e}uploadImages(e,n){return Kn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_IMAGES",{images:e,typeHint:n})})}uploadScenes(e,n){return Kn(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_ASSETS_UPLOAD_SCENES",{scenes:e,disableShowScenes:n})})}downloadImages(e,n,l){return Kn(this,void 0,void 0,function*(){const{images:s}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_IMAGES",{multiple:e,defaultSearch:n,typeHint:l},-1);return s})}downloadScenes(e,n){return Kn(this,void 0,void 0,function*(){const{scenes:l}=yield this.messageBus.sendAsync("OBR_ASSETS_DOWNLOAD_SCENES",{multiple:e,defaultSearch:n},-1);return l})}}var Xc=globalThis&&globalThis.__awaiter||function(t,e,n,l){function s(o){return o instanceof n?o:new n(function(i){i(o)})}return new(n||(n=Promise))(function(o,i){function r(a){try{c(l.next(a))}catch(d){i(d)}}function u(a){try{c(l.throw(a))}catch(d){i(d)}}function c(a){a.done?o(a.value):s(a.value).then(r,u)}c((l=l.apply(t,e||[])).next())})};class Jc{constructor(e){this.messageBus=e}sendMessage(e,n){return Xc(this,void 0,void 0,function*(){yield this.messageBus.sendAsync("OBR_BROADCAST_SEND_MESSAGE",{channel:e,data:n})})}onMessage(e,n){return this.messageBus.send("OBR_BROADCAST_SUBSCRIBE",{channel:e}),this.messageBus.on(`OBR_BROADCAST_MESSAGE_${e}`,n),()=>{this.messageBus.send("OBR_BROADCAST_UNSUBSCRIBE",{channel:e}),this.messageBus.off(`OBR_BROADCAST_MESSAGE_${e}`,n)}}}const Zc=typeof atob=="function",ts=typeof Buffer=="function",xi=typeof TextDecoder=="function"?new TextDecoder:void 0;typeof TextEncoder=="function"&&new TextEncoder;const Qc="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",xc=Array.prototype.slice.call(Qc),Xn=(t=>{let e={};return t.forEach((n,l)=>e[n]=l),e})(xc),ef=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,Jt=String.fromCharCode.bind(String),eo=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),ja=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),tf=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,nf=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return Jt((n>>>10)+55296)+Jt((n&1023)+56320);case 3:return Jt((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return Jt((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},lf=t=>t.replace(tf,nf),sf=t=>{if(t=t.replace(/\s+/g,""),!ef.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",l,s;for(let o=0;o<t.length;)e=Xn[t.charAt(o++)]<<18|Xn[t.charAt(o++)]<<12|(l=Xn[t.charAt(o++)])<<6|(s=Xn[t.charAt(o++)]),n+=l===64?Jt(e>>16&255):s===64?Jt(e>>16&255,e>>8&255):Jt(e>>16&255,e>>8&255,e&255);return n},Wa=Zc?t=>atob(ja(t)):ts?t=>Buffer.from(t,"base64").toString("binary"):sf,of=ts?t=>eo(Buffer.from(t,"base64")):t=>eo(Wa(t).split("").map(e=>e.charCodeAt(0))),af=ts?t=>Buffer.from(t,"base64").toString("utf8"):xi?t=>xi.decode(of(t)):t=>lf(Wa(t)),rf=t=>ja(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),uf=t=>af(rf(t));function cf(){const e=new URLSearchParams(window.location.search).get("obrref");let n="",l="";if(e){const o=uf(e).split(" ");o.length===2&&(n=o[0],l=o[1])}return{origin:n,roomId:l}}var to;(function(t){t[t.MOVE=0]="MOVE",t[t.LINE=1]="LINE",t[t.QUAD=2]="QUAD",t[t.CONIC=3]="CONIC",t[t.CUBIC=4]="CUBIC",t[t.CLOSE=5]="CLOSE"})(to||(to={}));const Nl=cf(),Qe=new vc(Nl.origin,Nl.roomId),ff=new sc(Qe),df=new lc(Qe),pf=new Wc(Qe),_f=new bc(Qe),hf=new Dc(Qe),mf=new Lc(Qe),gf=new Pc(Qe),vf=new Hc(Qe),bf=new Gc(Qe),yf=new Uc(Qe),wf=new Vc(Qe),Tf=new qc(Qe),Ef=new Yc(Qe),Af=new Kc(Qe),kf=new Jc(Qe),qe={onReady:t=>{Qe.ready?t():Qe.once("OBR_READY",()=>t())},get isReady(){return Qe.ready},viewport:ff,player:df,party:pf,notification:_f,scene:hf,contextMenu:mf,tool:gf,popover:vf,modal:bf,action:yf,interaction:wf,room:Tf,theme:Ef,assets:Af,broadcast:kf,isAvailable:!!Nl.origin},Cf=50,ns=ct([]);function Of(t){ns.update(e=>(e.push({msg:t,timestamp:new Date}),e.length>Cf&&e.shift(),e))}function Bf(){ns.set([])}const al=8,_t=ct(1),Il=ct(!1),no=Vl(qa,2e3,()=>Il.set(!0),()=>Il.set(!1));async function Sf(){for(let t=0;t<al;t++)await Bt.removeItem(fl(t+1))}async function Rf(){_t.subscribe(t=>no(Ue(Ee),t)),Ee.subscribe(t=>no(t,Ue(_t))),_t.subscribe(async t=>{Ee.set(await Ka(t))}),_t.set(await za()),_t.subscribe(Ya)}async function qa(t,e){Bt.setItem(fl(e),JSON.stringify(t))}function fl(t){return`sd-character-sheet-slot-${t}`}async function za(){return parseInt(await Bt.getItem("sd-character-sheet-chosen-slot")??"1")}async function Ya(t){Bt.setItem("sd-character-sheet-chosen-slot",`${t}`)}async function Ka(t){await Mf(t);const e=await Bt.getItem(fl(t));return e?JSON.parse(e):Pt()}async function Mf(t){const e="sd-character-sheet",n=await Bt.getItem(e);n&&(await Bt.setItem(fl(t),n),await Bt.removeItem(e))}const Bt={setItem:async function(t,e){return Promise.resolve().then(function(){window.localStorage.setItem(t,e)})},getItem:async function(t){return Promise.resolve().then(function(){return window.localStorage.getItem(t)})},removeItem:async function(t){return Promise.resolve().then(function(){return window.localStorage.removeItem(t)})}},$f="com.maxpaulus.sd-character-sheet",Cn=ct({}),Tn=ct({});function bn(t){return`${$f}/${t}`}const Ht=ct(!1),Sn=ct([]),Ct=ct(),Hn=ct(),ls=ct(),hn=br(Ct,t=>t==Ue(Hn));async function Xa(){qe.onReady(async()=>{Ht.set(await qe.player.getRole()==="GM"),Nf(),Ue(Ht)&&If(),lo()})}function Nf(){qe.broadcast.onMessage(Za,({data:t})=>{typeof t=="string"&&Ll(t)})}async function If(){Hn.set(qe.player.id),Ct.set(qe.player.id),qe.player.onChange(t=>{ls.set(t)}),qe.party.onChange(t=>{Sn.set(t)}),Sn.subscribe(async t=>{const e={};e[qe.player.id]=(await qe.player.getMetadata())[bn("sheetData")];for(const l of t)e[l.id]=l.metadata[bn("sheetData")];Cn.set(e);const n=Ue(Ct);t.find(l=>l.id===n)||Ct.set(qe.player.id)}),Cn.subscribe(t=>{var l;const e=Ue(_t),n=Ue(Ct);Ee.set(((l=t[n])==null?void 0:l[`slot-${e}`])??Pt())}),_t.subscribe(t=>{var l;const e=Ue(Cn),n=Ue(Ct);Ee.set(((l=e[n])==null?void 0:l[`slot-${t}`])??Pt())}),Ct.subscribe(t=>{var l;const e=Ue(Cn),n=Ue(_t);Ee.set(((l=e[t])==null?void 0:l[`slot-${n}`])??Pt())}),Sn.set(await qe.party.getPlayers())}async function lo(){_t.set(await za());const t={};for(let e=1;e<=al;e++)t[`slot-${e}`]=await Ka(e)??Pt();Tn.set(t),Ee.subscribe(Vl(e=>{if(Ue(Ht)&&!Ue(hn))return;const n=Ue(Tn),l=Ue(_t);qa(e,l),n[`slot-${l}`]=e,Tn.set(n)},1e3)),_t.subscribe(e=>{if(Ue(Ht)&&!Ue(hn))return;Ya(e);const n=Ue(Tn);Ee.set(n[`slot-${e}`])}),Tn.subscribe(e=>{if(Ue(Ht)){if(!Ue(hn))return;const n=Ue(Cn),l=Ue(Hn);n[l]=e}qe.player.setMetadata({[bn("sheetData")]:e})})}const Df=Object.freeze(Object.defineProperty({__proto__:null,GmId:Hn,GmPlayer:ls,PartyStore:Sn,TrackedPlayer:Ct,init:Xa,isGM:Ht,isTrackedPlayerGM:hn,pluginId:bn},Symbol.toStringTag,{value:"Module"})),Ja="sd-character-sheet-local-settings";function Dl(){return{popoverDuration:5}}const mn=ct(Dl());async function Lf(){mn.set(await Pf()),mn.subscribe(t=>{if(t.popoverDuration<0){mn.set({...t,popoverDuration:0});return}Bt.setItem(Ja,JSON.stringify(t))})}async function Pf(){try{const t=await Bt.getItem(Ja);return JSON.parse(t)??Dl()}catch{return console.error("couldn't load settings from local storage"),Dl()}}const Za=bn("notification");async function Jn(t,e={}){if(!qe.isAvailable){alert(t);return}const l=`${await qe.player.getName()}: ${t}`;e.secret?Ll(`Secret: ${l}`):(qe.broadcast.sendMessage(Za,l),Ll(l))}let Zn;async function Ll(t){Of(t);const e=bn("popover");Zn&&(clearTimeout(Zn),Zn=null);try{await qe.popover.open({id:e,url:`/popover.html?msg=${encodeURIComponent(t)}`,height:100,width:400}),Zn=setTimeout(()=>{qe.popover.close(e)},(Ue(mn).popoverDuration??5)*1e3)}catch{alert(t)}}function Hf(t){let e,n=In(t[0])+"",l;return{c(){e=_("div"),l=G(n),p(e,"class","rounded-md bg-black text-white p-1")},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&1&&n!==(n=In(s[0])+"")&&ee(l,n)},d(s){s&&T(e)}}}function so(t){let e,n;const l=[t[3]];let s={$$slots:{default:[Vf]},$$scope:{ctx:t}};for(let o=0;o<l.length;o+=1)s=tl(s,l[o]);return e=new Qu({props:s}),e.$on("click",t[11]),e.$on("clickoutside",t[11]),{c(){ne(e.$$.fragment)},m(o,i){le(e,o,i),n=!0},p(o,i){const r=i&8?ga(l,[pr(o[3])]):{};i&32768&&(r.$$scope={dirty:i,ctx:o}),e.$set(r)},i(o){n||(P(e.$$.fragment,o),n=!0)},o(o){U(e.$$.fragment,o),n=!1},d(o){se(e,o)}}}function Gf(t){let e;return{c(){e=_("div"),e.textContent="秘密擲骰",p(e,"class","text-black")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function Uf(t){let e;return{c(){e=_("div"),e.textContent="優勢擲骰",p(e,"class","text-green-700")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function Ff(t){let e;return{c(){e=_("div"),e.textContent="劣勢擲骰",p(e,"class","text-red-700")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function Vf(t){let e,n,l,s,o,i,r,u;return e=new qn({props:{text:"擲骰"}}),e.$on("click",t[6]),l=new qn({props:{$$slots:{default:[Gf]},$$scope:{ctx:t}}}),l.$on("click",t[9]),o=new qn({props:{$$slots:{default:[Uf]},$$scope:{ctx:t}}}),o.$on("click",t[7]),r=new qn({props:{$$slots:{default:[Ff]},$$scope:{ctx:t}}}),r.$on("click",t[8]),{c(){ne(e.$$.fragment),n=y(),ne(l.$$.fragment),s=y(),ne(o.$$.fragment),i=y(),ne(r.$$.fragment)},m(c,a){le(e,c,a),w(c,n,a),le(l,c,a),w(c,s,a),le(o,c,a),w(c,i,a),le(r,c,a),u=!0},p(c,a){const d={};a&32768&&(d.$$scope={dirty:a,ctx:c}),l.$set(d);const h={};a&32768&&(h.$$scope={dirty:a,ctx:c}),o.$set(h);const v={};a&32768&&(v.$$scope={dirty:a,ctx:c}),r.$set(v)},i(c){u||(P(e.$$.fragment,c),P(l.$$.fragment,c),P(o.$$.fragment,c),P(r.$$.fragment,c),u=!0)},o(c){U(e.$$.fragment,c),U(l.$$.fragment,c),U(o.$$.fragment,c),U(r.$$.fragment,c),u=!1},d(c){se(e,c),c&&T(n),se(l,c),c&&T(s),se(o,c),c&&T(i),se(r,c)}}}function jf(t){let e,n,l,s,o,i;const r=t[14].default,u=Rn(r,t,t[15],null),c=u||Hf(t);let a=t[2]&&so(t);return{c(){e=_("div"),n=_("button"),c&&c.c(),l=y(),a&&a.c(),n.disabled=t[1],p(n,"class","bg-black text-white pt-1 px-1 rounded-md"),$e(n,"opacity-50",t[1]),$e(n,"cursor-not-allowed",t[1])},m(d,h){w(d,e,h),f(e,n),c&&c.m(n,null),f(e,l),a&&a.m(e,null),s=!0,o||(i=[D(n,"click",t[6]),D(n,"contextmenu",dr(t[10])),D(n,"touchstart",t[4]),D(n,"touchend",t[5],{passive:!0})],o=!0)},p(d,[h]){u?u.p&&(!s||h&32768)&&Mn(u,r,d,d[15],s?Nn(r,d[15],h,null):$n(d[15]),null):c&&c.p&&(!s||h&1)&&c.p(d,s?h:-1),(!s||h&2)&&(n.disabled=d[1]),(!s||h&2)&&$e(n,"opacity-50",d[1]),(!s||h&2)&&$e(n,"cursor-not-allowed",d[1]),d[2]?a?(a.p(d,h),h&4&&P(a,1)):(a=so(d),a.c(),P(a,1),a.m(e,null)):a&&(Fe(),U(a,1,1,()=>{a=null}),Ve())},i(d){s||(P(c,d),P(a),s=!0)},o(d){U(c,d),U(a),s=!1},d(d){d&&T(e),c&&c.d(d),a&&a.d(),o=!1,je(i)}}}function Wf(t,e,n){let{$$slots:l={},$$scope:s}=e,{modifier:o=0}=e,{numDice:i=1}=e,{diceType:r="d20"}=e,{disabled:u=!1}=e,c=!1,a={x:0,y:0},d;function h(O){d=setTimeout(()=>{E(O),d=null},500)}function v(){d&&(clearTimeout(d),d=null)}function g(){const O=Dt(r,i),R=`擲出 ${i}${r}: ${O} + ${o} = ${O+o}`;Jn(R)}function m(){const O=Dt(r,i),B=Dt(r,i),R=Math.max(O,B),M=`擲出 ${i}${r}: ${O} 與 ${B};
 ${R} + ${o} = ${R+o}`;Jn(M)}function b(){const O=Dt(r,i),B=Dt(r,i),R=Math.min(O,B),M=`擲出 ${i}${r}: ${O} 與 ${B};
 ${R} + ${o} = ${R+o}`;Jn(M)}function A(){const O=Dt(r,i),R=`擲出 ${i}${r}: ${O} + ${o} = ${O+o}`;Jn(R,{secret:!0})}async function E(O){u||(c&&(n(2,c=!1),await new Promise(B=>setTimeout(B,100))),n(3,a={x:O.clientX,y:O.clientY}),n(2,c=!0))}function k(){n(2,c=!1)}return t.$$set=O=>{"modifier"in O&&n(0,o=O.modifier),"numDice"in O&&n(12,i=O.numDice),"diceType"in O&&n(13,r=O.diceType),"disabled"in O&&n(1,u=O.disabled),"$$scope"in O&&n(15,s=O.$$scope)},[o,u,c,a,h,v,g,m,b,A,E,k,i,r,l,s]}class Gn extends Oe{constructor(e){super(),Be(this,e,Wf,jf,Ce,{modifier:0,numDice:12,diceType:13,disabled:1})}}function io(t){let e,n,l;return{c(){e=_("button"),e.innerHTML='<i class="material-icons bg-gray-500 text-white rounded-full text-md p-1 scale-[60%]">close</i>',p(e,"class","absolute right-0")},m(s,o){w(s,e,o),n||(l=D(e,"click",t[3]),n=!0)},p:W,d(s){s&&T(e),n=!1,l()}}}function qf(t){let e,n,l,s,o,i=[{type:"text"},t[1]],r={};for(let c=0;c<i.length;c+=1)r=tl(r,i[c]);let u=t[0]&&io(t);return{c(){e=_("div"),n=_("input"),l=y(),u&&u.c(),ys(n,r),$e(n,"svelte-hnbmdk",!0),p(e,"class","relative")},m(c,a){w(c,e,a),f(e,n),n.autofocus&&n.focus(),ae(n,t[0]),f(e,l),u&&u.m(e,null),s||(o=D(n,"input",t[2]),s=!0)},p(c,[a]){ys(n,r=ga(i,[{type:"text"},a&2&&c[1]])),a&1&&n.value!==c[0]&&ae(n,c[0]),$e(n,"svelte-hnbmdk",!0),c[0]?u?u.p(c,a):(u=io(c),u.c(),u.m(e,null)):u&&(u.d(1),u=null)},i:W,o:W,d(c){c&&T(e),u&&u.d(),s=!1,o()}}}function zf(t,e,n){const l=["value"];let s=ws(e,l),{value:o}=e;function i(){o=this.value,n(0,o)}const r=()=>{n(0,o="")};return t.$$set=u=>{e=tl(tl({},e),_r(u)),n(1,s=ws(e,l)),"value"in u&&n(0,o=u.value)},[o,s,i,r]}class Qa extends Oe{constructor(e){super(),Be(this,e,zf,qf,Ce,{value:0})}}function oo(t){let e;return{c(){e=G("(儀式)")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function ao(t){let e,n=t[0].stat+"",l;return{c(){e=G("/ "),l=G(n)},m(s,o){w(s,e,o),w(s,l,o)},p(s,o){o&1&&n!==(n=s[0].stat+"")&&ee(l,n)},d(s){s&&T(e),s&&T(l)}}}function ro(t){let e,n,l,s,o=[t[0].components.verbal?"V":null,t[0].components.somatic?"S":null,t[0].components.material?`M (${t[0].components.materialDesc??""})`:null].filter(Boolean).join(", ")+"",i;return{c(){e=_("div"),n=_("span"),n.textContent="構材 (Components)",l=y(),s=_("span"),i=G(o),p(n,"class","font-bold block text-xs text-gray-500"),p(e,"class","col-span-2")},m(r,u){w(r,e,u),f(e,n),f(e,l),f(e,s),f(s,i)},p(r,u){u&1&&o!==(o=[r[0].components.verbal?"V":null,r[0].components.somatic?"S":null,r[0].components.material?`M (${r[0].components.materialDesc??""})`:null].filter(Boolean).join(", ")+"")&&ee(i,o)},d(r){r&&T(e)}}}function Yf(t){let e;return{c(){e=_("button"),e.textContent="無法學習",p(e,"class","bg-gray-400 text-white w-full p-2 rounded cursor-not-allowed"),e.disabled=!0},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function Kf(t){let e,n,l;return{c(){e=_("button"),e.textContent="學習",p(e,"class","bg-blue-800 text-white w-full p-2 rounded shadow hover:bg-blue-900 transition-colors font-bold")},m(s,o){w(s,e,o),n||(l=D(e,"click",t[9]),n=!0)},p:W,d(s){s&&T(e),n=!1,l()}}}function Xf(t){let e,n,l;return{c(){e=_("button"),e.textContent="遺忘",p(e,"class","bg-red-800 text-white w-full p-2 rounded shadow hover:bg-red-900 transition-colors font-bold")},m(s,o){w(s,e,o),n||(l=D(e,"click",t[8]),n=!0)},p:W,d(s){s&&T(e),n=!1,l()}}}function uo(t){let e,n,l,s,o;return{c(){e=_("button"),e.innerHTML='<i class="material-icons text-sm">delete</i>',n=y(),l=_("button"),l.innerHTML='<i class="material-icons text-sm">edit</i>',p(e,"class","bg-gray-800 text-white p-2 rounded hover:bg-black"),p(l,"class","bg-gray-800 text-white p-2 rounded hover:bg-black")},m(i,r){w(i,e,r),w(i,n,r),w(i,l,r),s||(o=[D(e,"click",t[10]),D(l,"click",t[11])],s=!0)},p:W,d(i){i&&T(e),i&&T(n),i&&T(l),s=!1,je(o)}}}function co(t){let e,n,l;function s(i){t[13](i)}let o={$$slots:{header:[Zf],default:[Jf]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ft({props:o}),We.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&65539&&(u.$$scope={dirty:r,ctx:i}),!n&&r&2&&(n=!0,u.showModal=i[1],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){U(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function Jf(t){let e,n;return e=new Ma({props:{spellToEdit:t[0]}}),e.$on("finish",t[12]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&1&&(o.spellToEdit=l[0]),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Zf(t){var o;let e,n,l=(((o=t[0].l10n)==null?void 0:o.name)??t[0].name)+"",s;return{c(){e=_("h2"),n=G("編輯法術: "),s=G(l),p(e,"slot","header")},m(i,r){w(i,e,r),f(e,n),f(e,s)},p(i,r){var u;r&1&&l!==(l=(((u=i[0].l10n)==null?void 0:u.name)??i[0].name)+"")&&ee(s,l)},d(i){i&&T(e)}}}function Qf(t){var Ae,De;let e,n,l,s,o=(((Ae=t[0].l10n)==null?void 0:Ae.name)??t[0].name)+"",i,r,u,c=t[0].tier===0?"戲法":`${t[0].tier} 環`,a,d,h,v,g=(Cl(t[0].class)??t[0].class)+"",m,b,A,E,k,O,B,R,I,M,S,C,$,N,j=t[7](t[0].range)+"",V,Q,ve,re,de=(((De=t[0].l10n)==null?void 0:De.desc)??t[0].desc)+"",oe,q,F,K,ye,Y,pe,be,X,H=t[0].ritual&&oo(),Z=t[0].stat&&ao(t),me=t[0].components&&ro(t);function _e(x,fe){return fe&9&&(K=null),fe&9&&(ye=null),K==null&&(K=!!Ra(x[3],x[0])),K?Xf:(ye==null&&(ye=!!jr(x[3],x[0])),ye?Kf:Yf)}let ue=_e(t,-1),ce=ue(t),z=t[0].editable&&uo(t),te=t[1]&&co(t);return{c(){e=_("div"),n=_("div"),l=_("div"),s=_("span"),i=G(o),r=y(),u=_("span"),a=G(c),d=y(),H&&H.c(),h=y(),v=_("div"),m=G(g),b=y(),Z&&Z.c(),A=y(),E=_("div"),k=_("div"),O=_("span"),O.textContent="持續時間",B=y(),R=_("span"),I=G(t[2]),M=y(),S=_("div"),C=_("span"),C.textContent="施法距離",$=y(),N=_("span"),V=G(j),Q=y(),me&&me.c(),ve=y(),re=_("div"),oe=G(de),q=y(),F=_("div"),ce.c(),Y=y(),z&&z.c(),pe=y(),te&&te.c(),be=vt(),p(s,"class","font-bold text-lg text-purple-900"),p(u,"class","text-sm font-bold text-gray-600"),p(l,"class","flex justify-between items-baseline"),p(v,"class","text-xs text-gray-500 italic"),p(n,"class","flex flex-col border-b pb-2 mb-2"),p(O,"class","font-bold block text-xs text-gray-500"),p(C,"class","font-bold block text-xs text-gray-500"),p(E,"class","grid grid-cols-2 gap-2 text-sm mb-3"),p(re,"class","text-sm leading-relaxed text-gray-800 border-t pt-2 mb-3"),p(F,"class","flex gap-2"),p(e,"class","shadow-md border border-gray-200 mb-3 p-3 rounded-md bg-white")},m(x,fe){w(x,e,fe),f(e,n),f(n,l),f(l,s),f(s,i),f(l,r),f(l,u),f(u,a),f(u,d),H&&H.m(u,null),f(n,h),f(n,v),f(v,m),f(v,b),Z&&Z.m(v,null),f(e,A),f(e,E),f(E,k),f(k,O),f(k,B),f(k,R),f(R,I),f(E,M),f(E,S),f(S,C),f(S,$),f(S,N),f(N,V),f(E,Q),me&&me.m(E,null),f(e,ve),f(e,re),f(re,oe),f(e,q),f(e,F),ce.m(F,null),f(F,Y),z&&z.m(F,null),w(x,pe,fe),te&&te.m(x,fe),w(x,be,fe),X=!0},p(x,[fe]){var Se,L;(!X||fe&1)&&o!==(o=(((Se=x[0].l10n)==null?void 0:Se.name)??x[0].name)+"")&&ee(i,o),(!X||fe&1)&&c!==(c=x[0].tier===0?"戲法":`${x[0].tier} 環`)&&ee(a,c),x[0].ritual?H||(H=oo(),H.c(),H.m(u,null)):H&&(H.d(1),H=null),(!X||fe&1)&&g!==(g=(Cl(x[0].class)??x[0].class)+"")&&ee(m,g),x[0].stat?Z?Z.p(x,fe):(Z=ao(x),Z.c(),Z.m(v,null)):Z&&(Z.d(1),Z=null),(!X||fe&4)&&ee(I,x[2]),(!X||fe&1)&&j!==(j=x[7](x[0].range)+"")&&ee(V,j),x[0].components?me?me.p(x,fe):(me=ro(x),me.c(),me.m(E,null)):me&&(me.d(1),me=null),(!X||fe&1)&&de!==(de=(((L=x[0].l10n)==null?void 0:L.desc)??x[0].desc)+"")&&ee(oe,de),ue===(ue=_e(x,fe))&&ce?ce.p(x,fe):(ce.d(1),ce=ue(x),ce&&(ce.c(),ce.m(F,Y))),x[0].editable?z?z.p(x,fe):(z=uo(x),z.c(),z.m(F,null)):z&&(z.d(1),z=null),x[1]?te?(te.p(x,fe),fe&2&&P(te,1)):(te=co(x),te.c(),P(te,1),te.m(be.parentNode,be)):te&&(Fe(),U(te,1,1,()=>{te=null}),Ve())},i(x){X||(P(te),X=!0)},o(x){U(te),X=!1},d(x){x&&T(e),H&&H.d(),Z&&Z.d(),me&&me.d(),ce.d(),z&&z.d(),x&&T(pe),te&&te.d(x),x&&T(be)}}}function xf(t,e,n){let l,s;Me(t,Ne,k=>n(3,s=k));let{s:o}=e,i=yn(),r=!1;const u={Self:"自身",Touch:"觸碰",Sight:"視線"};function c(k){Wr(s,k),Ne.set(s)}function a(k){qr(s,k),Ne.set(s),i("close")}function d(k){Yr(s,k),Ne.set(s),i("close")}function h(k){return u[k]??k}const v=()=>a(o),g=()=>c(o),m=()=>d(o),b=()=>{n(1,r=!0)},A=()=>{n(1,r=!1),n(0,o)};function E(k){r=k,n(1,r)}return t.$$set=k=>{"s"in k&&n(0,o=k.s)},t.$$.update=()=>{t.$$.dirty&1&&n(2,l=o.duration)},[o,r,l,s,c,a,d,h,v,g,m,b,A,E]}class xa extends Oe{constructor(e){super(),Be(this,e,xf,Qf,Ce,{s:0})}}function fo(t,e,n){const l=t.slice();return l[14]=e[n],l}function po(t,e,n){const l=t.slice();return l[17]=e[n],l}function ed(t,e,n){const l=t.slice();return l[20]=e[n],l[22]=n,l}function td(t,e,n){const l=t.slice();return l[20]=e[n],l[22]=n,l}function _o(t){let e,n,l,s,o,i,r,u,c,a,d,h,v,g,m,b,A,E=Array(10),k=[];for(let M=0;M<E.length;M+=1)k[M]=nd(td(t,E,M));let O=Array(10),B=[];for(let M=0;M<O.length;M+=1)B[M]=ld(ed(t,O,M));let R=Ut,I=[];for(let M=0;M<R.length;M+=1)I[M]=ho(po(t,R,M));return{c(){e=_("div"),n=_("div"),l=_("label"),l.textContent="環階:",s=y(),o=_("select");for(let M=0;M<k.length;M+=1)k[M].c();i=y(),r=_("span"),r.textContent="-",u=y(),c=_("select");for(let M=0;M<B.length;M+=1)B[M].c();a=y(),d=_("div"),h=_("label"),h.textContent="職業:",v=y(),g=_("select"),m=_("option"),m.textContent="全部";for(let M=0;M<I.length;M+=1)I[M].c();p(l,"for","minTier"),p(l,"class","font-bold"),p(o,"id","minTier"),p(o,"class","border rounded"),t[1]===void 0&&Pe(()=>t[11].call(o)),p(c,"id","maxTier"),p(c,"class","border rounded"),t[2]===void 0&&Pe(()=>t[12].call(c)),p(n,"class","flex gap-2 items-center"),p(h,"for","classFilter"),p(h,"class","font-bold"),m.__value="All",m.value=m.__value,p(g,"id","classFilter"),p(g,"class","border rounded max-w-[200px]"),t[3]===void 0&&Pe(()=>t[13].call(g)),p(d,"class","flex gap-2 items-center"),p(e,"class","flex flex-col gap-2 bg-gray-50 p-2 rounded text-sm")},m(M,S){w(M,e,S),f(e,n),f(n,l),f(n,s),f(n,o);for(let C=0;C<k.length;C+=1)k[C]&&k[C].m(o,null);he(o,t[1],!0),f(n,i),f(n,r),f(n,u),f(n,c);for(let C=0;C<B.length;C+=1)B[C]&&B[C].m(c,null);he(c,t[2],!0),f(e,a),f(e,d),f(d,h),f(d,v),f(d,g),f(g,m);for(let C=0;C<I.length;C+=1)I[C]&&I[C].m(g,null);he(g,t[3],!0),b||(A=[D(o,"change",t[11]),D(c,"change",t[12]),D(g,"change",t[13])],b=!0)},p(M,S){if(S&2&&he(o,M[1]),S&4&&he(c,M[2]),S&0){R=Ut;let C;for(C=0;C<R.length;C+=1){const $=po(M,R,C);I[C]?I[C].p($,S):(I[C]=ho($),I[C].c(),I[C].m(g,null))}for(;C<I.length;C+=1)I[C].d(1);I.length=R.length}S&8&&he(g,M[3])},d(M){M&&T(e),ke(k,M),ke(B,M),ke(I,M),b=!1,je(A)}}}function nd(t){let e,n;return{c(){e=_("option"),n=G(t[22]),e.__value=t[22],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:W,d(l){l&&T(e)}}}function ld(t){let e,n;return{c(){e=_("option"),n=G(t[22]),e.__value=t[22],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:W,d(l){l&&T(e)}}}function ho(t){let e,n=t[17]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[17],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function sd(t){let e=[],n=new Map,l,s,o=t[6];const i=r=>r[14].name;for(let r=0;r<o.length;r+=1){let u=fo(t,o,r),c=i(u);n.set(c,e[r]=mo(c,u))}return{c(){for(let r=0;r<e.length;r+=1)e[r].c();l=vt()},m(r,u){for(let c=0;c<e.length;c+=1)e[c]&&e[c].m(r,u);w(r,l,u),s=!0},p(r,u){u&64&&(o=r[6],Fe(),e=hr(e,u,i,1,r,o,n,l.parentNode,mr,mo,l,fo),Ve())},i(r){if(!s){for(let u=0;u<o.length;u+=1)P(e[u]);s=!0}},o(r){for(let u=0;u<e.length;u+=1)U(e[u]);s=!1},d(r){for(let u=0;u<e.length;u+=1)e[u].d(r);r&&T(l)}}}function id(t){let e;return{c(){e=_("div"),e.textContent="沒有符合的法術",p(e,"class","text-center text-gray-500 mt-10")},m(n,l){w(n,e,l)},p:W,i:W,o:W,d(n){n&&T(e)}}}function mo(t,e){let n,l,s,o;return l=new xa({props:{s:e[14]}}),{key:t,first:null,c(){n=_("div"),ne(l.$$.fragment),s=y(),p(n,"class","mb-4 break-inside-avoid"),this.first=n},m(i,r){w(i,n,r),le(l,n,null),f(n,s),o=!0},p(i,r){e=i;const u={};r&64&&(u.s=e[14]),l.$set(u)},i(i){o||(P(l.$$.fragment,i),o=!0)},o(i){U(l.$$.fragment,i),o=!1},d(i){i&&T(n),se(l)}}}function od(t){let e,n,l,s,o,i,r,u=t[5]?"隱藏過濾":"顯示過濾",c,a,d,h,v,g,m,b,A,E,k,O,B;function R(N){t[8](N)}let I={placeholder:"搜尋法術...",class:"w-full mb-2"};t[0]!==void 0&&(I.value=t[0]),l=new Qa({props:I}),We.push(()=>Ye(l,"value",R));let M=t[5]&&_o(t);const S=[id,sd],C=[];function $(N,j){return N[6].length===0?0:1}return A=$(t),E=C[A]=S[A](t),{c(){e=_("div"),n=_("div"),ne(l.$$.fragment),o=y(),i=_("div"),r=_("button"),c=G(u),a=y(),d=_("label"),h=_("input"),v=G(" 只顯示自訂"),g=y(),M&&M.c(),m=y(),b=_("div"),E.c(),p(r,"class","text-blue-700 underline text-xs"),p(h,"type","checkbox"),p(h,"class","svelte-1ep1fgl"),p(d,"class","flex gap-1 items-center ml-auto"),p(i,"class","flex gap-2 items-center text-sm mb-2 flex-wrap"),p(n,"class","sticky top-0 bg-white p-2 border-b z-10"),p(b,"class","overflow-y-auto p-2 flex-1"),p(e,"class","flex flex-col gap-1 h-full overflow-hidden")},m(N,j){w(N,e,j),f(e,n),le(l,n,null),f(n,o),f(n,i),f(i,r),f(r,c),f(i,a),f(i,d),f(d,h),h.checked=t[4],f(d,v),f(n,g),M&&M.m(n,null),f(e,m),f(e,b),C[A].m(b,null),k=!0,O||(B=[D(r,"click",t[9]),D(h,"change",t[10])],O=!0)},p(N,[j]){const V={};!s&&j&1&&(s=!0,V.value=N[0],Ke(()=>s=!1)),l.$set(V),(!k||j&32)&&u!==(u=N[5]?"隱藏過濾":"顯示過濾")&&ee(c,u),j&16&&(h.checked=N[4]),N[5]?M?M.p(N,j):(M=_o(N),M.c(),M.m(n,null)):M&&(M.d(1),M=null);let Q=A;A=$(N),A===Q?C[A].p(N,j):(Fe(),U(C[Q],1,1,()=>{C[Q]=null}),Ve(),E=C[A],E?E.p(N,j):(E=C[A]=S[A](N),E.c()),P(E,1),E.m(b,null))},i(N){k||(P(l.$$.fragment,N),P(E),k=!0)},o(N){U(l.$$.fragment,N),U(E),k=!1},d(N){N&&T(e),se(l),M&&M.d(),C[A].d(),O=!1,je(B)}}}function ad(t,e,n){let l,s;Me(t,Ne,A=>n(7,s=A));let o="",i=!0,r=0,u=9,c="All",a=!1;function d(A){o=A,n(0,o)}const h=()=>n(5,i=!i);function v(){a=this.checked,n(4,a)}function g(){r=Ge(this),n(1,r)}function m(){u=Ge(this),n(2,u)}function b(){c=Ge(this),n(3,c)}return t.$$.update=()=>{t.$$.dirty&159&&n(6,l=Object.values(Gl).concat(s.customSpells??[]).filter(A=>{var k,O;if(A.tier<r||A.tier>u||c!=="All"&&A.class!==c||a&&!s.customSpells.find(B=>B.name===A.name))return!1;const E=o.toLowerCase();return E?A.name.toLowerCase().includes(E)||A.desc.toLowerCase().includes(E)||(((O=(k=A.l10n)==null?void 0:k.name)==null?void 0:O.toLowerCase().includes(E))??!1):!0}).sort((A,E)=>A.tier!==E.tier?A.tier-E.tier:A.name.localeCompare(E.name)))},[o,r,u,c,a,i,l,s,d,h,v,g,m,b]}class rd extends Oe{constructor(e){super(),Be(this,e,ad,od,Ce,{})}}function ud(t){let e,n;return e=new rd({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function cd(t){let e;return{c(){e=_("h1"),e.textContent="法術",p(e,"slot","header")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function fd(t){let e,n,l,s,o,i,r;function u(a){t[2](a)}let c={vh:90,$$slots:{header:[cd],default:[ud]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),We.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.textContent="法術",n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white p-2 w-full")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=D(e,"click",t[1]),i=!0)},p(a,[d]){const h={};d&8&&(h.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,h.showModal=a[0],Ke(()=>s=!1)),l.$set(h)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){U(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function dd(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function o(i){l=i,n(0,l)}return[l,s,o]}class pd extends Oe{constructor(e){super(),Be(this,e,dd,fd,Ce,{})}}function _d(t){let e,n;return e=new xa({props:{s:t[0]}}),e.$on("close",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&1&&(o.s=l[0]),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function hd(t){let e,n=t[0].name+"",l;return{c(){e=_("h2"),l=G(n),p(e,"slot","header")},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&1&&n!==(n=s[0].name+"")&&ee(l,n)},d(s){s&&T(e)}}}function md(t){let e,n,l,s,o,i,r;function u(a){t[4](a)}let c={$$slots:{header:[hd],default:[_d]},$$scope:{ctx:t}};return t[1]!==void 0&&(c.showModal=t[1]),l=new ft({props:c}),We.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons">info</i>',n=y(),ne(l.$$.fragment)},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=D(e,"click",t[2]),i=!0)},p(a,[d]){const h={};d&35&&(h.$$scope={dirty:d,ctx:a}),!s&&d&2&&(s=!0,h.showModal=a[1],Ke(()=>s=!1)),l.$set(h)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){U(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function gd(t,e,n){let{spell:l}=e,s=!1;const o=()=>{n(1,s=!0)},i=()=>{n(1,s=!1)};function r(u){s=u,n(1,s)}return t.$$set=u=>{"spell"in u&&n(0,l=u.spell)},[l,s,o,i,r]}class vd extends Oe{constructor(e){super(),Be(this,e,gd,md,Ce,{spell:0})}}const{Boolean:bd}=va;function go(t,e,n){const l=t.slice();return l[5]=e[n],l}function yd(t){let e;return{c(){e=_("div"),e.textContent="尚未學習法術",p(e,"class","text-gray-500 text-center py-4")},m(n,l){w(n,e,l)},p:W,i:W,o:W,d(n){n&&T(e)}}}function wd(t){let e,n,l=t[0],s=[];for(let i=0;i<l.length;i+=1)s[i]=vo(go(t,l,i));const o=i=>U(s[i],1,1,()=>{s[i]=null});return{c(){e=_("ul");for(let i=0;i<s.length;i+=1)s[i].c();p(e,"class","flex flex-col gap-1")},m(i,r){w(i,e,r);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(e,null);n=!0},p(i,r){if(r&5){l=i[0];let u;for(u=0;u<l.length;u+=1){const c=go(i,l,u);s[u]?(s[u].p(c,r),P(s[u],1)):(s[u]=vo(c),s[u].c(),P(s[u],1),s[u].m(e,null))}for(Fe(),u=l.length;u<s.length;u+=1)o(u);Ve()}},i(i){if(!n){for(let r=0;r<l.length;r+=1)P(s[r]);n=!0}},o(i){s=s.filter(bd);for(let r=0;r<s.length;r+=1)U(s[r]);n=!1},d(i){i&&T(e),ke(s,i)}}}function Td(t){let e;return{c(){e=_("span"),e.textContent="攻擊",p(e,"class","font-bold px-1")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function vo(t){var B;let e,n,l,s,o,i,r,u=(((B=t[5].l10n)==null?void 0:B.name)??t[5].name)+"",c,a,d,h=t[5].tier===0?"戲法":`${t[5].tier} 環`,v,g,m,b,A,E,k,O;return s=new vd({props:{spell:t[5]}}),A=new Gn({props:{modifier:t[2],$$slots:{default:[Td]},$$scope:{ctx:t}}}),{c(){e=_("li"),n=_("div"),l=_("div"),ne(s.$$.fragment),o=y(),i=_("div"),r=_("span"),c=G(u),a=y(),d=_("span"),v=G(h),g=y(),m=_("div"),b=_("div"),ne(A.$$.fragment),k=y(),p(r,"class","font-bold"),p(d,"class","text-[10px] text-gray-500"),p(i,"class","flex flex-col"),p(l,"class","flex gap-2 items-center"),p(b,"title",E=`法術攻擊 (${t[2]>=0?"+":""}${t[2]})`),p(m,"class","flex items-center gap-2"),p(n,"class","flex justify-between border-b border-gray-300 items-center py-1")},m(R,I){w(R,e,I),f(e,n),f(n,l),le(s,l,null),f(l,o),f(l,i),f(i,r),f(r,c),f(i,a),f(i,d),f(d,v),f(n,g),f(n,m),f(m,b),le(A,b,null),f(e,k),O=!0},p(R,I){var C;const M={};I&1&&(M.spell=R[5]),s.$set(M),(!O||I&1)&&u!==(u=(((C=R[5].l10n)==null?void 0:C.name)??R[5].name)+"")&&ee(c,u),(!O||I&1)&&h!==(h=R[5].tier===0?"戲法":`${R[5].tier} 環`)&&ee(v,h);const S={};I&4&&(S.modifier=R[2]),I&256&&(S.$$scope={dirty:I,ctx:R}),A.$set(S),(!O||I&4&&E!==(E=`法術攻擊 (${R[2]>=0?"+":""}${R[2]})`))&&p(b,"title",E)},i(R){O||(P(s.$$.fragment,R),P(A.$$.fragment,R),O=!0)},o(R){U(s.$$.fragment,R),U(A.$$.fragment,R),O=!1},d(R){R&&T(e),se(s),se(A)}}}function Ed(t){let e,n,l,s,o,i,r=t[2]>=0?"+":"",u,c,a,d,h,v,g,m,b,A,E,k,O,B,R,I,M;const S=[wd,yd],C=[];function $(N,j){return N[3]?0:1}return A=$(t),E=C[A]=S[A](t),B=new pd({}),I=new Xu({}),{c(){e=_("div"),n=_("div"),l=_("div"),s=_("span"),s.textContent="法術攻擊",o=y(),i=_("span"),u=G(r),c=G(t[2]),a=y(),d=_("div"),h=_("span"),h.textContent="法術 DC",v=y(),g=_("span"),m=G(t[1]),b=y(),E.c(),k=y(),O=_("div"),ne(B.$$.fragment),R=y(),ne(I.$$.fragment),p(s,"class","text-xs font-bold text-gray-500"),p(i,"class","text-xl font-bold"),p(l,"class","flex flex-col items-center"),p(h,"class","text-xs font-bold text-gray-500"),p(g,"class","text-xl font-bold"),p(d,"class","flex flex-col items-center"),p(n,"class","flex justify-between items-center bg-gray-100 p-2 rounded"),p(O,"class","flex gap-2 mt-2"),p(e,"class","flex flex-col gap-2")},m(N,j){w(N,e,j),f(e,n),f(n,l),f(l,s),f(l,o),f(l,i),f(i,u),f(i,c),f(n,a),f(n,d),f(d,h),f(d,v),f(d,g),f(g,m),f(e,b),C[A].m(e,null),f(e,k),f(e,O),le(B,O,null),f(O,R),le(I,O,null),M=!0},p(N,[j]){(!M||j&4)&&r!==(r=N[2]>=0?"+":"")&&ee(u,r),(!M||j&4)&&ee(c,N[2]),(!M||j&2)&&ee(m,N[1]);let V=A;A=$(N),A===V?C[A].p(N,j):(Fe(),U(C[V],1,1,()=>{C[V]=null}),Ve(),E=C[A],E?E.p(N,j):(E=C[A]=S[A](N),E.c()),P(E,1),E.m(e,k))},i(N){M||(P(E),P(B.$$.fragment,N),P(I.$$.fragment,N),M=!0)},o(N){U(E),U(B.$$.fragment,N),U(I.$$.fragment,N),M=!1},d(N){N&&T(e),C[A].d(),se(B),se(I)}}}function Ad(t,e,n){let l,s,o,i,r;return Me(t,Ne,u=>n(4,r=u)),t.$$.update=()=>{t.$$.dirty&16&&n(0,l=r.spells.map(u=>Aa(u.name)).filter(Boolean)),t.$$.dirty&1&&n(3,s=(l==null?void 0:l.length)>0),t.$$.dirty&16&&n(2,o=Sa(r)),t.$$.dirty&16&&n(1,i=Hr(r))},[l,i,o,s,r]}class kd extends Oe{constructor(e){super(),Be(this,e,Ad,Ed,Ce,{})}}function Cd(t){let e,n,l,s,o,i,r,u,c;return s=new kd({}),i=new Uu({}),u=new su({}),{c(){e=_("h2"),e.textContent="法術 / 加值 / 語言",n=y(),l=_("div"),ne(s.$$.fragment),o=y(),ne(i.$$.fragment),r=y(),ne(u.$$.fragment),p(l,"class","overflow-y-auto")},m(a,d){w(a,e,d),w(a,n,d),w(a,l,d),le(s,l,null),f(l,o),le(i,l,null),f(l,r),le(u,l,null),c=!0},p:W,i(a){c||(P(s.$$.fragment,a),P(i.$$.fragment,a),P(u.$$.fragment,a),c=!0)},o(a){U(s.$$.fragment,a),U(i.$$.fragment,a),U(u.$$.fragment,a),c=!1},d(a){a&&T(e),a&&T(n),a&&T(l),se(s),se(i),se(u)}}}class Od extends Oe{constructor(e){super(),Be(this,e,null,Cd,Ce,{})}}function Bd(t){let e,n,l,s=gn(t[0])+"",o,i,r,u,c,a,d,h,v,g;return d=new Gn({props:{modifier:t[2]}}),{c(){e=_("div"),n=_("label"),l=_("h2"),o=G(s),i=y(),r=_("div"),u=_("input"),a=G(" / "),ne(d.$$.fragment),p(u,"id",c=`${t[0]}-input}`),p(u,"type","number"),p(u,"inputmode","numeric"),u.value=t[1],p(u,"min","1"),p(u,"max","20"),p(u,"class","w-1/2"),p(r,"class","sheet-stat flex gap-1"),p(e,"class","flex flex-col")},m(m,b){w(m,e,b),f(e,n),f(n,l),f(l,o),f(n,i),f(n,r),f(r,u),f(r,a),le(d,r,null),h=!0,v||(g=D(u,"input",t[4]),v=!0)},p(m,[b]){(!h||b&1)&&s!==(s=gn(m[0])+"")&&ee(o,s),(!h||b&1&&c!==(c=`${m[0]}-input}`))&&p(u,"id",c),(!h||b&2&&u.value!==m[1])&&(u.value=m[1]);const A={};b&4&&(A.modifier=m[2]),d.$set(A)},i(m){h||(P(d.$$.fragment,m),h=!0)},o(m){U(d.$$.fragment,m),h=!1},d(m){m&&T(e),se(d),v=!1,g()}}}function Sd(t,e,n){let l,s,o,{forStat:i}=e;const r=Ee;Me(t,r,c=>n(5,o=c));function u(c){ze(r,o.stats[i]=parseInt(c.target.value)-Ba(o,i),o)}return t.$$set=c=>{"forStat"in c&&n(0,i=c.forStat)},t.$$.update=()=>{t.$$.dirty&33&&n(2,l=Ft(o,i)),t.$$.dirty&33&&n(1,s=jl(o,i))},[i,s,l,r,u,o]}class pn extends Oe{constructor(e){super(),Be(this,e,Sd,Bd,Ce,{forStat:0})}}function bo(t,e,n){const l=t.slice();l[7]=e[n];const s=l[0].includes(l[7]);return l[8]=s,l}function yo(t){let e,n,l=(t[3][t[7]]??t[7])+"",s,o,i,r,u;function c(){return t[6](t[7])}return{c(){e=_("button"),n=_("div"),s=G(l),i=y(),p(n,"class",o=`p-2 rounded-full border ${t[8]?"bg-black text-white border-black":""}`)},m(a,d){w(a,e,d),f(e,n),f(n,s),f(e,i),r||(u=D(e,"click",c),r=!0)},p(a,d){t=a,d&12&&l!==(l=(t[3][t[7]]??t[7])+"")&&ee(s,l),d&5&&o!==(o=`p-2 rounded-full border ${t[8]?"bg-black text-white border-black":""}`)&&p(n,"class",o)},d(a){a&&T(e),r=!1,u()}}}function Rd(t){let e,n=t[2],l=[];for(let s=0;s<n.length;s+=1)l[s]=yo(bo(t,n,s));return{c(){e=_("div");for(let s=0;s<l.length;s+=1)l[s].c();p(e,"id",t[1]),p(e,"class","w-full flex flex-wrap gap-1")},m(s,o){w(s,e,o);for(let i=0;i<l.length;i+=1)l[i]&&l[i].m(e,null)},p(s,[o]){if(o&29){n=s[2];let i;for(i=0;i<n.length;i+=1){const r=bo(s,n,i);l[i]?l[i].p(r,o):(l[i]=yo(r),l[i].c(),l[i].m(e,null))}for(;i<l.length;i+=1)l[i].d(1);l.length=n.length}o&2&&p(e,"id",s[1])},i:W,o:W,d(s){s&&T(e),ke(l,s)}}}function Md(t,e,n){let{id:l="multiSelect"}=e,{values:s=[]}=e,{minSelected:o=0}=e,{options:i=[]}=e,{labels:r={}}=e;function u(a){const d=s.findIndex(h=>h===a);d>=0?s.length>o&&s.splice(d,1):s.push(a),n(0,s)}const c=a=>u(a);return t.$$set=a=>{"id"in a&&n(1,l=a.id),"values"in a&&n(0,s=a.values),"minSelected"in a&&n(5,o=a.minSelected),"options"in a&&n(2,i=a.options),"labels"in a&&n(3,r=a.labels)},[s,l,i,r,u,o,c]}class er extends Oe{constructor(e){super(),Be(this,e,Md,Rd,Ce,{id:1,values:0,minSelected:5,options:2,labels:3})}}function wo(t,e,n){const l=t.slice();return l[44]=e[n],l}function To(t,e,n){const l=t.slice();return l[36]=e[n],l}function Eo(t,e,n){const l=t.slice();return l[36]=e[n],l}function Ao(t,e,n){const l=t.slice();return l[41]=e[n],l}function $d(t,e,n){const l=t.slice();return l[47]=e[n],l}function Nd(t){let e,n;return{c(){e=_("option"),n=G(t[47]),e.__value=t[47],e.value=e.__value},m(l,s){w(l,e,s),f(e,n)},p:W,d(l){l&&T(e)}}}function ko(t){let e,n,l,s,o,i,r,u,c,a,d,h,v;const g=[Ld,Dd,Id],m=[];function b(A,E){return A[1].gearType==="Basic"?0:A[1].gearType==="Weapon"?1:A[1].gearType==="Armor"?2:-1}return~(c=b(t))&&(a=m[c]=g[c](t)),{c(){e=_("div"),n=_("label"),n.textContent="裝備類型",l=y(),s=_("select"),o=_("option"),o.textContent="基礎",i=_("option"),i.textContent="武器",r=_("option"),r.textContent="防具",u=y(),a&&a.c(),p(n,"for","gearType"),p(n,"class","font-bold"),o.__value="Basic",o.value=o.__value,i.__value="Weapon",i.value=i.__value,r.__value="Armor",r.value=r.__value,p(s,"name","gearType"),p(s,"class","border p-1 rounded"),t[1].gearType===void 0&&Pe(()=>t[14].call(s)),p(e,"class","flex flex-col gap-2 bg-gray-50 p-2 rounded border")},m(A,E){w(A,e,E),f(e,n),f(e,l),f(e,s),f(s,o),f(s,i),f(s,r),he(s,t[1].gearType,!0),f(e,u),~c&&m[c].m(e,null),d=!0,h||(v=D(s,"change",t[14]),h=!0)},p(A,E){E[0]&2&&he(s,A[1].gearType);let k=c;c=b(A),c===k?~c&&m[c].p(A,E):(a&&(Fe(),U(m[k],1,1,()=>{m[k]=null}),Ve()),~c?(a=m[c],a?a.p(A,E):(a=m[c]=g[c](A),a.c()),P(a,1),a.m(e,null)):a=null)},i(A){d||(P(a),d=!0)},o(A){U(a),d=!1},d(A){A&&T(e),~c&&m[c].d(),h=!1,v()}}}function Id(t){let e,n,l,s,o,i,r,u,c,a,d,h,v,g,m,b,A,E,k,O,B,R,I,M,S,C,$,N,j,V,Q,ve;function re(F){t[27](F)}let de={id:"armorProperties",options:Cr,labels:t[6]};t[1].armorProperties!==void 0&&(de.values=t[1].armorProperties),l=new er({props:de}),We.push(()=>Ye(l,"values",re));let oe=Gt,q=[];for(let F=0;F<oe.length;F+=1)q[F]=Co(wo(t,oe,F));return{c(){e=_("label"),e.textContent="防具特性",n=y(),ne(l.$$.fragment),o=y(),i=_("div"),r=_("div"),u=_("label"),u.textContent="基礎 AC",c=y(),a=_("input"),d=y(),h=_("div"),v=_("label"),v.textContent="AC 修正 (+1等)",g=y(),m=_("input"),b=y(),A=_("label"),A.textContent="AC 屬性加成 (通常無或 Dex)",E=y(),k=_("select"),O=_("option"),B=G("無");for(let F=0;F<q.length;F+=1)q[F].c();R=y(),I=_("label"),I.textContent="最大敏捷加值 (Max Dex)",M=y(),S=_("select"),C=_("option"),$=G("無限制 (輕甲)"),N=_("option"),N.textContent="+2 (中甲)",j=_("option"),j.textContent="0 (重甲)",p(e,"for","armorProperties"),p(e,"class","font-bold"),p(u,"for","baseAC"),p(a,"id","baseAC"),p(a,"type","number"),p(a,"class","border p-1 rounded"),p(a,"inputmode","numeric"),p(r,"class","flex flex-col w-1/2"),p(v,"for","acModifier"),p(m,"id","acModifier"),p(m,"type","number"),p(m,"class","border p-1 rounded"),p(m,"inputmode","numeric"),p(h,"class","flex flex-col w-1/2"),p(i,"class","flex gap-2"),p(A,"for","armorStat"),O.__value=void 0,O.value=O.__value,p(k,"id","armorStat"),p(k,"class","border p-1 rounded"),t[1].armorStat===void 0&&Pe(()=>t[30].call(k)),p(I,"for","maxDex"),C.__value=void 0,C.value=C.__value,N.__value=2,N.value=N.__value,j.__value=0,j.value=j.__value,p(S,"id","maxDex"),p(S,"class","border p-1 rounded"),t[1].maxDex===void 0&&Pe(()=>t[31].call(S))},m(F,K){w(F,e,K),w(F,n,K),le(l,F,K),w(F,o,K),w(F,i,K),f(i,r),f(r,u),f(r,c),f(r,a),ae(a,t[1].baseAC),f(i,d),f(i,h),f(h,v),f(h,g),f(h,m),ae(m,t[1].acModifier),w(F,b,K),w(F,A,K),w(F,E,K),w(F,k,K),f(k,O),f(O,B);for(let ye=0;ye<q.length;ye+=1)q[ye]&&q[ye].m(k,null);he(k,t[1].armorStat,!0),w(F,R,K),w(F,I,K),w(F,M,K),w(F,S,K),f(S,C),f(C,$),f(S,N),f(S,j),he(S,t[1].maxDex,!0),V=!0,Q||(ve=[D(a,"input",t[28]),D(m,"input",t[29]),D(k,"change",t[30]),D(S,"change",t[31])],Q=!0)},p(F,K){const ye={};if(!s&&K[0]&2&&(s=!0,ye.values=F[1].armorProperties,Ke(()=>s=!1)),l.$set(ye),K[0]&2&&Re(a.value)!==F[1].baseAC&&ae(a,F[1].baseAC),K[0]&2&&Re(m.value)!==F[1].acModifier&&ae(m,F[1].acModifier),K&0){oe=Gt;let Y;for(Y=0;Y<oe.length;Y+=1){const pe=wo(F,oe,Y);q[Y]?q[Y].p(pe,K):(q[Y]=Co(pe),q[Y].c(),q[Y].m(k,null))}for(;Y<q.length;Y+=1)q[Y].d(1);q.length=oe.length}K[0]&2&&he(k,F[1].armorStat),K[0]&2&&he(S,F[1].maxDex)},i(F){V||(P(l.$$.fragment,F),V=!0)},o(F){U(l.$$.fragment,F),V=!1},d(F){F&&T(e),F&&T(n),se(l,F),F&&T(o),F&&T(i),F&&T(b),F&&T(A),F&&T(E),F&&T(k),ke(q,F),F&&T(R),F&&T(I),F&&T(M),F&&T(S),Q=!1,je(ve)}}}function Dd(t){let e,n,l,s,o,i,r,u,c,a,d,h,v,g=t[1].weaponProperties.includes("Magical"),m,b,A,E,k,O,B,R,I,M,S,C,$,N,j,V,Q,ve,re,de,oe,q,F,K,ye,Y,pe,be,X,H,Z,me,_e;function ue(L){t[18](L)}let ce={id:"weaponProperties",options:Sr,labels:t[4]};t[1].weaponProperties!==void 0&&(ce.values=t[1].weaponProperties),d=new er({props:ce}),We.push(()=>Ye(d,"values",ue));let z=g&&Oo(t),te=Es,Ae=[];for(let L=0;L<te.length;L+=1)Ae[L]=Bo(Ao(t,te,L));let De=Lt,x=[];for(let L=0;L<De.length;L+=1)x[L]=So(Eo(t,De,L));let fe=Lt,Se=[];for(let L=0;L<fe.length;L+=1)Se[L]=Ro(To(t,fe,L));return{c(){e=_("label"),e.textContent="武器類型",n=y(),l=_("select"),s=_("option"),s.textContent="簡易近戰",o=_("option"),o.textContent="簡易遠程",i=_("option"),i.textContent="軍用近戰",r=_("option"),r.textContent="軍用遠程",u=y(),c=_("label"),c.textContent="武器特性",a=y(),ne(d.$$.fragment),v=y(),z&&z.c(),m=y(),b=_("label"),b.textContent="距離",A=y(),E=_("select");for(let L=0;L<Ae.length;L+=1)Ae[L].c();k=y(),O=_("label"),O.innerHTML='傷害<span class="text-red-700">*</span>',B=y(),R=_("div"),I=_("input"),M=y(),S=_("div"),C=_("div"),C.textContent="單手:",$=y(),N=_("input"),V=y(),Q=_("select");for(let L=0;L<x.length;L+=1)x[L].c();re=y(),de=_("div"),oe=_("input"),q=y(),F=_("div"),K=_("div"),K.textContent="雙手:",ye=y(),Y=_("input"),be=y(),X=_("select");for(let L=0;L<Se.length;L+=1)Se[L].c();p(e,"for","weaponType"),p(e,"class","font-bold"),s.__value="Simple Melee",s.value=s.__value,o.__value="Simple Ranged",o.value=o.__value,i.__value="Martial Melee",i.value=i.__value,r.__value="Martial Ranged",r.value=r.__value,p(l,"name","weaponType"),p(l,"id","weaponType"),p(l,"class","border p-1 rounded"),t[1].weaponType===void 0&&Pe(()=>t[17].call(l)),p(c,"for","weaponProperties"),p(c,"class","font-bold"),p(b,"for","range"),p(b,"class","font-bold"),p(E,"id","range"),p(E,"class","border p-1 rounded"),t[1].weaponRange===void 0&&Pe(()=>t[20].call(E)),p(O,"for","damage"),p(O,"class","font-bold"),p(I,"type","checkbox"),p(I,"class","svelte-qhgyyp"),p(C,"class","whitespace-nowrap font-bold text-xs"),N.disabled=j=!t[1].hasOneHandedAttack,p(N,"type","number"),p(N,"inputmode","numeric"),p(N,"class","w-10 text-center border-b"),Q.disabled=ve=!t[1].hasOneHandedAttack,p(Q,"class","border-none bg-transparent"),t[1].oneHandedDiceType===void 0&&Pe(()=>t[23].call(Q)),p(S,"class","flex gap-1 items-center border p-1 rounded bg-white"),$e(S,"opacity-50",!t[1].hasOneHandedAttack),p(R,"class","flex gap-1 items-center"),p(oe,"type","checkbox"),p(oe,"class","svelte-qhgyyp"),p(K,"class","whitespace-nowrap font-bold text-xs"),Y.disabled=pe=!t[1].hasTwoHandedAttack,p(Y,"type","number"),p(Y,"inputmode","numeric"),p(Y,"class","w-10 text-center border-b"),X.disabled=H=!t[1].hasTwoHandedAttack,p(X,"class","border-none bg-transparent"),t[1].twoHandedDiceType===void 0&&Pe(()=>t[26].call(X)),p(F,"class","flex gap-1 items-center border p-1 rounded bg-white"),$e(F,"opacity-50",!t[1].hasTwoHandedAttack),p(de,"class","flex gap-1 items-center")},m(L,ge){w(L,e,ge),w(L,n,ge),w(L,l,ge),f(l,s),f(l,o),f(l,i),f(l,r),he(l,t[1].weaponType,!0),w(L,u,ge),w(L,c,ge),w(L,a,ge),le(d,L,ge),w(L,v,ge),z&&z.m(L,ge),w(L,m,ge),w(L,b,ge),w(L,A,ge),w(L,E,ge);for(let Le=0;Le<Ae.length;Le+=1)Ae[Le]&&Ae[Le].m(E,null);he(E,t[1].weaponRange,!0),w(L,k,ge),w(L,O,ge),w(L,B,ge),w(L,R,ge),f(R,I),I.checked=t[1].hasOneHandedAttack,f(R,M),f(R,S),f(S,C),f(S,$),f(S,N),ae(N,t[1].oneHandedNumDice),f(S,V),f(S,Q);for(let Le=0;Le<x.length;Le+=1)x[Le]&&x[Le].m(Q,null);he(Q,t[1].oneHandedDiceType,!0),w(L,re,ge),w(L,de,ge),f(de,oe),oe.checked=t[1].hasTwoHandedAttack,f(de,q),f(de,F),f(F,K),f(F,ye),f(F,Y),ae(Y,t[1].twoHandedNumDice),f(F,be),f(F,X);for(let Le=0;Le<Se.length;Le+=1)Se[Le]&&Se[Le].m(X,null);he(X,t[1].twoHandedDiceType,!0),Z=!0,me||(_e=[D(l,"change",t[17]),D(E,"change",t[20]),D(I,"change",t[21]),D(N,"input",t[22]),D(Q,"change",t[23]),D(oe,"change",t[24]),D(Y,"input",t[25]),D(X,"change",t[26])],me=!0)},p(L,ge){ge[0]&2&&he(l,L[1].weaponType);const Le={};if(!h&&ge[0]&2&&(h=!0,Le.values=L[1].weaponProperties,Ke(()=>h=!1)),d.$set(Le),ge[0]&2&&(g=L[1].weaponProperties.includes("Magical")),g?z?z.p(L,ge):(z=Oo(L),z.c(),z.m(m.parentNode,m)):z&&(z.d(1),z=null),ge[0]&32){te=Es;let we;for(we=0;we<te.length;we+=1){const lt=Ao(L,te,we);Ae[we]?Ae[we].p(lt,ge):(Ae[we]=Bo(lt),Ae[we].c(),Ae[we].m(E,null))}for(;we<Ae.length;we+=1)Ae[we].d(1);Ae.length=te.length}if(ge[0]&2&&he(E,L[1].weaponRange),ge[0]&2&&(I.checked=L[1].hasOneHandedAttack),(!Z||ge[0]&2&&j!==(j=!L[1].hasOneHandedAttack))&&(N.disabled=j),ge[0]&2&&Re(N.value)!==L[1].oneHandedNumDice&&ae(N,L[1].oneHandedNumDice),ge&0){De=Lt;let we;for(we=0;we<De.length;we+=1){const lt=Eo(L,De,we);x[we]?x[we].p(lt,ge):(x[we]=So(lt),x[we].c(),x[we].m(Q,null))}for(;we<x.length;we+=1)x[we].d(1);x.length=De.length}if((!Z||ge[0]&2&&ve!==(ve=!L[1].hasOneHandedAttack))&&(Q.disabled=ve),ge[0]&2&&he(Q,L[1].oneHandedDiceType),(!Z||ge[0]&2)&&$e(S,"opacity-50",!L[1].hasOneHandedAttack),ge[0]&2&&(oe.checked=L[1].hasTwoHandedAttack),(!Z||ge[0]&2&&pe!==(pe=!L[1].hasTwoHandedAttack))&&(Y.disabled=pe),ge[0]&2&&Re(Y.value)!==L[1].twoHandedNumDice&&ae(Y,L[1].twoHandedNumDice),ge&0){fe=Lt;let we;for(we=0;we<fe.length;we+=1){const lt=To(L,fe,we);Se[we]?Se[we].p(lt,ge):(Se[we]=Ro(lt),Se[we].c(),Se[we].m(X,null))}for(;we<Se.length;we+=1)Se[we].d(1);Se.length=fe.length}(!Z||ge[0]&2&&H!==(H=!L[1].hasTwoHandedAttack))&&(X.disabled=H),ge[0]&2&&he(X,L[1].twoHandedDiceType),(!Z||ge[0]&2)&&$e(F,"opacity-50",!L[1].hasTwoHandedAttack)},i(L){Z||(P(d.$$.fragment,L),Z=!0)},o(L){U(d.$$.fragment,L),Z=!1},d(L){L&&T(e),L&&T(n),L&&T(l),L&&T(u),L&&T(c),L&&T(a),se(d,L),L&&T(v),z&&z.d(L),L&&T(m),L&&T(b),L&&T(A),L&&T(E),ke(Ae,L),L&&T(k),L&&T(O),L&&T(B),L&&T(R),ke(x,L),L&&T(re),L&&T(de),ke(Se,L),me=!1,je(_e)}}}function Ld(t){let e,n,l,s,o,i,r,u,c=t[1].canBeEquipped&&Mo(t);return{c(){e=_("div"),n=_("input"),l=y(),s=_("label"),s.textContent="可裝備？",o=y(),c&&c.c(),i=vt(),p(n,"id","canBeEquipped"),p(n,"type","checkbox"),p(n,"class","svelte-qhgyyp"),p(s,"for","canBeEquipped"),p(e,"class","flex gap-1")},m(a,d){w(a,e,d),f(e,n),n.checked=t[1].canBeEquipped,f(e,l),f(e,s),w(a,o,d),c&&c.m(a,d),w(a,i,d),r||(u=D(n,"change",t[15]),r=!0)},p(a,d){d[0]&2&&(n.checked=a[1].canBeEquipped),a[1].canBeEquipped?c?c.p(a,d):(c=Mo(a),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},i:W,o:W,d(a){a&&T(e),a&&T(o),c&&c.d(a),a&&T(i),r=!1,u()}}}function Co(t){let e,n=gn(t[44])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[44],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function Oo(t){let e,n,l,s,o,i;return{c(){e=_("div"),n=_("label"),n.textContent="魔法武器修正: +",l=y(),s=_("input"),p(n,"for","magicWeaponModifier"),p(s,"id","magicWeaponModifier"),p(s,"type","number"),p(s,"min","0"),p(s,"inputmode","numeric"),p(s,"class","w-10 text-center border p-1 rounded"),p(e,"class","flex flex-row gap-1 items-center")},m(r,u){w(r,e,u),f(e,n),f(e,l),f(e,s),ae(s,t[1].magicWeaponModifier),o||(i=D(s,"input",t[19]),o=!0)},p(r,u){u[0]&2&&Re(s.value)!==r[1].magicWeaponModifier&&ae(s,r[1].magicWeaponModifier)},d(r){r&&T(e),o=!1,i()}}}function Bo(t){let e,n=(t[5][t[41]]??t[41])+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[41],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function So(t){let e,n=t[36]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[36],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function Ro(t){let e,n=t[36]+"",l;return{c(){e=_("option"),l=G(n),e.__value=t[36],e.value=e.__value},m(s,o){w(s,e,o),f(e,l)},p:W,d(s){s&&T(e)}}}function Mo(t){let e,n,l,s,o,i;return{c(){e=_("div"),n=_("input"),l=y(),s=_("label"),s.innerHTML='裝備時顯示於 <span class="pirata text-lg">攻擊</span> 列表？',p(n,"id","attackable"),p(n,"type","checkbox"),p(n,"class","svelte-qhgyyp"),p(s,"for","attackable"),p(e,"class","flex gap-1 items-center")},m(r,u){w(r,e,u),f(e,n),n.checked=t[1].attackable,f(e,l),f(e,s),o||(i=D(n,"change",t[16]),o=!0)},p(r,u){u[0]&2&&(n.checked=r[1].attackable)},d(r){r&&T(e),o=!1,i()}}}function Pd(t){let e;return{c(){e=G("新增")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Hd(t){let e;return{c(){e=G("更新")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Gd(t){let e,n,l,s,o,i,r,u,c,a,d,h,v,g,m,b,A,E,k,O,B,R,I,M,S,C,$,N,j,V,Q,ve,re,de,oe,q,F,K=["gp","sp","cp"],ye=[];for(let H=0;H<3;H+=1)ye[H]=Nd($d(t,K,H));let Y=t[1].showAdvanced&&ko(t);function pe(H,Z){return H[0]?Hd:Pd}let be=pe(t),X=be(t);return{c(){e=_("div"),n=_("div"),l=_("label"),l.innerHTML='名稱<span class="text-red-700">*</span>',s=y(),o=_("input"),i=y(),r=_("div"),u=_("div"),c=_("label"),c.textContent="重量 (lb)",a=y(),d=_("input"),h=y(),v=_("div"),g=_("label"),g.innerHTML='數量<span class="text-red-700">*</span>',m=y(),b=_("input"),A=y(),E=_("div"),k=_("div"),O=_("label"),O.textContent="價格",B=y(),R=_("input"),I=y(),M=_("div"),S=_("select");for(let H=0;H<3;H+=1)ye[H].c();C=y(),$=_("div"),N=_("input"),j=y(),V=_("label"),V.textContent="進階選項",Q=y(),Y&&Y.c(),ve=y(),re=_("button"),X.c(),p(l,"for","name"),p(l,"class","font-bold"),p(o,"id","name"),p(o,"type","text"),p(o,"class","border p-1 rounded"),p(n,"class","flex flex-col gap-1"),p(c,"for","weight"),p(c,"class","font-bold"),p(d,"id","weight"),p(d,"type","number"),p(d,"class","border p-1 rounded"),p(d,"inputmode","numeric"),p(d,"min","0"),p(d,"step","0.1"),p(u,"class","flex flex-col gap-1 w-1/2"),p(g,"for","quantity"),p(g,"class","font-bold"),p(b,"id","quantity"),p(b,"type","number"),p(b,"class","border p-1 rounded"),p(b,"inputmode","numeric"),p(b,"min","1"),p(v,"class","flex flex-col gap-1 w-1/2"),p(r,"class","flex gap-2"),p(O,"for","cost"),p(O,"class","font-bold"),p(R,"id","cost"),p(R,"type","number"),p(R,"class","border p-1 rounded"),p(R,"inputmode","numeric"),p(R,"min","0"),p(k,"class","flex flex-col gap-1 flex-grow"),p(S,"id","currency"),p(S,"class","border p-1 rounded h-[34px]"),t[1].currency===void 0&&Pe(()=>t[12].call(S)),p(M,"class","flex flex-col gap-1 w-16"),p(E,"class","flex gap-2 items-end"),p(N,"id","showAdvanced"),p(N,"type","checkbox"),p(N,"class","svelte-qhgyyp"),p(V,"for","showAdvanced"),p(V,"class","font-bold cursor-pointer"),p($,"class","flex gap-2 items-center mt-2 border-t pt-2"),p(re,"class","mt-4 px-3 hover:bg-gray-700 bg-black text-white p-2 rounded shadow font-bold"),re.disabled=de=!t[2],$e(re,"opacity-50",!t[2]),p(e,"class","flex flex-col gap-2 p-2 max-h-[80vh] overflow-y-auto")},m(H,Z){w(H,e,Z),f(e,n),f(n,l),f(n,s),f(n,o),ae(o,t[1].name),f(e,i),f(e,r),f(r,u),f(u,c),f(u,a),f(u,d),ae(d,t[1].weight),f(r,h),f(r,v),f(v,g),f(v,m),f(v,b),ae(b,t[1].quantity),f(e,A),f(e,E),f(E,k),f(k,O),f(k,B),f(k,R),ae(R,t[1].cost),f(E,I),f(E,M),f(M,S);for(let me=0;me<3;me+=1)ye[me]&&ye[me].m(S,null);he(S,t[1].currency,!0),f(e,C),f(e,$),f($,N),N.checked=t[1].showAdvanced,f($,j),f($,V),f(e,Q),Y&&Y.m(e,null),f(e,ve),f(e,re),X.m(re,null),oe=!0,q||(F=[D(o,"input",t[8]),D(d,"input",t[9]),D(b,"input",t[10]),D(R,"input",t[11]),D(S,"change",t[12]),D(N,"change",t[13]),D(re,"click",t[3])],q=!0)},p(H,Z){Z[0]&2&&o.value!==H[1].name&&ae(o,H[1].name),Z[0]&2&&Re(d.value)!==H[1].weight&&ae(d,H[1].weight),Z[0]&2&&Re(b.value)!==H[1].quantity&&ae(b,H[1].quantity),Z[0]&2&&Re(R.value)!==H[1].cost&&ae(R,H[1].cost),Z[0]&2&&he(S,H[1].currency),Z[0]&2&&(N.checked=H[1].showAdvanced),H[1].showAdvanced?Y?(Y.p(H,Z),Z[0]&2&&P(Y,1)):(Y=ko(H),Y.c(),P(Y,1),Y.m(e,ve)):Y&&(Fe(),U(Y,1,1,()=>{Y=null}),Ve()),be!==(be=pe(H))&&(X.d(1),X=be(H),X&&(X.c(),X.m(re,null))),(!oe||Z[0]&4&&de!==(de=!H[2]))&&(re.disabled=de),(!oe||Z[0]&4)&&$e(re,"opacity-50",!H[2])},i(H){oe||(P(Y),oe=!0)},o(H){U(Y),oe=!1},d(H){H&&T(e),ke(ye,H),Y&&Y.d(),X.d(),q=!1,je(F)}}}function Ud(t){var n;if(!t)return 0;let e=(n=t==null?void 0:t.playerBonuses)==null?void 0:n.find(l=>l.type==="modifyAmt"&&l.bonusTo==="attackRoll");return(e==null?void 0:e.bonusAmount)??0}function Fd(t){return t&&t.range||"5 ft"}function Vd(t,e,n){var ye,Y,pe,be,X,H,Z,me,_e,ue,ce,z,te,Ae,De,x;let l,s,o;Me(t,Ne,fe=>n(33,o=fe));const i=yn();let{gear:r=void 0}=e;const u=o.gear.find(fe=>fe.name===(r==null?void 0:r.name)),c={name:(r==null?void 0:r.name)??void 0,weight:(r==null?void 0:r.weight)??0,cost:((ye=r==null?void 0:r.cost)==null?void 0:ye.gp)??0,currency:"gp",quantity:(u==null?void 0:u.quantity)??1,showAdvanced:(r==null?void 0:r.type)!==void 0&&(r==null?void 0:r.type)!=="Basic",gearType:(r==null?void 0:r.type)??"Basic",canBeEquipped:(r==null?void 0:r.canBeEquipped)??!1,attackable:((Y=r==null?void 0:r.properties)==null?void 0:Y.includes("Attackable"))??!1,weaponProperties:(r==null?void 0:r.properties)??[],magicWeaponModifier:Ud(r),weaponType:(r==null?void 0:r.weaponType)??"Simple Melee",weaponRange:Fd(r),hasOneHandedAttack:r?!!((pe=r==null?void 0:r.damage)!=null&&pe.oneHanded):!0,oneHandedNumDice:((X=(be=r==null?void 0:r.damage)==null?void 0:be.oneHanded)==null?void 0:X.numDice)??1,oneHandedDiceType:((Z=(H=r==null?void 0:r.damage)==null?void 0:H.oneHanded)==null?void 0:Z.diceType)??"d6",hasTwoHandedAttack:!!((me=r==null?void 0:r.damage)!=null&&me.twoHanded),twoHandedNumDice:((ue=(_e=r==null?void 0:r.damage)==null?void 0:_e.twoHanded)==null?void 0:ue.numDice)??1,twoHandedDiceType:((z=(ce=r==null?void 0:r.damage)==null?void 0:ce.twoHanded)==null?void 0:z.diceType)??"d8",baseAC:((te=r==null?void 0:r.ac)==null?void 0:te.base)??10,armorProperties:(r==null?void 0:r.properties)??[],acModifier:((Ae=r==null?void 0:r.ac)==null?void 0:Ae.modifier)??0,armorStat:(De=r==null?void 0:r.ac)==null?void 0:De.stat,maxDex:(x=r==null?void 0:r.ac)==null?void 0:x.maxDex};let a=JSON.parse(JSON.stringify(c));function d(){var Se;let fe={name:a.name,type:a.gearType,canBeEquipped:a.canBeEquipped,desc:a.name,weight:a.weight,editable:!0,playerBonuses:[],cost:{gp:0,sp:0,cp:0,ep:0,pp:0,[a.currency]:a.cost}};switch(a.gearType){case"Basic":{a.canBeEquipped&&a.attackable&&(fe.properties=["Attackable"]);break}case"Weapon":{let L=fe;L.properties=a.weaponProperties,L.weaponType=a.weaponType,L.range=a.weaponRange,L.canBeEquipped=!0,L.damage={},a.hasOneHandedAttack&&(L.damage.oneHanded={numDice:a.oneHandedNumDice,diceType:a.oneHandedDiceType}),a.hasTwoHandedAttack&&(L.damage.twoHanded={numDice:a.twoHandedNumDice,diceType:a.twoHandedDiceType}),a.weaponProperties.includes("Magical")&&a.magicWeaponModifier>0&&(L.playerBonuses.push({name:L.name+`: +${a.magicWeaponModifier} to atk`,desc:`+${a.magicWeaponModifier} to attack rolls when ${L.name} is equipped`,type:"modifyAmt",bonusAmount:a.magicWeaponModifier,bonusTo:"attackRoll",bonusSource:"Gear",editable:!1,metadata:{type:"weapon",weapon:L.name}}),L.playerBonuses.push({name:L.name+`: +${a.magicWeaponModifier} to dmg`,desc:`+${a.magicWeaponModifier} to damage rolls when ${L.name} is equipped`,type:"modifyAmt",bonusAmount:a.magicWeaponModifier,bonusTo:"damageRoll",bonusSource:"Gear",editable:!1,metadata:{type:"weapon",weapon:L.name}}));break}case"Armor":{let L=fe;L.properties=a.armorProperties,L.canBeEquipped=!0,L.ac={base:a.baseAC,modifier:a.acModifier,stat:a.armorStat,maxDex:a.maxDex};break}}if(r){for(let L in r)r.hasOwnProperty(L)&&delete r[L];fe.type!=="Basic"&&(fe.properties=(Se=fe.properties)==null?void 0:Se.filter(L=>L!=="Attackable")),Object.assign(r,fe),u&&(u.name=fe.name,u.quantity=a.quantity)}else o.customGear.push(fe),o.gear.push({name:fe.name,quantity:a.quantity});Ne.set(o),i("finish")}const h={Ammunition:"彈藥",Finesse:"靈巧",Heavy:"重型",Light:"輕型",Loading:"裝填",Range:"射程",Reach:"長觸",Special:"特殊",Thrown:"投擲","Two-Handed":"雙手",Versatile:"靈活",Silvered:"鍍銀",Magical:"魔法"},v={"5 ft":"5 尺","10 ft":"10 尺","30 ft":"30 尺","60 ft":"60 尺","120 ft":"120 尺",Touch:"觸碰",Sight:"視線",Self:"自身"},g={Shield:"盾牌","+1":"+1","+2":"+2","+3":"+3",Magic:"魔法"};function m(){a.name=this.value,n(1,a)}function b(){a.weight=Re(this.value),n(1,a)}function A(){a.quantity=Re(this.value),n(1,a)}function E(){a.cost=Re(this.value),n(1,a)}function k(){a.currency=Ge(this),n(1,a)}function O(){a.showAdvanced=this.checked,n(1,a)}function B(){a.gearType=Ge(this),n(1,a)}function R(){a.canBeEquipped=this.checked,n(1,a)}function I(){a.attackable=this.checked,n(1,a)}function M(){a.weaponType=Ge(this),n(1,a)}function S(fe){t.$$.not_equal(a.weaponProperties,fe)&&(a.weaponProperties=fe,n(1,a))}function C(){a.magicWeaponModifier=Re(this.value),n(1,a)}function $(){a.weaponRange=Ge(this),n(1,a)}function N(){a.hasOneHandedAttack=this.checked,n(1,a)}function j(){a.oneHandedNumDice=Re(this.value),n(1,a)}function V(){a.oneHandedDiceType=Ge(this),n(1,a)}function Q(){a.hasTwoHandedAttack=this.checked,n(1,a)}function ve(){a.twoHandedNumDice=Re(this.value),n(1,a)}function re(){a.twoHandedDiceType=Ge(this),n(1,a)}function de(fe){t.$$.not_equal(a.armorProperties,fe)&&(a.armorProperties=fe,n(1,a))}function oe(){a.baseAC=Re(this.value),n(1,a)}function q(){a.acModifier=Re(this.value),n(1,a)}function F(){a.armorStat=Ge(this),n(1,a)}function K(){a.maxDex=Ge(this),n(1,a)}return t.$$set=fe=>{"gear"in fe&&n(0,r=fe.gear)},t.$$.update=()=>{var fe;if(t.$$.dirty[0]&2&&(a.showAdvanced||(n(1,a.gearType="Basic",a),n(1,a.canBeEquipped=!1,a),n(1,a.attackable=!1,a))),t.$$.dirty[0]&2&&n(7,l=a.gearType!=="Weapon"||a.hasOneHandedAttack||a.hasTwoHandedAttack),t.$$.dirty[0]&130&&n(2,s=((fe=a.name)==null?void 0:fe.length)>0&&a.quantity>0&&l),t.$$.dirty[0]&2)if(a.hasOneHandedAttack&&a.hasTwoHandedAttack)a.weaponProperties.includes("Versatile")||a.weaponProperties.push("Versatile");else{const Se=a.weaponProperties.findIndex(L=>L==="Versatile");Se>=0&&a.weaponProperties.splice(Se,1)}},[r,a,s,d,h,v,g,l,m,b,A,E,k,O,B,R,I,M,S,C,$,N,j,V,Q,ve,re,de,oe,q,F,K]}class tr extends Oe{constructor(e){super(),Be(this,e,Vd,Gd,Ce,{gear:0},null,[-1,-1])}}function $o(t){let e,n,l;function s(i){t[4](i)}let o={vw:50,$$slots:{header:[Wd],default:[jd]},$$scope:{ctx:t}};return t[1]!==void 0&&(o.showModal=t[1]),e=new ft({props:o}),We.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&33&&(u.$$scope={dirty:r,ctx:i}),!n&&r&2&&(n=!0,u.showModal=i[1],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){U(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function jd(t){let e,n;return e=new tr({}),e.$on("finish",t[3]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p:W,i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Wd(t){let e;return{c(){e=_("h1"),e.textContent="Custom Gear",p(e,"slot","header")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function qd(t){let e,n,l,s,o,i,r=t[0]&&$o(t);return{c(){e=_("button"),e.textContent="Custom Gear",n=y(),r&&r.c(),l=vt(),p(e,"class","bg-black text-white px-2")},m(u,c){w(u,e,c),w(u,n,c),r&&r.m(u,c),w(u,l,c),s=!0,o||(i=D(e,"click",t[2]),o=!0)},p(u,[c]){u[0]?r?(r.p(u,c),c&1&&P(r,1)):(r=$o(u),r.c(),P(r,1),r.m(l.parentNode,l)):r&&(Fe(),U(r,1,1,()=>{r=null}),Ve())},i(u){s||(P(r),s=!0)},o(u){U(r),s=!1},d(u){u&&T(e),u&&T(n),r&&r.d(u),u&&T(l),o=!1,i()}}}function zd(t,e,n){let l=!1,s=!1;const o=()=>{n(0,l=!0),n(1,s=!0)},i=()=>{n(0,l=!1)};function r(u){s=u,n(1,s)}return[l,s,o,i,r]}class Yd extends Oe{constructor(e){super(),Be(this,e,zd,qd,Ce,{})}}function No(t,e,n){const l=t.slice();return l[23]=e[n],l[25]=n,l}function Io(t){let e,n=t[23].desc+"",l;return{c(){e=_("div"),l=G(n),p(e,"class","text-gray-500 truncate max-w-[120px]")},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&256&&n!==(n=s[23].desc+"")&&ee(l,n)},d(s){s&&T(e)}}}function Do(t){let e,n,l,s,o;function i(){return t[18](t[23])}function r(){return t[19](t[23])}return{c(){e=_("button"),e.innerHTML='<i class="material-icons text-sm">delete</i>',n=y(),l=_("button"),l.innerHTML='<i class="material-icons text-sm">edit</i>',p(e,"class","bg-gray-800 rounded text-white px-1 py-0.5"),p(e,"title","刪除"),p(l,"class","bg-gray-800 rounded text-white px-1 py-0.5"),p(l,"title","編輯")},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c),s||(o=[D(e,"click",i),D(l,"click",r)],s=!0)},p(u,c){t=u},d(u){u&&T(e),u&&T(n),u&&T(l),s=!1,je(o)}}}function Lo(t){var C;let e,n,l,s=(((C=t[23].l10n)==null?void 0:C.name)??t[23].name)+"",o,i,r,u,c=Ho(t[23])+"",a,d,h,v=(t[23].weight??0)+"",g,m,b,A,E,k,O,B,R,I=t[23].desc&&Io(t),M=t[23].editable&&Do(t);function S(){return t[20](t[23])}return{c(){e=_("tr"),n=_("td"),l=_("div"),o=G(s),i=y(),I&&I.c(),r=y(),u=_("td"),a=G(c),d=y(),h=_("td"),g=G(v),m=G(" lb"),b=y(),A=_("td"),M&&M.c(),E=y(),k=_("button"),k.innerHTML='<i class="material-icons">add_circle</i>',O=y(),p(l,"class","font-bold"),p(n,"class","pl-2 py-2"),p(u,"class","whitespace-nowrap"),p(k,"class","text-green-700 hover:text-green-900"),p(k,"title","購買/加入"),p(A,"class","flex justify-end gap-1 pr-2 py-2 items-center"),p(e,"class","border-b hover:bg-gray-50 text-xs"),$e(e,"bg-gray-50",t[25]%2==0)},m($,N){w($,e,N),f(e,n),f(n,l),f(l,o),f(n,i),I&&I.m(n,null),f(e,r),f(e,u),f(u,a),f(e,d),f(e,h),f(h,g),f(h,m),f(e,b),f(e,A),M&&M.m(A,null),f(A,E),f(A,k),f(e,O),B||(R=D(k,"click",S),B=!0)},p($,N){var j;t=$,N&256&&s!==(s=(((j=t[23].l10n)==null?void 0:j.name)??t[23].name)+"")&&ee(o,s),t[23].desc?I?I.p(t,N):(I=Io(t),I.c(),I.m(n,null)):I&&(I.d(1),I=null),N&256&&c!==(c=Ho(t[23])+"")&&ee(a,c),N&256&&v!==(v=(t[23].weight??0)+"")&&ee(g,v),t[23].editable?M?M.p(t,N):(M=Do(t),M.c(),M.m(A,E)):M&&(M.d(1),M=null)},d($){$&&T(e),I&&I.d(),M&&M.d(),B=!1,R()}}}function Po(t){let e,n,l;function s(i){t[22](i)}let o={$$slots:{header:[Xd],default:[Kd]},$$scope:{ctx:t}};return t[7]!==void 0&&(o.showModal=t[7]),e=new ft({props:o}),We.push(()=>Ye(e,"showModal",s)),{c(){ne(e.$$.fragment)},m(i,r){le(e,i,r),l=!0},p(i,r){const u={};r&67109056&&(u.$$scope={dirty:r,ctx:i}),!n&&r&128&&(n=!0,u.showModal=i[7],Ke(()=>n=!1)),e.$set(u)},i(i){l||(P(e.$$.fragment,i),l=!0)},o(i){U(e.$$.fragment,i),l=!1},d(i){se(e,i)}}}function Kd(t){let e,n;return e=new tr({props:{gear:t[6]}}),e.$on("finish",t[21]),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&64&&(o.gear=l[6]),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function Xd(t){let e;return{c(){e=_("h2"),e.textContent="自訂裝備",p(e,"slot","header")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function Jd(t){let e,n,l,s,o,i,r,u,c,a,d,h,v,g,m,b,A,E,k,O,B,R,I,M,S,C,$,N,j,V,Q,ve,re,de,oe,q,F,K;function ye(H){t[12](H)}let Y={placeholder:"搜尋 例如: 長劍",class:"w-full"};t[5]!==void 0&&(Y.value=t[5]),l=new Qa({props:Y}),We.push(()=>Ye(l,"value",ye));let pe=t[8],be=[];for(let H=0;H<pe.length;H+=1)be[H]=Lo(No(t,pe,H));let X=t[7]&&t[6]&&Po(t);return{c(){e=_("div"),n=_("div"),ne(l.$$.fragment),o=y(),i=_("div"),r=_("div"),r.textContent="過濾:",u=y(),c=_("label"),a=_("input"),d=G(" 武器"),h=y(),v=_("label"),g=_("input"),m=G(" 防具"),b=y(),A=_("label"),E=_("input"),k=G(" 基礎"),O=y(),B=_("label"),R=_("input"),I=G(" 自訂"),M=y(),S=_("label"),C=_("input"),$=G(" 買得起"),N=y(),j=_("div"),V=_("table"),Q=_("thead"),Q.innerHTML=`<tr><th class="pl-2 py-1">名稱</th> 
          <th class="py-1">價格</th> 
          <th class="py-1">重量</th> 
          <th class="pr-2 py-1"></th></tr>`,ve=y(),re=_("tbody");for(let H=0;H<be.length;H+=1)be[H].c();de=y(),X&&X.c(),oe=vt(),p(r,"class","font-bold"),p(a,"type","checkbox"),p(c,"class","flex gap-1 items-center"),p(g,"type","checkbox"),p(v,"class","flex gap-1 items-center"),p(E,"type","checkbox"),p(A,"class","flex gap-1 items-center"),p(R,"type","checkbox"),p(B,"class","flex gap-1 items-center"),p(C,"type","checkbox"),p(S,"class","flex gap-1 items-center border-l pl-1 ml-1 border-gray-400"),p(i,"class","flex gap-1 items-center flex-wrap text-sm mt-1"),p(n,"class","p-2 border-b"),p(Q,"class","text-left sticky top-0 bg-white shadow-sm z-10"),p(V,"class","w-full text-sm"),p(j,"class","overflow-auto flex-1"),p(e,"class","border-b flex flex-col gap-1 h-full overflow-hidden")},m(H,Z){w(H,e,Z),f(e,n),le(l,n,null),f(n,o),f(n,i),f(i,r),f(i,u),f(i,c),f(c,a),a.checked=t[1],f(c,d),f(i,h),f(i,v),f(v,g),g.checked=t[2],f(v,m),f(i,b),f(i,A),f(A,E),E.checked=t[3],f(A,k),f(i,O),f(i,B),f(B,R),R.checked=t[4],f(B,I),f(i,M),f(i,S),f(S,C),C.checked=t[0],f(S,$),f(e,N),f(e,j),f(j,V),f(V,Q),f(V,ve),f(V,re);for(let me=0;me<be.length;me+=1)be[me]&&be[me].m(re,null);w(H,de,Z),X&&X.m(H,Z),w(H,oe,Z),q=!0,F||(K=[D(a,"change",t[13]),D(g,"change",t[14]),D(E,"change",t[15]),D(R,"change",t[16]),D(C,"change",t[17])],F=!0)},p(H,[Z]){const me={};if(!s&&Z&32&&(s=!0,me.value=H[5],Ke(()=>s=!1)),l.$set(me),Z&2&&(a.checked=H[1]),Z&4&&(g.checked=H[2]),Z&8&&(E.checked=H[3]),Z&16&&(R.checked=H[4]),Z&1&&(C.checked=H[0]),Z&1984){pe=H[8];let _e;for(_e=0;_e<pe.length;_e+=1){const ue=No(H,pe,_e);be[_e]?be[_e].p(ue,Z):(be[_e]=Lo(ue),be[_e].c(),be[_e].m(re,null))}for(;_e<be.length;_e+=1)be[_e].d(1);be.length=pe.length}H[7]&&H[6]?X?(X.p(H,Z),Z&192&&P(X,1)):(X=Po(H),X.c(),P(X,1),X.m(oe.parentNode,oe)):X&&(Fe(),U(X,1,1,()=>{X=null}),Ve())},i(H){q||(P(l.$$.fragment,H),P(X),q=!0)},o(H){U(l.$$.fragment,H),U(X),q=!1},d(H){H&&T(e),se(l),ke(be,H),H&&T(de),X&&X.d(H),H&&T(oe),F=!1,je(K)}}}function Ho(t){const{gp:e,sp:n,cp:l}=t.cost;let s=[];return e&&s.push(`${e}gp`),n&&s.push(`${n}sp`),l&&s.push(`${l}cp`),s.length>0?s.join(" "):"0cp"}function Zd(t,e,n){let l,s;Me(t,Ne,C=>n(11,s=C));let o,i=!1,r=!1,u=!0,c=!0,a=!0,d=!1,h="";function v(C){const $=s.gear.find(N=>N.name===C.name);if($)$.quantity++;else{const N={name:C.name,quantity:1};s.gear.push(N)}Ne.set(s)}function g(C){ze(Ne,s.gear=s.gear.filter($=>$.name!==C.name),s),ze(Ne,s.bonuses=s.bonuses.filter($=>{var N,j;return!(((N=$.metadata)==null?void 0:N.type)==="weapon"&&$.metadata.weapon===C.name||((j=$.metadata)==null?void 0:j.type)==="armor"&&$.metadata.armor===C.name)}),s),ze(Ne,s.customGear=s.customGear.filter($=>$.name!==C.name),s)}function m(C){h=C,n(5,h)}function b(){u=this.checked,n(1,u)}function A(){c=this.checked,n(2,c)}function E(){a=this.checked,n(3,a)}function k(){d=this.checked,n(4,d)}function O(){r=this.checked,n(0,r)}const B=C=>g(C),R=C=>{n(6,o=C),n(7,i=!0)},I=C=>v(C),M=()=>{n(7,i=!1),n(6,o=void 0)};function S(C){i=C,n(7,i)}return t.$$.update=()=>{t.$$.dirty&2111&&n(8,l=Object.values(Hl).concat(Object.values(Pl)).concat(Object.values(Ul)).concat(s.customGear??[]).filter(C=>d&&!s.customGear.find($=>$.name===C.name)||!u&&C.type==="Weapon"||!c&&C.type==="Armor"||!a&&C.type==="Basic"||r&&!Kr(s,C)?!1:C.name.toLowerCase().includes(h.toLowerCase())))},[r,u,c,a,d,h,o,i,l,v,g,s,m,b,A,E,k,O,B,R,I,M,S]}class Qd extends Oe{constructor(e){super(),Be(this,e,Zd,Jd,Ce,{})}}function xd(t){let e,n;return e=new Qd({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function ep(t){let e;return{c(){e=_("h1"),e.textContent="裝備",p(e,"slot","header"),p(e,"class","min-w-[300px]")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function tp(t){let e,n,l,s,o,i,r;function u(a){t[2](a)}let c={vh:90,$$slots:{header:[ep],default:[xd]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),We.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.textContent="裝備",n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white px-3 rounded-md")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=D(e,"click",t[1]),i=!0)},p(a,[d]){const h={};d&8&&(h.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,h.showModal=a[0],Ke(()=>s=!1)),l.$set(h)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){U(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function np(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function o(i){l=i,n(0,l)}return[l,s,o]}class lp extends Oe{constructor(e){super(),Be(this,e,np,tp,Ce,{})}}function Go(t){const e=nt(t.name);return e?(e.weight||0)*t.quantity:(console.log("Cannot find gear: "+t.name),0)}function Uo(t,e,n){const l=t.slice();return l[16]=e[n],l[18]=n,l}function Fo(t){let e;return{c(){e=G("(超重)")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Vo(t){let e,n=t[16].quantity+"",l;return{c(){e=G("x "),l=G(n)},m(s,o){w(s,e,o),w(s,l,o)},p(s,o){o&16&&n!==(n=s[16].quantity+"")&&ee(l,n)},d(s){s&&T(e),s&&T(l)}}}function jo(t){var s;let e,n=((s=nt(t[16].name))==null?void 0:s.desc)+"",l;return{c(){e=_("div"),l=G(n),p(e,"class","text-xs text-gray-600 truncate max-w-[200px]")},m(o,i){w(o,e,i),f(e,l)},p(o,i){var r;i&16&&n!==(n=((r=nt(o[16].name))==null?void 0:r.desc)+"")&&ee(l,n)},d(o){o&&T(e)}}}function Wo(t){let e,n,l,s,o,i,r;function u(){return t[13](t[16])}return{c(){e=_("label"),n=_("input"),s=y(),o=_("span"),o.textContent="裝備",p(n,"title","Equipped"),p(n,"type","checkbox"),p(n,"class","w-5 h-5"),n.checked=l=t[16].equipped,p(o,"class","text-[10px]"),p(e,"class","flex flex-col items-center")},m(c,a){w(c,e,a),f(e,n),f(e,s),f(e,o),i||(r=D(n,"click",u),i=!0)},p(c,a){t=c,a&16&&l!==(l=t[16].equipped)&&(n.checked=l)},d(c){c&&T(e),i=!1,r()}}}function qo(t){let e,n,l,s,o,i,r;function u(){return t[14](t[16])}return{c(){e=_("label"),n=_("input"),s=y(),o=_("span"),o.textContent="同調",p(n,"title","Attuned"),p(n,"type","checkbox"),p(n,"class","w-5 h-5 accent-purple-600"),n.checked=l=t[16].attuned,p(o,"class","text-[10px]"),p(e,"class","flex flex-col items-center text-purple-700")},m(c,a){w(c,e,a),f(e,n),f(e,s),f(e,o),i||(r=D(n,"click",u),i=!0)},p(c,a){t=c,a&16&&l!==(l=t[16].attuned)&&(n.checked=l)},d(c){c&&T(e),i=!1,r()}}}function zo(t){var Q,ve,re,de,oe,q;let e,n,l,s,o,i=(((ve=(Q=nt(t[16].name))==null?void 0:Q.l10n)==null?void 0:ve.name)??t[16].name)+"",r,u,c,a,d=Go(t[16])+"",h,v,g,m=(re=nt(t[16].name))==null?void 0:re.desc,b,A,E=(de=nt(t[16].name))==null?void 0:de.canBeEquipped,k,O=(q=(oe=nt(t[16].name))==null?void 0:oe.properties)==null?void 0:q.includes("Attunement"),B,R,I,M,S,C=t[16].quantity>1&&Vo(t),$=m&&jo(t),N=E&&Wo(t),j=O&&qo(t);function V(){return t[15](t[16])}return{c(){e=_("li"),n=_("div"),l=_("div"),s=_("div"),o=_("span"),r=G(i),u=y(),C&&C.c(),c=y(),a=_("span"),h=G(d),v=G(" lb"),g=y(),$&&$.c(),b=y(),A=_("div"),N&&N.c(),k=y(),j&&j.c(),B=y(),R=_("button"),R.innerHTML='<i class="material-icons text-sm">delete</i>',I=y(),p(o,"class","font-bold"),p(a,"class","text-xs text-gray-500"),p(s,"class","flex justify-between items-center w-full"),p(l,"class","flex flex-col w-full"),p(R,"class","p-1 rounded bg-black text-white hover:bg-gray-700"),p(R,"title","Delete"),p(A,"class","flex gap-2 items-center flex-shrink-0"),p(n,"class","flex gap-1 items-center justify-between"),p(e,"class","border-b border-gray-300 pb-1")},m(F,K){w(F,e,K),f(e,n),f(n,l),f(l,s),f(s,o),f(o,r),f(o,u),C&&C.m(o,null),f(s,c),f(s,a),f(a,h),f(a,v),f(l,g),$&&$.m(l,null),f(n,b),f(n,A),N&&N.m(A,null),f(A,k),j&&j.m(A,null),f(A,B),f(A,R),f(e,I),M||(S=D(R,"click",V),M=!0)},p(F,K){var ye,Y,pe,be,X,H;t=F,K&16&&i!==(i=(((Y=(ye=nt(t[16].name))==null?void 0:ye.l10n)==null?void 0:Y.name)??t[16].name)+"")&&ee(r,i),t[16].quantity>1?C?C.p(t,K):(C=Vo(t),C.c(),C.m(o,null)):C&&(C.d(1),C=null),K&16&&d!==(d=Go(t[16])+"")&&ee(h,d),K&16&&(m=(pe=nt(t[16].name))==null?void 0:pe.desc),m?$?$.p(t,K):($=jo(t),$.c(),$.m(l,null)):$&&($.d(1),$=null),K&16&&(E=(be=nt(t[16].name))==null?void 0:be.canBeEquipped),E?N?N.p(t,K):(N=Wo(t),N.c(),N.m(A,k)):N&&(N.d(1),N=null),K&16&&(O=(H=(X=nt(t[16].name))==null?void 0:X.properties)==null?void 0:H.includes("Attunement")),O?j?j.p(t,K):(j=qo(t),j.c(),j.m(A,B)):j&&(j.d(1),j=null)},d(F){F&&T(e),C&&C.d(),$&&$.d(),N&&N.d(),j&&j.d(),M=!1,S()}}}function sp(t){let e,n,l,s,o,i,r,u,c,a,d,h,v,g,m,b,A,E,k,O,B,R,I,M,S,C,$,N,j,V,Q,ve,re,de,oe,q,F,K,ye,Y,pe,be,X,H,Z,me,_e=t[3]&&Fo();h=new lp({}),g=new Yd({});let ue=t[4],ce=[];for(let z=0;z<ue.length;z+=1)ce[z]=zo(Uo(t,ue,z));return{c(){e=_("div"),n=_("div"),l=_("h2"),l.textContent="裝備",s=y(),o=_("span"),i=G(t[1]),r=G(" / "),u=G(t[0]),c=G(` lb
      `),_e&&_e.c(),a=y(),d=_("div"),ne(h.$$.fragment),v=y(),ne(g.$$.fragment),m=y(),b=_("div"),A=_("div"),E=_("label"),E.textContent="PP",k=y(),O=_("input"),B=y(),R=_("div"),I=_("label"),I.textContent="GP",M=y(),S=_("input"),C=y(),$=_("div"),N=_("label"),N.textContent="EP",j=y(),V=_("input"),Q=y(),ve=_("div"),re=_("label"),re.textContent="SP",de=y(),oe=_("input"),q=y(),F=_("div"),K=_("label"),K.textContent="CP",ye=y(),Y=_("input"),pe=y(),be=_("div"),X=_("ul");for(let z=0;z<ce.length;z+=1)ce[z].c();$e(o,"text-red-600",t[3]),p(n,"class","flex gap-2 items-center"),p(d,"class","flex gap-1"),p(e,"class","flex gap-1 p-1 items-center justify-between"),p(E,"for","pp"),p(O,"type","number"),p(O,"id","pp"),p(O,"class","w-12 border rounded px-1"),p(A,"class","flex items-center gap-1"),p(I,"for","gp"),p(S,"type","number"),p(S,"id","gp"),p(S,"class","w-12 border rounded px-1"),p(R,"class","flex items-center gap-1"),p(N,"for","ep"),p(V,"type","number"),p(V,"id","ep"),p(V,"class","w-12 border rounded px-1"),p($,"class","flex items-center gap-1"),p(re,"for","sp"),p(oe,"type","number"),p(oe,"id","sp"),p(oe,"class","w-12 border rounded px-1"),p(ve,"class","flex items-center gap-1"),p(K,"for","cp"),p(Y,"type","number"),p(Y,"id","cp"),p(Y,"class","w-12 border rounded px-1"),p(F,"class","flex items-center gap-1"),p(b,"class","flex gap-2 p-1 border-b border-gray-300 pb-2 mb-2 flex-wrap text-sm"),p(X,"class","flex flex-col gap-1"),p(be,"class","overflow-scroll flex flex-col gap-1 p-2 h-full"),En(be,"box-shadow","inset 0 0 5px #000")},m(z,te){w(z,e,te),f(e,n),f(n,l),f(n,s),f(n,o),f(o,i),f(o,r),f(o,u),f(o,c),_e&&_e.m(o,null),f(e,a),f(e,d),le(h,d,null),f(d,v),le(g,d,null),w(z,m,te),w(z,b,te),f(b,A),f(A,E),f(A,k),f(A,O),ae(O,t[2].currency.pp),f(b,B),f(b,R),f(R,I),f(R,M),f(R,S),ae(S,t[2].currency.gp),f(b,C),f(b,$),f($,N),f($,j),f($,V),ae(V,t[2].currency.ep),f(b,Q),f(b,ve),f(ve,re),f(ve,de),f(ve,oe),ae(oe,t[2].currency.sp),f(b,q),f(b,F),f(F,K),f(F,ye),f(F,Y),ae(Y,t[2].currency.cp),w(z,pe,te),w(z,be,te),f(be,X);for(let Ae=0;Ae<ce.length;Ae+=1)ce[Ae]&&ce[Ae].m(X,null);H=!0,Z||(me=[D(O,"input",t[8]),D(S,"input",t[9]),D(V,"input",t[10]),D(oe,"input",t[11]),D(Y,"input",t[12])],Z=!0)},p(z,[te]){if((!H||te&2)&&ee(i,z[1]),(!H||te&1)&&ee(u,z[0]),z[3]?_e||(_e=Fo(),_e.c(),_e.m(o,null)):_e&&(_e.d(1),_e=null),(!H||te&8)&&$e(o,"text-red-600",z[3]),te&4&&Re(O.value)!==z[2].currency.pp&&ae(O,z[2].currency.pp),te&4&&Re(S.value)!==z[2].currency.gp&&ae(S,z[2].currency.gp),te&4&&Re(V.value)!==z[2].currency.ep&&ae(V,z[2].currency.ep),te&4&&Re(oe.value)!==z[2].currency.sp&&ae(oe,z[2].currency.sp),te&4&&Re(Y.value)!==z[2].currency.cp&&ae(Y,z[2].currency.cp),te&240){ue=z[4];let Ae;for(Ae=0;Ae<ue.length;Ae+=1){const De=Uo(z,ue,Ae);ce[Ae]?ce[Ae].p(De,te):(ce[Ae]=zo(De),ce[Ae].c(),ce[Ae].m(X,null))}for(;Ae<ce.length;Ae+=1)ce[Ae].d(1);ce.length=ue.length}},i(z){H||(P(h.$$.fragment,z),P(g.$$.fragment,z),H=!0)},o(z){U(h.$$.fragment,z),U(g.$$.fragment,z),H=!1},d(z){z&&T(e),_e&&_e.d(),se(h),se(g),z&&T(m),z&&T(b),z&&T(pe),z&&T(be),ke(ce,z),Z=!1,je(me)}}}function ip(t,e,n){let l,s,o,i,r;Me(t,Ne,k=>n(2,r=k));function u(k){const O=r.gear.findIndex(R=>R.name===k),B=r.gear[O];B.quantity>1?B.quantity-=1:r.gear.splice(O,1),Ne.set(r)}function c(k){k.equipped=!k.equipped,Ne.set(r)}function a(k){k.attuned=!k.attuned,Ne.set(r)}function d(){r.currency.pp=Re(this.value),Ne.set(r)}function h(){r.currency.gp=Re(this.value),Ne.set(r)}function v(){r.currency.ep=Re(this.value),Ne.set(r)}function g(){r.currency.sp=Re(this.value),Ne.set(r)}function m(){r.currency.cp=Re(this.value),Ne.set(r)}const b=k=>c(k),A=k=>a(k),E=k=>u(k.name);return t.$$.update=()=>{t.$$.dirty&4&&n(4,l=r.gear.sort((k,O)=>Qn(k.name,O.name))),t.$$.dirty&4&&n(1,s=Ur(r)),t.$$.dirty&4&&n(0,o=Gr(r)),t.$$.dirty&3&&n(3,i=s>o)},[o,s,r,i,l,u,c,a,d,h,v,g,m,b,A,E]}class op extends Oe{constructor(e){super(),Be(this,e,ip,sp,Ce,{})}}const{Boolean:ap}=va;function Yo(t,e,n){const l=t.slice();return l[5]=e[n],l}function Ko(t,e,n){const l=t.slice();l[8]=e[n];const s=Dn(l[0],l[8]);l[9]=s;const o=l[9]!==0?In(l[9]):"";l[10]=o;const i={Close:"貼身",Near:"近距",Far:"遠距",Self:"自身"};return l[11]=i,l}function El(t){const e=t.slice(),n=Oa(e[0],e[8],"twoHanded");return e[14]=n,e}function Al(t){const e=t.slice(),n=Oa(e[0],e[8],"oneHanded");return e[14]=n,e}function Xo(t){let e,n;return e=new Gn({props:{diceType:t[14],numDice:t[8].damage.oneHanded.numDice,modifier:Dn(t[0],t[8]),$$slots:{default:[rp]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&5&&(o.diceType=l[14]),s&4&&(o.numDice=l[8].damage.oneHanded.numDice),s&5&&(o.modifier=Dn(l[0],l[8])),s&32773&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function rp(t){let e,n,l=`${t[8].damage.oneHanded.numDice}${t[14]}${t[10]}`,s,o,i;return{c(){e=_("div"),n=_("span"),s=G(l),o=y(),i=_("i"),i.textContent="back_hand",p(i,"class","material-icons"),p(e,"class","bg-black text-white p-1 px-2 rounded-md flex flex-col items-center text-xs")},m(r,u){w(r,e,u),f(e,n),f(n,s),f(e,o),f(e,i)},p(r,u){u&5&&l!==(l=`${r[8].damage.oneHanded.numDice}${r[14]}${r[10]}`)&&ee(s,l)},d(r){r&&T(e)}}}function Jo(t){let e,n;return e=new Gn({props:{diceType:t[14],numDice:t[8].damage.twoHanded.numDice,modifier:Dn(t[0],t[8]),$$slots:{default:[up]},$$scope:{ctx:t}}}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},p(l,s){const o={};s&5&&(o.diceType=l[14]),s&4&&(o.numDice=l[8].damage.twoHanded.numDice),s&5&&(o.modifier=Dn(l[0],l[8])),s&32773&&(o.$$scope={dirty:s,ctx:l}),e.$set(o)},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function up(t){let e,n,l=`${t[8].damage.twoHanded.numDice}${t[14]}${t[10]}`,s,o,i;return{c(){e=_("div"),n=_("span"),s=G(l),o=y(),i=_("i"),i.textContent="sign_language",p(i,"class","material-icons"),p(e,"class","bg-black text-white rounded-md p-1 px-2 flex flex-col items-center")},m(r,u){w(r,e,u),f(e,n),f(n,s),f(e,o),f(e,i)},p(r,u){u&5&&l!==(l=`${r[8].damage.twoHanded.numDice}${r[14]}${r[10]}`)&&ee(s,l)},d(r){r&&T(e)}}}function Zo(t){var k;let e,n,l=(((k=t[8].l10n)==null?void 0:k.name)??t[8].name)+"",s,o,i,r=(Array.isArray(t[8].range)?t[8].range.map(b).join("/"):t[11][t[8].range]??t[8].range)+"",u,c,a,d,h,v,g,m;function b(...O){return t[4](t[11],...O)}d=new Gn({props:{modifier:Ms(t[0],t[8])}});let A=t[8].damage.oneHanded&&Xo(Al(t)),E=t[8].damage.twoHanded&&Jo(El(t));return{c(){e=_("tr"),n=_("td"),s=G(l),o=y(),i=_("td"),u=G(r),c=y(),a=_("td"),ne(d.$$.fragment),h=y(),v=_("td"),A&&A.c(),g=y(),E&&E.c(),p(v,"class","flex gap-1"),p(e,"class","border-b")},m(O,B){w(O,e,B),f(e,n),f(n,s),f(e,o),f(e,i),f(i,u),f(e,c),f(e,a),le(d,a,null),f(e,h),f(e,v),A&&A.m(v,null),f(v,g),E&&E.m(v,null),m=!0},p(O,B){var I;t=O,(!m||B&4)&&l!==(l=(((I=t[8].l10n)==null?void 0:I.name)??t[8].name)+"")&&ee(s,l),(!m||B&4)&&r!==(r=(Array.isArray(t[8].range)?t[8].range.map(b).join("/"):t[11][t[8].range]??t[8].range)+"")&&ee(u,r);const R={};B&5&&(R.modifier=Ms(t[0],t[8])),d.$set(R),t[8].damage.oneHanded?A?(A.p(Al(t),B),B&4&&P(A,1)):(A=Xo(Al(t)),A.c(),P(A,1),A.m(v,g)):A&&(Fe(),U(A,1,1,()=>{A=null}),Ve()),t[8].damage.twoHanded?E?(E.p(El(t),B),B&4&&P(E,1)):(E=Jo(El(t)),E.c(),P(E,1),E.m(v,null)):E&&(Fe(),U(E,1,1,()=>{E=null}),Ve())},i(O){m||(P(d.$$.fragment,O),P(A),P(E),m=!0)},o(O){U(d.$$.fragment,O),U(A),U(E),m=!1},d(O){O&&T(e),se(d),A&&A.d(),E&&E.d()}}}function Qo(t){var s;let e,n=(((s=t[5].l10n)==null?void 0:s.name)??t[5].name)+"",l;return{c(){e=_("div"),l=G(n),p(e,"class","py-1")},m(o,i){w(o,e,i),f(e,l)},p(o,i){var r;i&2&&n!==(n=(((r=o[5].l10n)==null?void 0:r.name)??o[5].name)+"")&&ee(l,n)},d(o){o&&T(e)}}}function cp(t){let e,n,l,s,o,i,r,u,c=t[2],a=[];for(let g=0;g<c.length;g+=1)a[g]=Zo(Ko(t,c,g));const d=g=>U(a[g],1,1,()=>{a[g]=null});let h=t[1],v=[];for(let g=0;g<h.length;g+=1)v[g]=Qo(Yo(t,h,g));return{c(){e=_("h2"),e.textContent="攻擊",n=y(),l=_("div"),s=_("table"),o=_("tr"),o.innerHTML=`<th>攻擊</th> 
      <th>距離</th> 
      <th>命中/DC</th> 
      <th>傷害</th>`,i=y();for(let g=0;g<a.length;g+=1)a[g].c();r=y();for(let g=0;g<v.length;g+=1)v[g].c();p(o,"class","border-b"),p(s,"class","table-auto text-left text-sm w-full"),p(l,"class","overflow-y-auto")},m(g,m){w(g,e,m),w(g,n,m),w(g,l,m),f(l,s),f(s,o),f(s,i);for(let b=0;b<a.length;b+=1)a[b]&&a[b].m(s,null);f(s,r);for(let b=0;b<v.length;b+=1)v[b]&&v[b].m(s,null);u=!0},p(g,[m]){if(m&5){c=g[2];let b;for(b=0;b<c.length;b+=1){const A=Ko(g,c,b);a[b]?(a[b].p(A,m),P(a[b],1)):(a[b]=Zo(A),a[b].c(),P(a[b],1),a[b].m(s,r))}for(Fe(),b=c.length;b<a.length;b+=1)d(b);Ve()}if(m&2){h=g[1];let b;for(b=0;b<h.length;b+=1){const A=Yo(g,h,b);v[b]?v[b].p(A,m):(v[b]=Qo(A),v[b].c(),v[b].m(s,null))}for(;b<v.length;b+=1)v[b].d(1);v.length=h.length}},i(g){if(!u){for(let m=0;m<c.length;m+=1)P(a[m]);u=!0}},o(g){a=a.filter(ap);for(let m=0;m<a.length;m+=1)U(a[m]);u=!1},d(g){g&&T(e),g&&T(n),g&&T(l),ke(a,g),ke(v,g)}}}function fp(t,e,n){let l,s,o,i;Me(t,Ee,u=>n(0,i=u));const r=(u,c)=>u[c]??c;return t.$$.update=()=>{t.$$.dirty&1&&n(3,l=i.gear.filter(u=>u.equipped)),t.$$.dirty&8&&n(2,s=l.map(u=>Ea(u.name)).filter(Boolean)),t.$$.dirty&8&&n(1,o=l.map(u=>ka(u.name)).filter(Boolean).filter(u=>{var c;return u.canBeEquipped&&((c=u.properties)==null?void 0:c.includes("Attackable"))}))},[i,o,s,l,r]}class dp extends Oe{constructor(e){super(),Be(this,e,fp,cp,Ce,{})}}function pp(t){return JSON.parse(t)}function _p(t){let e,n,l,s,o,i,r,u,c,a=$s(t[0])+"",d,h,v,g,m,b,A,E,k,O;return{c(){e=_("h2"),e.textContent="生命值",n=y(),l=_("label"),s=y(),o=_("input"),i=y(),r=_("div"),u=_("div"),c=G("最大值: "),d=G(a),h=y(),v=_("div"),g=_("button"),g.innerHTML='<i class="material-icons text-base align-middle">remove</i>',m=y(),b=_("button"),b.innerHTML='<i class="material-icons text-base align-middle">add</i>',A=y(),E=_("button"),E.textContent="長休",p(l,"for","hitpoints"),p(o,"id","hitpoints"),p(o,"type","number"),p(o,"inputmode","numeric"),p(o,"class","pirata text-5xl text-center"),p(o,"min","0"),p(u,"class","whitespace-nowrap"),p(g,"class","hover:bg-gray-700 rounded"),p(b,"class","hover:bg-gray-700 rounded"),p(v,"class","flex items-center"),p(r,"class","flex gap-1 justify-between items-center text-sm mt-1"),p(E,"class","bg-black text-white rounded-md text-sm self-center px-2")},m(B,R){w(B,e,R),w(B,n,R),w(B,l,R),w(B,s,R),w(B,o,R),ae(o,t[0].hitPoints),w(B,i,R),w(B,r,R),f(r,u),f(u,c),f(u,d),f(r,h),f(r,v),f(v,g),f(v,m),f(v,b),w(B,A,R),w(B,E,R),k||(O=[D(o,"input",t[4]),D(g,"click",t[2]),D(b,"click",t[1]),D(E,"click",t[3])],k=!0)},p(B,[R]){R&1&&Re(o.value)!==B[0].hitPoints&&ae(o,B[0].hitPoints),R&1&&a!==(a=$s(B[0])+"")&&ee(d,a)},i:W,o:W,d(B){B&&T(e),B&&T(n),B&&T(l),B&&T(s),B&&T(o),B&&T(i),B&&T(r),B&&T(A),B&&T(E),k=!1,je(O)}}}function hp(t,e,n){let l;Me(t,Ee,u=>n(0,l=u));function s(){ze(Ee,l.maxHitPoints+=1,l)}function o(){ze(Ee,l.maxHitPoints=Math.max(1,l.maxHitPoints-1),l),l.hitPoints>l.maxHitPoints&&ze(Ee,l.hitPoints=l.maxHitPoints,l)}function i(){ze(Ee,l.hitPoints=l.maxHitPoints,l),ze(Ee,l.spells=l.spells.map(u=>({name:u.name,failed:!1})),l)}function r(){l.hitPoints=Re(this.value),Ee.set(l)}return[l,s,o,i,r]}class mp extends Oe{constructor(e){super(),Be(this,e,hp,_p,Ce,{})}}function gp(t){let e;return{c(){e=_("div"),e.innerHTML=`<div>這是一個非官方的 Shadowdark 角色追蹤工具！
      <a target="_blank" href="https://www.thearcanelibrary.com/pages/shadowdark" class="svelte-1a204e">購買 Shadowdark</a></div> 

    <h2>匯入</h2> 
    <div>本工具可直接從 <a href="https://www.shadowdarklings.net" target="_blank" class="svelte-1a204e">Shadowdarkling Character Creator</a> 匯入您的角色。也能匯入先前匯出的 JSON 檔案。</div> 

    <h2>儲存</h2> 
    <div>本工具會自動將您的角色卡儲存於瀏覽器的 Local
      Storage。若您刪除本網站的儲存資料，請務必先匯出角色 JSON 檔。</div> 

    <h2>聯絡</h2> 
    <div>您可以透過 <a href="mailto:maxpaulus43@gmail.com" target="_blank" class="svelte-1a204e">maxpaulus43@gmail.com</a> 聯絡我（英文），我也會出沒在 Shadowdark 官方 Discord 頻道。</div> 

    <h2>問題回報</h2> 
    <div>本專案為免費且開源！歡迎提交 Pull Request 或
      <a href="https://github.com/maxpaulus43/owlbear-shadowdark-character-sheet" target="_blank" class="svelte-1a204e">建立 Issue</a></div> 

    <h2>致謝</h2> 
    <div>看看其他很棒的 Shadowdark 工具！</div> 
    <div><a href="https://shadowdarklings.net" target="_blank" class="svelte-1a204e">https://shadowdarklings.net</a></div> 
    <div><a href="https://www.shadowdork.com" target="_blank" class="svelte-1a204e">https://www.shadowdork.com</a></div> 

    <h2>授權</h2> 
    <div>本工具為獨立產品，依據 Shadowdark RPG Third-Party License 發布，與 The
      Arcane Library, LLC 無關。 Shadowdark RPG © 2023 The Arcane Library, LLC.</div> 
    <hr/> 
    <div>免責聲明：我已獲得 The Arcane Library
      明確許可，可於本工具轉載角色創建資料（如天賦表）。</div> 

    <a href="https://www.buymeacoffee.com/tKsqTr4ABl" target="_blank" class="pirata text-xl rounded-md p-2 self-center svelte-1a204e">請我吃份口糧 🍖</a>`,p(e,"class","flex flex-col")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function vp(t){let e;return{c(){e=_("h1"),e.textContent="資訊",p(e,"slot","header")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function bp(t){let e,n,l,s,o,i,r;function u(a){t[2](a)}let c={$$slots:{header:[vp],default:[gp]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),We.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons">help</i>',n=y(),ne(l.$$.fragment)},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=D(e,"click",t[1]),i=!0)},p(a,[d]){const h={};d&8&&(h.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,h.showModal=a[0],Ke(()=>s=!1)),l.$set(h)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){U(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function yp(t,e,n){let l=!1;const s=()=>{n(0,l=!0)};function o(i){l=i,n(0,l)}return[l,s,o]}class wp extends Oe{constructor(e){super(),Be(this,e,yp,bp,Ce,{})}}async function Tp(t){const e=t.name;t=JSON.parse(JSON.stringify(t)),t.schemaVersion=Or,t.schemaType=Br;const n=new Blob([JSON.stringify(t,null,2)],{type:"application/json"});if("showSaveFilePicker"in window&&(()=>{try{return window.self===window.top}catch{return!1}})())try{const r=await(await window.showSaveFilePicker({suggestedName:e,types:[{description:"json files",accept:{"application/json":[".json"]}}]})).createWritable();await r.write(n),await r.close();return}catch(i){if(i.name!=="AbortError"){console.error(i.name,i.message);return}}const s=URL.createObjectURL(n),o=document.createElement("a");o.href=s,o.download=e,o.style.display="none",document.body.append(o),o.click(),setTimeout(()=>{URL.revokeObjectURL(s),o.remove()},1e3)}function xo(t,e,n){const l=t.slice();return l[17]=e[n],l[19]=n,l}function ea(t){let e,n=t[19]+1+"",l,s,o;function i(){return t[9](t[19])}return{c(){e=_("button"),l=G(n),p(e,"class","svelte-1bwcddv"),$e(e,"green",t[3]===t[19]+1)},m(r,u){w(r,e,u),f(e,l),s||(o=D(e,"click",i),s=!0)},p(r,u){t=r,u&8&&$e(e,"green",t[3]===t[19]+1)},d(r){r&&T(e),s=!1,o()}}}function Ep(t){let e,n,l,s,o,i,r,u,c;return{c(){e=_("label"),n=_("div"),l=_("div"),l.textContent="通知持續時間:",s=y(),o=_("input"),i=y(),r=_("div"),r.textContent="秒",p(o,"class","w-16 text-right"),p(o,"id","notificationDuration"),p(o,"type","number"),p(o,"inputmode","numeric"),p(o,"min","0"),p(n,"class","flex flex-row gap-1 items-center"),p(e,"for","notificationDuration")},m(a,d){w(a,e,d),f(e,n),f(n,l),f(n,s),f(n,o),ae(o,t[4].popoverDuration),f(n,i),f(n,r),u||(c=D(o,"input",t[10]),u=!0)},p(a,d){d&16&&Re(o.value)!==a[4].popoverDuration&&ae(o,a[4].popoverDuration)},d(a){a&&T(e),u=!1,c()}}}function ta(t){let e,n,l,s,o,i,r;return{c(){e=_("div"),e.textContent="進階選項（請謹慎操作）",n=y(),l=_("button"),l.textContent="清除目前欄位資料",s=y(),o=_("button"),o.textContent="清除所有暫存資料（請謹慎操作）",p(l,"class","svelte-1bwcddv"),p(o,"class","svelte-1bwcddv")},m(u,c){w(u,e,c),w(u,n,c),w(u,l,c),w(u,s,c),w(u,o,c),i||(r=[D(l,"click",t[14]),D(o,"click",t[15])],i=!0)},p:W,d(u){u&&T(e),u&&T(n),u&&T(l),u&&T(s),u&&T(o),i=!1,je(r)}}}function Ap(t){let e,n,l,s,o,i,r,u,c,a,d,h,v,g,m,b,A,E,k,O={length:al},B=[];for(let M=0;M<O.length;M+=1)B[M]=ea(xo(t,O,M));let R=qe.isAvailable&&Ep(t),I=!t[2]&&ta(t);return{c(){e=_("div"),n=_("div"),l=_("h2"),l.textContent="選擇存檔欄位",s=y(),o=_("div");for(let M=0;M<B.length;M+=1)B[M].c();i=y(),R&&R.c(),r=y(),u=_("label"),c=_("div"),c.textContent="匯入 JSON",a=y(),d=_("input"),v=y(),g=_("button"),g.textContent="匯出 JSON",m=y(),b=_("a"),b.textContent="回報問題",A=y(),I&&I.c(),p(o,"class","flex gap-1 w-full justify-stretch"),p(c,"class","text-center"),p(d,"id","jsonImport"),p(d,"type","file"),p(d,"class","hidden"),p(d,"accept","application/json"),d.disabled=t[2],p(u,"for","jsonImport"),p(u,"class",h=Ts(t[2]?"btn-disabled":"btn")+" svelte-1bwcddv"),p(g,"class","svelte-1bwcddv"),p(b,"class","btn svelte-1bwcddv"),p(b,"href","https://github.com/maxpaulus43/owlbear-shadowdark-character-sheet/issues/new"),p(b,"target","_blank"),p(e,"class","flex flex-col gap-1 min-w-[200px] svelte-1bwcddv"),p(e,"id","options")},m(M,S){w(M,e,S),f(e,n),f(n,l),f(n,s),f(n,o);for(let C=0;C<B.length;C+=1)B[C]&&B[C].m(o,null);f(e,i),R&&R.m(e,null),f(e,r),f(e,u),f(u,c),f(u,a),f(u,d),f(e,v),f(e,g),f(e,m),f(e,b),f(e,A),I&&I.m(e,null),E||(k=[D(d,"change",t[11]),D(d,"click",t[12]),D(g,"click",t[13])],E=!0)},p(M,S){if(S&8){O={length:al};let C;for(C=0;C<O.length;C+=1){const $=xo(M,O,C);B[C]?B[C].p($,S):(B[C]=ea($),B[C].c(),B[C].m(o,null))}for(;C<B.length;C+=1)B[C].d(1);B.length=O.length}qe.isAvailable&&R.p(M,S),S&4&&(d.disabled=M[2]),S&4&&h!==(h=Ts(M[2]?"btn-disabled":"btn")+" svelte-1bwcddv")&&p(u,"class",h),M[2]?I&&(I.d(1),I=null):I?I.p(M,S):(I=ta(M),I.c(),I.m(e,null))},d(M){M&&T(e),ke(B,M),R&&R.d(),I&&I.d(),E=!1,je(k)}}}function kp(t){let e;return{c(){e=_("h1"),e.textContent="選項",p(e,"slot","header")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function Cp(t){let e,n,l,s,o,i,r;function u(a){t[16](a)}let c={$$slots:{header:[kp],default:[Ap]},$$scope:{ctx:t}};return t[1]!==void 0&&(c.showModal=t[1]),l=new ft({props:c}),We.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons translate-y-[1px]">settings</i>',n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white rounded-md px-1 text-xs svelte-1bwcddv")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=D(e,"click",t[8]),i=!0)},p(a,[d]){const h={};d&1048637&&(h.$$scope={dirty:d,ctx:a}),!s&&d&2&&(s=!0,h.showModal=a[1],Ke(()=>s=!1)),l.$set(h)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){U(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function Op(t,e,n){let l,s,o,i,r,u;Me(t,hn,O=>n(6,s=O)),Me(t,Ht,O=>n(7,o=O)),Me(t,_t,O=>n(3,i=O)),Me(t,mn,O=>n(4,r=O)),Me(t,Ee,O=>n(5,u=O));let{files:c}=e,a=!1;const d=()=>n(1,a=!0),h=O=>{ze(_t,i=O+1,i)};function v(){r.popoverDuration=Re(this.value),mn.set(r)}function g(){c=this.files,n(0,c)}const m=O=>{O.currentTarget.value="",n(0,c=void 0)},b=()=>{Tp(u)},A=()=>{ze(Ee,u=Pt(),u)},E=()=>{ze(Ee,u=Pt(),u),Sf()};function k(O){a=O,n(1,a)}return t.$$set=O=>{"files"in O&&n(0,c=O.files)},t.$$.update=()=>{t.$$.dirty&192&&n(2,l=o&&!s)},[c,a,l,i,r,u,s,o,d,h,v,g,m,b,A,E,k]}class Bp extends Oe{constructor(e){super(),Be(this,e,Op,Cp,Ce,{files:0})}}function na(t,e,n){const l=t.slice();return l[4]=e[n],l}function la(t){let e;return{c(){e=_("div"),e.textContent="(必須至少達到 1 等級)"},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function Sp(t){let e,n,l,s,o,i=Ut,r=[];for(let u=0;u<i.length;u+=1)r[u]=sa(na(t,i,u));return{c(){e=_("select");for(let u=0;u<r.length;u+=1)r[u].c();e.disabled=l=!t[1]},m(u,c){w(u,e,c);for(let a=0;a<r.length;a+=1)r[a]&&r[a].m(e,null);he(e,t[0].class),s||(o=D(e,"change",t[2]),s=!0)},p(u,c){if(c&0){i=Ut;let a;for(a=0;a<i.length;a+=1){const d=na(u,i,a);r[a]?r[a].p(d,c):(r[a]=sa(d),r[a].c(),r[a].m(e,null))}for(;a<r.length;a+=1)r[a].d(1);r.length=i.length}c&1&&n!==(n=u[0].class)&&he(e,u[0].class),c&2&&l!==(l=!u[1])&&(e.disabled=l)},d(u){u&&T(e),ke(r,u),s=!1,o()}}}function Rp(t){let e,n,l,s,o;return{c(){e=_("input"),p(e,"type","text"),e.value=n=t[0].class,e.disabled=l=!t[1]},m(i,r){w(i,e,r),s||(o=D(e,"input",t[2]),s=!0)},p(i,r){r&1&&n!==(n=i[0].class)&&e.value!==n&&(e.value=n),r&2&&l!==(l=!i[1])&&(e.disabled=l)},d(i){i&&T(e),s=!1,o()}}}function sa(t){let e,n=Cl(t[4])+"",l,s;return{c(){e=_("option"),l=G(n),s=y(),e.__value=t[4],e.value=e.__value},m(o,i){w(o,e,i),f(e,l),f(e,s)},p:W,d(o){o&&T(e)}}}function Mp(t){let e,n,l,s,o,i,r,u,c,a,d,h,v,g,m=!t[1]&&la();function b(k,O){return k[0].hasCustomClass?Rp:Sp}let A=b(t),E=A(t);return{c(){e=_("div"),n=_("h2"),n.textContent="職業",l=y(),m&&m.c(),s=y(),o=_("div"),i=_("input"),c=y(),a=_("label"),a.textContent="自訂",d=y(),E.c(),h=vt(),p(i,"id","customClass"),p(i,"type","checkbox"),i.disabled=r=!t[1],i.checked=u=t[0].hasCustomClass,p(a,"for","customClass"),p(o,"class","flex items-center gap-1"),p(e,"class","flex justify-between")},m(k,O){w(k,e,O),f(e,n),f(e,l),m&&m.m(e,null),f(e,s),f(e,o),f(o,i),f(o,c),f(o,a),w(k,d,O),E.m(k,O),w(k,h,O),v||(g=D(i,"input",t[3]),v=!0)},p(k,[O]){k[1]?m&&(m.d(1),m=null):m||(m=la(),m.c(),m.m(e,s)),O&2&&r!==(r=!k[1])&&(i.disabled=r),O&1&&u!==(u=k[0].hasCustomClass)&&(i.checked=u),A===(A=b(k))&&E?E.p(k,O):(E.d(1),E=A(k),E&&(E.c(),E.m(h.parentNode,h)))},i:W,o:W,d(k){k&&T(e),m&&m.d(),k&&T(d),E.d(k),k&&T(h),v=!1,g()}}}function $p(t,e,n){let l,s;Me(t,Ee,r=>n(0,s=r));function o(r){const u=r.target.value;Ir(s,u),Ee.set(s)}function i(r){ze(Ee,s.hasCustomClass=r.target.checked,s)}return t.$$.update=()=>{t.$$.dirty&1&&n(1,l=s.level>=1)},[s,l,o,i]}class Np extends Oe{constructor(e){super(),Be(this,e,$p,Mp,Ce,{})}}function Ip(t){let e,n,l,s,o,i,r,u,c=t[0].armorClass+"",a,d,h,v,g,m,b;return{c(){e=_("h2"),e.textContent="防禦等級",n=y(),l=_("div"),s=G(t[1]),o=y(),i=_("div"),r=_("span"),u=G("基礎 AC: "),a=G(c),d=y(),h=_("button"),h.innerHTML='<i class="material-icons">remove</i>',v=y(),g=_("button"),g.innerHTML='<i class="material-icons">add</i>',p(l,"class","flex w-full h-full justify-center items-center text-7xl pirata text-center"),p(r,"class","text-sm"),p(i,"class","flex items-center")},m(A,E){w(A,e,E),w(A,n,E),w(A,l,E),f(l,s),w(A,o,E),w(A,i,E),f(i,r),f(r,u),f(r,a),f(i,d),f(i,h),f(i,v),f(i,g),m||(b=[D(h,"click",t[3]),D(g,"click",t[2])],m=!0)},p(A,[E]){E&2&&ee(s,A[1]),E&1&&c!==(c=A[0].armorClass+"")&&ee(a,c)},i:W,o:W,d(A){A&&T(e),A&&T(n),A&&T(l),A&&T(o),A&&T(i),m=!1,je(b)}}}function Dp(t,e,n){let l,s;Me(t,Ee,r=>n(0,s=r));function o(){ze(Ee,s.armorClass+=1,s),Ee.set(s)}function i(){ze(Ee,s.armorClass-=1,s),Ee.set(s)}return t.$$.update=()=>{t.$$.dirty&1&&n(1,l=Lr(s))},[s,l,o,i]}class Lp extends Oe{constructor(e){super(),Be(this,e,Dp,Ip,Ce,{})}}function Pp(t){let e,n,l;return{c(){e=_("textarea"),p(e,"class","w-[300px] h-[500px] md:w-[700px] md:h-[550px] resize-none")},m(s,o){w(s,e,o),ae(e,t[1].notes),n||(l=D(e,"input",t[3]),n=!0)},p(s,o){o&2&&ae(e,s[1].notes)},d(s){s&&T(e),n=!1,l()}}}function Hp(t){let e;return{c(){e=_("h1"),e.textContent="筆記",p(e,"slot","header")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function Gp(t){let e,n,l,s,o,i,r;function u(a){t[4](a)}let c={$$slots:{header:[Hp],default:[Pp]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),We.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons translate-y-1">notes</i>',n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white px-1")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=D(e,"click",t[2]),i=!0)},p(a,[d]){const h={};d&34&&(h.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,h.showModal=a[0],Ke(()=>s=!1)),l.$set(h)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){U(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function Up(t,e,n){let l;Me(t,Ee,u=>n(1,l=u));let s=!1;const o=()=>n(0,s=!0);function i(){l.notes=this.value,Ee.set(l)}function r(u){s=u,n(0,s)}return[s,l,o,i,r]}class Fp extends Oe{constructor(e){super(),Be(this,e,Up,Gp,Ce,{})}}function ia(t,e,n){const l=t.slice();return l[12]=e[n],l}function oa(t){let e,n,l,s,o;return{c(){e=_("button"),n=_("i"),n.textContent="group",p(n,"class","material-icons translate-y-1"),p(e,"class",l=(t[5]?"bg-black":"bg-green-600")+" text-white px-1")},m(i,r){w(i,e,r),f(e,n),s||(o=D(e,"click",t[9]),s=!0)},p(i,r){r&32&&l!==(l=(i[5]?"bg-black":"bg-green-600")+" text-white px-1")&&p(e,"class",l)},d(i){i&&T(e),s=!1,o()}}}function Vp(t){let e;return{c(){e=_("div"),e.textContent="同步中"},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function jp(t){let e,n,l;function s(){return t[10](t[12])}return{c(){e=_("button"),e.textContent="載入",p(e,"class","bg-black text-white p-1 rounded-md px-1")},m(o,i){w(o,e,i),n||(l=D(e,"click",s),n=!0)},p(o,i){t=o},d(o){o&&T(e),n=!1,l()}}}function aa(t){let e,n,l=t[12].name+"",s,o=t[12].id==t[1]?"（你）":"",i,r,u;function c(h,v){if(h[3]!==h[12].id)return jp;if(!h[5])return Vp}let a=c(t),d=a&&a(t);return{c(){e=_("div"),n=_("div"),s=G(l),i=G(o),r=y(),d&&d.c(),u=y(),p(e,"class","flex gap-1 justify-between items-center p-1 rounded-md w-full"),$e(e,"bg-yellow-300",t[3]===t[12].id)},m(h,v){w(h,e,v),f(e,n),f(n,s),f(n,i),f(e,r),d&&d.m(e,null),f(e,u)},p(h,v){v&1&&l!==(l=h[12].name+"")&&ee(s,l),v&3&&o!==(o=h[12].id==h[1]?"（你）":"")&&ee(i,o),a===(a=c(h))&&d?d.p(h,v):(d&&d.d(1),d=a&&a(h),d&&(d.c(),d.m(e,u))),v&9&&$e(e,"bg-yellow-300",h[3]===h[12].id)},d(h){h&&T(e),d&&d.d()}}}function Wp(t){let e,n,l,s=t[0],o=[];for(let i=0;i<s.length;i+=1)o[i]=aa(ia(t,s,i));return{c(){e=_("div"),e.textContent="注意：載入其他玩家僅載入其數據。這是玩家角色卡的唯讀預覽。",n=y(),l=_("div");for(let i=0;i<o.length;i+=1)o[i].c();p(e,"class","w-72 mt-4 mb-4"),p(l,"class","flex flex-col gap-1 w-full")},m(i,r){w(i,e,r),w(i,n,r),w(i,l,r);for(let u=0;u<o.length;u+=1)o[u]&&o[u].m(l,null)},p(i,r){if(r&107){s=i[0];let u;for(u=0;u<s.length;u+=1){const c=ia(i,s,u);o[u]?o[u].p(c,r):(o[u]=aa(c),o[u].c(),o[u].m(l,null))}for(;u<o.length;u+=1)o[u].d(1);o.length=s.length}},d(i){i&&T(e),i&&T(n),i&&T(l),ke(o,i)}}}function qp(t){let e;return{c(){e=_("h1"),e.textContent="玩家",p(e,"slot","header")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function zp(t){let e,n,l,s,o=t[4]&&oa(t);function i(u){t[11](u)}let r={$$slots:{header:[qp],default:[Wp]},$$scope:{ctx:t}};return t[2]!==void 0&&(r.showModal=t[2]),n=new ft({props:r}),We.push(()=>Ye(n,"showModal",i)),{c(){o&&o.c(),e=y(),ne(n.$$.fragment)},m(u,c){o&&o.m(u,c),w(u,e,c),le(n,u,c),s=!0},p(u,[c]){u[4]?o?o.p(u,c):(o=oa(u),o.c(),o.m(e.parentNode,e)):o&&(o.d(1),o=null);const a={};c&32811&&(a.$$scope={dirty:c,ctx:u}),!l&&c&4&&(l=!0,a.showModal=u[2],Ke(()=>l=!1)),n.$set(a)},i(u){s||(P(n.$$.fragment,u),s=!0)},o(u){U(n.$$.fragment,u),s=!1},d(u){o&&o.d(u),u&&T(e),se(n,u)}}}function Yp(t,e,n){let l,s,o,i,r,u;Me(t,Ct,m=>n(3,l=m)),Me(t,ls,m=>n(7,s=m)),Me(t,Hn,m=>n(1,o=m)),Me(t,Sn,m=>n(8,i=m)),Me(t,Ht,m=>n(4,r=m)),Me(t,hn,m=>n(5,u=m));let c=!1,a;function d(m){ze(Ct,l=m.id,l)}const h=()=>n(2,c=!0),v=m=>d(m);function g(m){c=m,n(2,c)}return t.$$.update=()=>{t.$$.dirty&387&&(n(0,a=i.map(m=>({id:m.id,name:m.name}))),a.unshift({id:o,name:(s==null?void 0:s.name)??"GM"}))},[a,o,c,l,r,u,d,s,i,h,v,g]}class Kp extends Oe{constructor(e){super(),Be(this,e,Yp,zp,Ce,{})}}function ra(t,e,n){const l=t.slice();return l[3]=e[n],l}function Xp(t){let e,n,l,s,o=Os,i=[];for(let r=0;r<o.length;r+=1)i[r]=ua(ra(t,o,r));return{c(){e=_("select");for(let r=0;r<i.length;r+=1)i[r].c()},m(r,u){w(r,e,u);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(e,null);he(e,t[0].ancestry),l||(s=D(e,"change",t[2]),l=!0)},p(r,u){if(u&0){o=Os;let c;for(c=0;c<o.length;c+=1){const a=ra(r,o,c);i[c]?i[c].p(a,u):(i[c]=ua(a),i[c].c(),i[c].m(e,null))}for(;c<i.length;c+=1)i[c].d(1);i.length=o.length}u&1&&n!==(n=r[0].ancestry)&&he(e,r[0].ancestry)},d(r){r&&T(e),ke(i,r),l=!1,s()}}}function Jp(t){let e,n,l,s;return{c(){e=_("input"),p(e,"type","text"),e.value=n=t[0].ancestry},m(o,i){w(o,e,i),l||(s=D(e,"input",t[2]),l=!0)},p(o,i){i&1&&n!==(n=o[0].ancestry)&&e.value!==n&&(e.value=n)},d(o){o&&T(e),l=!1,s()}}}function ua(t){let e,n=eu(t[3])+"",l,s;return{c(){e=_("option"),l=G(n),s=y(),e.__value=t[3],e.value=e.__value},m(o,i){w(o,e,i),f(e,l),f(e,s)},p:W,d(o){o&&T(e)}}}function Zp(t){let e,n,l,s,o,i,r,u,c,a,d,h;function v(b,A){return b[0].hasCustomAncestry?Jp:Xp}let g=v(t),m=g(t);return{c(){e=_("div"),n=_("h2"),n.textContent="種族",l=y(),s=_("div"),o=_("input"),r=y(),u=_("label"),u.textContent="自訂",c=y(),m.c(),a=vt(),p(o,"id","customAncestry"),p(o,"type","checkbox"),o.checked=i=t[0].hasCustomAncestry,p(u,"for","customAncestry"),p(s,"class","flex items-center gap-1"),p(e,"class","flex justify-between")},m(b,A){w(b,e,A),f(e,n),f(e,l),f(e,s),f(s,o),f(s,r),f(s,u),w(b,c,A),m.m(b,A),w(b,a,A),d||(h=D(o,"input",t[1]),d=!0)},p(b,[A]){A&1&&i!==(i=b[0].hasCustomAncestry)&&(o.checked=i),g===(g=v(b))&&m?m.p(b,A):(m.d(1),m=g(b),m&&(m.c(),m.m(a.parentNode,a)))},i:W,o:W,d(b){b&&T(e),b&&T(c),m.d(b),b&&T(a),d=!1,h()}}}function Qp(t,e,n){let l;Me(t,Ee,i=>n(0,l=i));function s(i){ze(Ee,l.hasCustomAncestry=i.target.checked,l)}function o(i){const r=i.target.value;Dr(l,r),Ee.set(l)}return[l,s,o]}class xp extends Oe{constructor(e){super(),Be(this,e,Qp,Zp,Ce,{})}}function ca(t,e,n){const l=t.slice();return l[5]=e[n],l}function fa(t){let e,n,l=t[5].msg+"",s,o,i,r=t[2].format(t[5].timestamp)+"",u;return{c(){e=_("div"),n=_("span"),s=G(l),o=y(),i=_("span"),u=G(r),p(i,"class","text-gray-400"),p(e,"class","shadow-sm rounded-md border border-gray-200 p-2 flex flex-col md:flex-row justify-between")},m(c,a){w(c,e,a),f(e,n),f(n,s),f(e,o),f(e,i),f(i,u)},p(c,a){a&2&&l!==(l=c[5].msg+"")&&ee(s,l),a&2&&r!==(r=c[2].format(c[5].timestamp)+"")&&ee(u,r)},d(c){c&&T(e)}}}function da(t){let e,n,l;return{c(){e=_("button"),e.innerHTML=`<i class="material-icons translate-y-1">delete</i>
          清除通知`,p(e,"class","p-2 bg-white")},m(s,o){w(s,e,o),n||(l=D(e,"click",Bf),n=!0)},p:W,d(s){s&&T(e),n=!1,l()}}}function e_(t){let e,n,l,s=t[1],o=[];for(let r=0;r<s.length;r+=1)o[r]=fa(ca(t,s,r));let i=t[1].length&&da();return{c(){e=_("div"),n=_("div");for(let r=0;r<o.length;r+=1)o[r].c();l=y(),i&&i.c(),p(n,"class","flex flex-col gap-1"),p(e,"class","w-[300px] h-[500px] md:w-[700px] md:h-[550px] resize-none")},m(r,u){w(r,e,u),f(e,n);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(n,null);f(n,l),i&&i.m(n,null)},p(r,u){if(u&6){s=r[1];let c;for(c=0;c<s.length;c+=1){const a=ca(r,s,c);o[c]?o[c].p(a,u):(o[c]=fa(a),o[c].c(),o[c].m(n,l))}for(;c<o.length;c+=1)o[c].d(1);o.length=s.length}r[1].length?i?i.p(r,u):(i=da(),i.c(),i.m(n,null)):i&&(i.d(1),i=null)},d(r){r&&T(e),ke(o,r),i&&i.d()}}}function t_(t){let e;return{c(){e=_("h1"),e.textContent="通知",p(e,"slot","header")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function n_(t){let e,n,l,s,o,i,r;function u(a){t[4](a)}let c={$$slots:{header:[t_],default:[e_]},$$scope:{ctx:t}};return t[0]!==void 0&&(c.showModal=t[0]),l=new ft({props:c}),We.push(()=>Ye(l,"showModal",u)),{c(){e=_("button"),e.innerHTML='<i class="material-icons translate-y-1">history</i>',n=y(),ne(l.$$.fragment),p(e,"class","bg-black text-white px-1")},m(a,d){w(a,e,d),w(a,n,d),le(l,a,d),o=!0,i||(r=D(e,"click",t[3]),i=!0)},p(a,[d]){const h={};d&258&&(h.$$scope={dirty:d,ctx:a}),!s&&d&1&&(s=!0,h.showModal=a[0],Ke(()=>s=!1)),l.$set(h)},i(a){o||(P(l.$$.fragment,a),o=!0)},o(a){U(l.$$.fragment,a),o=!1},d(a){a&&T(e),a&&T(n),se(l,a),i=!1,r()}}}function l_(t,e,n){let l;Me(t,ns,u=>n(1,l=u));let s=!1;const o=new Intl.DateTimeFormat("zh-TW",{timeStyle:"medium"}),i=()=>n(0,s=!0);function r(u){s=u,n(0,s)}return[s,l,o,i,r]}class s_ extends Oe{constructor(e){super(),Be(this,e,l_,n_,Ce,{})}}function pa(t,e,n){const l=t.slice();return l[23]=e[n],l}function _a(t){let e;return{c(){e=_("div"),e.innerHTML='<i class="material-icons">save</i>...',p(e,"title","save in progress..."),p(e,"class","absolute top-0 left-0 opacity-20 bg-black text-white p-1 rounded-md flex items-center")},m(n,l){w(n,e,l)},d(n){n&&T(e)}}}function ha(t){let e,n,l,s,o,i,r,u,c;return{c(){e=_("button"),n=_("i"),n.textContent="undo",s=y(),o=_("button"),i=_("i"),i.textContent="redo",p(n,"class","material-icons translate-y-1 px-1"),e.disabled=l=!t[7],p(e,"class","bg-black text-white rounded-md"),$e(e,"opacity-50",!t[7]),p(i,"class","material-icons translate-y-1 px-1"),o.disabled=r=!t[8],p(o,"class","bg-black text-white rounded-md"),$e(o,"opacity-50",!t[8])},m(a,d){w(a,e,d),f(e,n),w(a,s,d),w(a,o,d),f(o,i),u||(c=[D(e,"click",t[13]),D(o,"click",t[14])],u=!0)},p(a,d){d&128&&l!==(l=!a[7])&&(e.disabled=l),d&128&&$e(e,"opacity-50",!a[7]),d&256&&r!==(r=!a[8])&&(o.disabled=r),d&256&&$e(o,"opacity-50",!a[8])},d(a){a&&T(e),a&&T(s),a&&T(o),u=!1,je(c)}}}function i_(t){let e,n;return e=new s_({}),{c(){ne(e.$$.fragment)},m(l,s){le(e,l,s),n=!0},i(l){n||(P(e.$$.fragment,l),n=!0)},o(l){U(e.$$.fragment,l),n=!1},d(l){se(e,l)}}}function o_(t){let e;return{c(){e=G("最高等級")},m(n,l){w(n,e,l)},p:W,d(n){n&&T(e)}}}function a_(t){let e,n,l,s,o,i;return{c(){e=_("input"),n=G(`
              /
              `),l=_("div"),s=G(t[1]),p(e,"id","xp"),p(e,"type","number"),p(e,"inputmode","numeric"),p(e,"min","0"),p(e,"class","svelte-z687v8")},m(r,u){w(r,e,u),ae(e,t[2].xp),w(r,n,u),w(r,l,u),f(l,s),o||(i=D(e,"input",t[18]),o=!0)},p(r,u){u&4&&Re(e.value)!==r[2].xp&&ae(e,r[2].xp),u&2&&ee(s,r[1])},d(r){r&&T(e),r&&T(n),r&&T(l),o=!1,i()}}}function r_(t){let e,n=Ns(t[4]??t[2].title,t[2].class,t[2].alignment)+"",l;return{c(){e=_("div"),l=G(n)},m(s,o){w(s,e,o),f(e,l)},p(s,o){o&20&&n!==(n=Ns(s[4]??s[2].title,s[2].class,s[2].alignment)+"")&&ee(l,n)},d(s){s&&T(e)}}}function u_(t){let e,n,l,s;return{c(){e=_("input"),p(e,"type","text"),e.value=n=t[4]??t[2].title,p(e,"class","svelte-z687v8")},m(o,i){w(o,e,i),l||(s=D(e,"input",t[12]),l=!0)},p(o,i){i&20&&n!==(n=o[4]??o[2].title)&&e.value!==n&&(e.value=n)},d(o){o&&T(e),l=!1,s()}}}function ma(t){let e,n=tu(t[23])+"",l,s;return{c(){e=_("option"),l=G(n),s=y(),e.__value=t[23],e.value=e.__value},m(o,i){w(o,e,i),f(e,l),f(e,s)},p:W,d(o){o&&T(e)}}}function c_(t){let e,n,l,s,o,i,r,u,c,a,d,h,v,g,m,b,A,E,k,O,B,R,I,M,S,C,$,N,j,V,Q,ve,re,de,oe,q,F,K,ye,Y,pe,be,X,H,Z,me,_e,ue,ce,z,te,Ae,De,x,fe,Se,L,ge,Le,we,lt,st,Wt,Mt,Tt,qt,wn,Je,Ze,bt,yt,St,Xe,xe,ie,He,Te,$t,Un,ss,zt,dl,is,os,xt,pl,as,Rt,rs,en,_l,us,Nt,cs,tn,hl,fs,Yt,ds,nn,Fn,ln,ps,Vn,sn,on,ml,_s;d=new wp({});let pt=t[5]&&_a(),dt=!t[6]&&ha(t);function nr(J){t[15](J)}let hs={};t[0]!==void 0&&(hs.files=t[0]),b=new Bp({props:hs}),We.push(()=>Ye(b,"files",nr)),k=new Fp({});let It=qe.isAvailable&&i_();R=new Kp({}),S=new pn({props:{forStat:"STR"}}),N=new pn({props:{forStat:"INT"}}),Q=new pn({props:{forStat:"DEX"}}),de=new pn({props:{forStat:"WIS"}}),F=new pn({props:{forStat:"CON"}}),Y=new pn({props:{forStat:"CHA"}}),X=new mp({}),me=new Lp({}),ce=new dp({}),Le=new xp({}),st=new Np({});function ms(J,et){return J[2].level<10?a_:o_}let jn=ms(t),Et=jn(t);function gs(J,et){return J[2].hasCustomClass?u_:r_}let Wn=gs(t),At=Wn(t),an=As,ot=[];for(let J=0;J<an.length;J+=1)ot[J]=ma(pa(t,an,J));return ln=new Od({}),sn=new op({}),{c(){e=_("div"),n=_("main"),l=_("div"),s=_("div"),o=_("div"),i=_("div"),r=_("div"),u=_("div"),c=_("h1"),c.textContent="Shadowdark",a=y(),ne(d.$$.fragment),h=y(),pt&&pt.c(),v=y(),g=_("div"),dt&&dt.c(),m=y(),ne(b.$$.fragment),E=y(),ne(k.$$.fragment),O=y(),It&&It.c(),B=y(),ne(R.$$.fragment),I=y(),M=_("div"),ne(S.$$.fragment),C=y(),$=_("div"),ne(N.$$.fragment),j=y(),V=_("div"),ne(Q.$$.fragment),ve=y(),re=_("div"),ne(de.$$.fragment),oe=y(),q=_("div"),ne(F.$$.fragment),K=y(),ye=_("div"),ne(Y.$$.fragment),pe=y(),be=_("div"),ne(X.$$.fragment),H=y(),Z=_("div"),ne(me.$$.fragment),_e=y(),ue=_("div"),ne(ce.$$.fragment),z=y(),te=_("div"),Ae=_("div"),De=_("label"),x=_("h2"),x.textContent="姓名",fe=y(),Se=_("input"),L=y(),ge=_("div"),ne(Le.$$.fragment),we=y(),lt=_("div"),ne(st.$$.fragment),Wt=y(),Mt=_("div"),Tt=_("label"),qt=_("h2"),qt.textContent="等級",wn=y(),Je=_("input"),Ze=y(),bt=_("div"),yt=_("h2"),yt.textContent="經驗值",St=y(),Xe=_("label"),xe=y(),ie=_("div"),Et.c(),He=y(),Te=_("button"),$t=G("🆙"),ss=y(),zt=_("div"),dl=_("h2"),dl.textContent="稱號",is=y(),At.c(),os=y(),xt=_("div"),pl=_("h2"),pl.textContent="陣營",as=y(),Rt=_("select");for(let J=0;J<ot.length;J+=1)ot[J].c();rs=y(),en=_("div"),_l=_("h2"),_l.textContent="背景",us=y(),Nt=_("input"),cs=y(),tn=_("div"),hl=_("h2"),hl.textContent="神祇",fs=y(),Yt=_("input"),ds=y(),nn=_("div"),Fn=_("div"),ne(ln.$$.fragment),ps=y(),Vn=_("div"),ne(sn.$$.fragment),p(c,"class",""),p(u,"class","flex items-center gap-1"),p(g,"class","-translate-y-2 flex gap-1"),p(r,"class","flex flex-col items-center"),p(i,"class","flex gap-1 justify-around"),p(o,"class","col-span-full cell svelte-z687v8"),p(M,"class","cell svelte-z687v8"),p($,"class","cell svelte-z687v8"),p(V,"class","cell svelte-z687v8"),p(re,"class","cell svelte-z687v8"),p(q,"class","cell svelte-z687v8"),p(ye,"class","cell svelte-z687v8"),p(be,"class","row-span-2 cell svelte-z687v8"),p(Z,"class","row-span-2 cell svelte-z687v8"),p(ue,"class","col-span-full row-span-2 cell svelte-z687v8"),p(s,"class","flex-[2] min-w-[257px] h-[700px] grid grid-rows-8 grid-cols-2 gap-2"),p(Se,"type","text"),p(Se,"class","svelte-z687v8"),p(Ae,"class","col-span-full cell svelte-z687v8"),p(ge,"class","col-span-full cell svelte-z687v8"),p(lt,"class","col-span-full cell svelte-z687v8"),p(Je,"type","number"),p(Je,"inputmode","numeric"),p(Je,"max","10"),p(Je,"min","1"),p(Je,"class","svelte-z687v8"),p(Mt,"class","cell svelte-z687v8"),p(Xe,"for","xp"),p(Te,"class","text-2xl"),Te.disabled=Un=!t[3],$e(Te,"opacity-20",!t[3]),p(ie,"class","sheet-stat flex gap-1"),p(bt,"class","cell svelte-z687v8"),p(zt,"class","col-span-full cell svelte-z687v8"),p(Rt,"class","svelte-z687v8"),t[2].alignment===void 0&&Pe(()=>t[20].call(Rt)),p(xt,"class","col-span-full cell svelte-z687v8"),p(Nt,"type","text"),p(Nt,"class","svelte-z687v8"),p(en,"class","col-span-full cell svelte-z687v8"),p(Yt,"class","svelte-z687v8"),p(tn,"class","col-span-full cell svelte-z687v8"),p(te,"class","flex-[2] min-w-[257px] h-[700px] grid grid-rows-8 grid-cols-2 gap-2"),p(Fn,"class","cell svelte-z687v8"),p(Vn,"class","cell svelte-z687v8"),p(nn,"class","flex-[3] min-w-[257px] min-[805px]:h-[700px] grid grid-rows-2 gap-2"),p(l,"id","sheet"),p(l,"class","bg-black min-w-[277px] max-w-[1000px] p-2 flex flex-wrap gap-2"),p(e,"class","flex items-center justify-center bg-black")},m(J,et){w(J,e,et),f(e,n),f(n,l),f(l,s),f(s,o),f(o,i),f(i,r),f(r,u),f(u,c),f(u,a),le(d,u,null),f(r,h),pt&&pt.m(r,null),f(r,v),f(r,g),dt&&dt.m(g,null),f(g,m),le(b,g,null),f(g,E),le(k,g,null),f(g,O),It&&It.m(g,null),f(g,B),le(R,g,null),f(s,I),f(s,M),le(S,M,null),f(s,C),f(s,$),le(N,$,null),f(s,j),f(s,V),le(Q,V,null),f(s,ve),f(s,re),le(de,re,null),f(s,oe),f(s,q),le(F,q,null),f(s,K),f(s,ye),le(Y,ye,null),f(s,pe),f(s,be),le(X,be,null),f(s,H),f(s,Z),le(me,Z,null),f(s,_e),f(s,ue),le(ce,ue,null),f(l,z),f(l,te),f(te,Ae),f(Ae,De),f(De,x),f(De,fe),f(De,Se),ae(Se,t[2].name),f(te,L),f(te,ge),le(Le,ge,null),f(te,we),f(te,lt),le(st,lt,null),f(te,Wt),f(te,Mt),f(Mt,Tt),f(Tt,qt),f(Tt,wn),f(Tt,Je),ae(Je,t[2].level),f(te,Ze),f(te,bt),f(bt,yt),f(bt,St),f(bt,Xe),f(bt,xe),f(bt,ie),Et.m(ie,null),f(ie,He),f(ie,Te),f(Te,$t),f(te,ss),f(te,zt),f(zt,dl),f(zt,is),At.m(zt,null),f(te,os),f(te,xt),f(xt,pl),f(xt,as),f(xt,Rt);for(let Kt=0;Kt<ot.length;Kt+=1)ot[Kt]&&ot[Kt].m(Rt,null);he(Rt,t[2].alignment,!0),f(te,rs),f(te,en),f(en,_l),f(en,us),f(en,Nt),ae(Nt,t[2].background),f(te,cs),f(te,tn),f(tn,hl),f(tn,fs),f(tn,Yt),ae(Yt,t[2].deity),f(l,ds),f(l,nn),f(nn,Fn),le(ln,Fn,null),f(nn,ps),f(nn,Vn),le(sn,Vn,null),on=!0,ml||(_s=[D(Se,"input",t[16]),D(Je,"input",t[17]),D(Te,"click",t[19]),D(Rt,"change",t[20]),D(Nt,"input",t[21]),D(Yt,"input",t[22])],ml=!0)},p(J,[et]){J[5]?pt||(pt=_a(),pt.c(),pt.m(r,v)):pt&&(pt.d(1),pt=null),J[6]?dt&&(dt.d(1),dt=null):dt?dt.p(J,et):(dt=ha(J),dt.c(),dt.m(g,m));const Kt={};if(!A&&et&1&&(A=!0,Kt.files=J[0],Ke(()=>A=!1)),b.$set(Kt),et&4&&Se.value!==J[2].name&&ae(Se,J[2].name),et&4&&Re(Je.value)!==J[2].level&&ae(Je,J[2].level),jn===(jn=ms(J))&&Et?Et.p(J,et):(Et.d(1),Et=jn(J),Et&&(Et.c(),Et.m(ie,He))),(!on||et&8&&Un!==(Un=!J[3]))&&(Te.disabled=Un),(!on||et&8)&&$e(Te,"opacity-20",!J[3]),Wn===(Wn=gs(J))&&At?At.p(J,et):(At.d(1),At=Wn(J),At&&(At.c(),At.m(zt,null))),et&0){an=As;let gt;for(gt=0;gt<an.length;gt+=1){const vs=pa(J,an,gt);ot[gt]?ot[gt].p(vs,et):(ot[gt]=ma(vs),ot[gt].c(),ot[gt].m(Rt,null))}for(;gt<ot.length;gt+=1)ot[gt].d(1);ot.length=an.length}et&4&&he(Rt,J[2].alignment),et&4&&Nt.value!==J[2].background&&ae(Nt,J[2].background),et&4&&Yt.value!==J[2].deity&&ae(Yt,J[2].deity)},i(J){on||(P(d.$$.fragment,J),P(b.$$.fragment,J),P(k.$$.fragment,J),P(It),P(R.$$.fragment,J),P(S.$$.fragment,J),P(N.$$.fragment,J),P(Q.$$.fragment,J),P(de.$$.fragment,J),P(F.$$.fragment,J),P(Y.$$.fragment,J),P(X.$$.fragment,J),P(me.$$.fragment,J),P(ce.$$.fragment,J),P(Le.$$.fragment,J),P(st.$$.fragment,J),P(ln.$$.fragment,J),P(sn.$$.fragment,J),on=!0)},o(J){U(d.$$.fragment,J),U(b.$$.fragment,J),U(k.$$.fragment,J),U(It),U(R.$$.fragment,J),U(S.$$.fragment,J),U(N.$$.fragment,J),U(Q.$$.fragment,J),U(de.$$.fragment,J),U(F.$$.fragment,J),U(Y.$$.fragment,J),U(X.$$.fragment,J),U(me.$$.fragment,J),U(ce.$$.fragment,J),U(Le.$$.fragment,J),U(st.$$.fragment,J),U(ln.$$.fragment,J),U(sn.$$.fragment,J),on=!1},d(J){J&&T(e),se(d),pt&&pt.d(),dt&&dt.d(),se(b),se(k),It&&It.d(),se(R),se(S),se(N),se(Q),se(de),se(F),se(Y),se(X),se(me),se(ce),se(Le),se(st),Et.d(),At.d(),ke(ot,J),se(ln),se(sn),ml=!1,je(_s)}}}function f_(t,e,n){let l,s,o,i,r,u,c,a;Me(t,Ee,C=>n(2,i=C)),Me(t,Il,C=>n(5,r=C));const{isGM:d}=Df;Me(t,d,C=>n(6,u=C)),gr(()=>{Lf(),qe.isAvailable?Xa():Rf()});const{canUndo:h,canRedo:v}=Ee;Me(t,h,C=>n(7,c=C)),Me(t,v,C=>n(8,a=C));let g;function m(C){ze(Ee,i.title=C.target.value,i)}const b=()=>Ee.undo(),A=()=>Ee.redo();function E(C){g=C,n(0,g)}function k(){i.name=this.value,Ee.set(i)}function O(){i.level=Re(this.value),Ee.set(i)}function B(){i.xp=Re(this.value),Ee.set(i)}const R=()=>{Vr(i),Ee.set(i)};function I(){i.alignment=Ge(this),Ee.set(i)}function M(){i.background=this.value,Ee.set(i)}function S(){i.deity=this.value,Ee.set(i)}return t.$$.update=()=>{if(t.$$.dirty&1&&g)for(const C of g){C.text().then($=>{ze(Ee,i=pp($),i)}),n(0,g=void 0);break}t.$$.dirty&4&&wr(i),t.$$.dirty&4&&n(4,l=Pr(i)),t.$$.dirty&4&&n(1,s=i.level===0?10:i.level*10),t.$$.dirty&6&&n(3,o=i.level<10&&i.xp>=s)},[g,s,i,o,l,r,u,c,a,d,h,v,m,b,A,E,k,O,B,R,I,M,S]}class d_ extends Oe{constructor(e){super(),Be(this,e,f_,c_,Ce,{})}}new d_({target:document.getElementById("app")});
